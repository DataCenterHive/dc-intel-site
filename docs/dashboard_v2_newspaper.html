<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DC Intel Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #f5f5dc;
            font-family: Georgia, 'Times New Roman', Times, serif;
            color: #000;
            padding: 20px;
        }

        .newspaper-container {
            max-width: 1200px;
            margin: 0 auto;
            background: #fff;
            padding: 40px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .masthead {
            text-align: center;
            border-bottom: 4px double #000;
            padding-bottom: 20px;
            margin-bottom: 15px;
            position: relative;
        }

        .masthead h1 {
            font-size: 16px;
            font-weight: bold;
            letter-spacing: 3px;
            font-family: Arial, Helvetica, sans-serif;
        }

        .masthead .tagline {
            font-size: 13px;
            font-style: italic;
            margin-top: 8px;
            color: #333;
        }

        .auth-buttons {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .auth-btn {
            padding: 8px 16px;
            background: #000;
            color: #fff;
            border: 2px solid #000;
            font-family: Georgia, serif;
            font-size: 12px;
            cursor: pointer;
            font-weight: bold;
            text-decoration: none;
            transition: all 0.3s;
        }

        .auth-btn:hover {
            background: #fff;
            color: #000;
        }

        .auth-btn.secondary {
            background: #fff;
            color: #000;
        }

        .auth-btn.secondary:hover {
            background: #000;
            color: #fff;
        }

        .user-info {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 12px;
            padding: 8px 16px;
            background: #f0f0f0;
            border: 2px solid #000;
        }

        .user-info strong {
            font-weight: bold;
        }

        .logout-btn {
            margin-left: 10px;
            padding: 4px 10px;
            background: #000;
            color: #fff;
            border: 1px solid #000;
            cursor: pointer;
            font-size: 10px;
        }

        .logout-btn:hover {
            background: #333;
        }

        .edition-info {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            align-items: center;
            font-size: 11px;
            margin-bottom: 20px;
            padding: 5px 0;
            border-bottom: 1px solid #ccc;
        }

        .edition-date {
            font-weight: bold;
            text-align: left;
        }

        .navigation {
            text-align: center;
            font-size: 12px;
            font-weight: bold;
        }

        .navigation a {
            color: #000;
            text-decoration: none;
            padding: 5px 15px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }

        .navigation a:hover {
            border-bottom: 2px solid #000;
        }

        .navigation a.active {
            border-bottom: 2px solid #000;
        }

        .api-status {
            text-align: right;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .search-box-container {
            background: #f9f9f9;
            border: 2px solid #000;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
        }

        .search-box-container h3 {
            font-size: 18px;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .search-input-wrapper {
            display: flex;
            gap: 10px;
            max-width: 600px;
            margin: 0 auto;
        }

        #searchInput {
            flex: 1;
            padding: 12px;
            font-family: Georgia, serif;
            font-size: 14px;
            border: 1px solid #333;
        }

        #searchBtn {
            padding: 12px 30px;
            background: #000;
            color: #fff;
            border: none;
            font-family: Georgia, serif;
            font-size: 14px;
            cursor: pointer;
            font-weight: bold;
        }

        #searchBtn:hover {
            background: #333;
        }

        .quick-queries {
            margin-top: 10px;
            font-size: 11px;
        }

        .quick-queries a {
            color: #000;
            text-decoration: underline;
            margin: 0 10px;
            cursor: pointer;
        }

        .quick-queries a:hover {
            color: #666;
        }

        .columns {
            column-count: 2;
            column-gap: 30px;
            column-rule: 1px solid #ccc;
            text-align: justify;
            line-height: 1.6;
        }

        .headline-main {
            column-span: all;
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
            border-bottom: 3px solid #000;
            padding-bottom: 10px;
        }

        .article {
            break-inside: avoid;
            margin-bottom: 25px;
        }

        .article-headline {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 5px;
            text-align: center;
        }

        .article-byline {
            font-size: 10px;
            font-style: italic;
            color: #666;
            margin-bottom: 8px;
            text-align: center;
        }

        .article-content {
            font-size: 13px;
            line-height: 1.7;
        }

        .classifieds {
            column-span: all;
            background: #fffef0;
            border: 1px solid #000;
            padding: 15px;
            margin-top: 30px;
        }

        .classifieds h3 {
            font-size: 18px;
            text-transform: uppercase;
            text-align: center;
            border-bottom: 2px double #000;
            padding-bottom: 5px;
            margin-bottom: 15px;
        }

        .classifieds-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            font-size: 11px;
        }

        .classified-item {
            border: 1px solid #ccc;
            padding: 10px;
            background: #fff;
        }

        .classified-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .ticker {
            background: #000;
            color: #fff;
            padding: 10px;
            font-size: 11px;
            font-family: 'Courier New', monospace;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            overflow: hidden;
            white-space: nowrap;
        }

        .ticker-content {
            display: inline-block;
            padding-left: 100%;
            animation: ticker 30s linear infinite;
        }

        @keyframes ticker {
            0% { transform: translateX(0); }
            100% { transform: translateX(-100%); }
        }

        .weather-box {
            column-span: all;
            background: #e8e8e8;
            border: 2px solid #000;
            padding: 10px;
            margin: 20px 0;
            text-align: center;
            font-size: 12px;
        }

        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.9);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .loading-overlay.active {
            display: flex;
        }

        .loading-spinner {
            font-size: 24px;
            font-weight: bold;
        }

        /* Knowledge section - newspaper clipping style */
        .knowledge-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        .knowledge-card {
            background: #fffef5; /* Aged paper color */
            border: 2px solid #000;
            padding: 15px;
            box-shadow:
                3px 3px 6px rgba(0,0,0,0.3),
                inset 0 0 20px rgba(0,0,0,0.05);
            position: relative;
            transition: all 0.3s ease;
        }

        .knowledge-card:nth-child(3n+1) {
            transform: rotate(-0.5deg);
        }

        .knowledge-card:nth-child(3n+2) {
            transform: rotate(0.8deg);
        }

        .knowledge-card:nth-child(3n+3) {
            transform: rotate(-1deg);
        }

        .knowledge-card:hover {
            transform: rotate(0deg) scale(1.02);
            box-shadow:
                5px 5px 12px rgba(0,0,0,0.4),
                inset 0 0 30px rgba(0,0,0,0.08);
            z-index: 10;
        }

        .knowledge-card h4 {
            font-size: 16px;
            margin-bottom: 10px;
            text-align: center;
            border-bottom: 2px solid #000;
            padding-bottom: 8px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            background: rgba(0,0,0,0.03);
            margin: -15px -15px 10px -15px;
            padding: 12px 15px 8px 15px;
        }

        .knowledge-card p {
            font-size: 12px;
            line-height: 1.6;
            text-align: justify;
            margin-top: 10px;
        }

        /* Services section */
        .subscription-plans {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 40px;
        }

        .plan-card {
            background: #fffef5;
            border: 3px double #000;
            padding: 20px;
            text-align: center;
            box-shadow: 3px 3px 8px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }

        .plan-card:hover {
            transform: translateY(-5px);
            box-shadow: 5px 5px 15px rgba(0,0,0,0.3);
        }

        .plan-card h3 {
            font-size: 22px;
            margin-bottom: 10px;
            text-transform: uppercase;
            border-bottom: 2px solid #000;
            padding-bottom: 10px;
        }

        .plan-price {
            font-size: 36px;
            font-weight: bold;
            margin: 20px 0;
        }

        .plan-price small {
            font-size: 14px;
            font-weight: normal;
        }

        .plan-features {
            text-align: left;
            margin: 20px 0;
            font-size: 13px;
            line-height: 1.8;
        }

        .plan-features li {
            margin-bottom: 8px;
        }

        .plan-btn {
            width: 100%;
            padding: 12px;
            background: #000;
            color: #fff;
            border: 2px solid #000;
            font-family: Georgia, serif;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
        }

        .plan-btn:hover {
            background: #fff;
            color: #000;
        }

        .services-list {
            display: grid;
            gap: 20px;
        }

        .service-item {
            border-left: 4px solid #000;
            padding-left: 20px;
        }

        .service-item h3 {
            font-size: 18px;
            margin-bottom: 8px;
        }

        .service-item p {
            font-size: 14px;
            line-height: 1.7;
        }

        /* Heatmap for Existing DCs */
        .heatmap-container {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .heatmap-cell {
            background: #f0f0f0;
            border: 1px solid #000;
            padding: 10px;
            text-align: center;
            font-size: 11px;
            transition: all 0.3s;
        }

        .heatmap-cell:hover {
            transform: scale(1.05);
            z-index: 10;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .heatmap-cell.heat-low {
            background: #d4f1d4;
        }

        .heatmap-cell.heat-medium {
            background: #fff4b3;
        }

        .heatmap-cell.heat-high {
            background: #ffcccc;
        }

        .heatmap-cell.heat-extreme {
            background: #ff6666;
            color: #fff;
            font-weight: bold;
        }

        .heatmap-label {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .heatmap-value {
            font-size: 16px;
            font-weight: bold;
        }

        /* Modal System */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: #fffef5;
            border: 4px double #000;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 5px 5px 20px rgba(0,0,0,0.5);
            position: relative;
        }

        .modal-header {
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            border-bottom: 3px solid #000;
            padding-bottom: 10px;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .modal-close {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
            font-weight: bold;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 13px;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px;
            font-family: Georgia, serif;
            font-size: 13px;
            border: 2px solid #000;
            background: #fff;
        }

        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }

        .form-submit {
            width: 100%;
            padding: 12px;
            background: #000;
            color: #fff;
            border: 2px solid #000;
            font-family: Georgia, serif;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
        }

        .form-submit:hover {
            background: #333;
        }

        @media print {
            .search-box-container, .ticker, #searchBtn, .navigation { display: none; }
        }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner">Loading Latest Intelligence...</div>
    </div>

    <div class="newspaper-container">
        <div class="masthead">
            <div class="auth-buttons" id="authButtons">
                <button class="auth-btn secondary" onclick="showLogin()">Sign In</button>
                <button class="auth-btn" onclick="showRegister()">Register</button>
            </div>
            <div class="user-info" id="userInfo" style="display: none;">
                Welcome, <strong id="userName">User</strong>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
            <h1>DC-INTEL DASHBOARD</h1>
            <div class="tagline">"Your Trusted Source for Data Center Brokerage & Market Intelligence"</div>
        </div>

        <div class="edition-info">
            <div class="edition-date">Daily Edition â€¢ <span id="todayDate"></span></div>
            <div class="navigation">
                <a href="#" onclick="window.location.reload(); return false;" class="active" id="navHome">Home</a> |
                <a href="#" onclick="switchSection('knowledge'); return false;" id="navKnowledge">Knowledge</a> |
                <a href="#" onclick="switchSection('services'); return false;" id="navServices">Services</a> |
                <a href="#" onclick="switchSection('existing-dcs'); return false;" id="navExisting">Existing DCs</a> |
                <a href="#" onclick="switchSection('upcoming-dcs'); return false;" id="navUpcoming">Upcoming DCs</a>
            </div>
            <div class="api-status">API Status: <strong id="apiStatus">ONLINE</strong></div>
        </div>

        <!-- HOME SECTION -->
        <div class="content-section active" id="homeSection">
            <div class="search-box-container">
                <h3>DC Intelligence Search Bureau</h3>
                <div class="search-input-wrapper">
                    <input type="text" id="searchInput" placeholder="Search data center projects, operators, locations...">
                    <button id="searchBtn">Search</button>
                </div>
                <div class="quick-queries">
                    Quick Queries:
                    <a onclick="doSearch('hyperscale')">Hyperscale</a> |
                    <a onclick="doSearch('colocation')">Colocation</a> |
                    <a onclick="doSearch('edge computing')">Edge</a> |
                    <a onclick="doSearch('100MW projects')">100MW+</a> |
                    <a onclick="doSearch('latest news')">Latest News</a>
                </div>
            </div>

            <div id="contentArea" class="columns">
                <div class="headline-main" id="dailyHeadline">
                    Data Center Construction Booms Across Nation
                </div>

                <div class="article" id="article1">
                    <div class="article-headline">Loading...</div>
                    <div class="article-byline">DC Intel</div>
                    <div class="article-content">Loading content...</div>
                </div>

                <div class="article" id="article2">
                    <div class="article-headline">Loading...</div>
                    <div class="article-byline">DC Intel</div>
                    <div class="article-content">Loading content...</div>
                </div>

                <div class="weather-box">
                    <strong>DC MARKET HEAT INDEX:</strong> EXTREMELY HOT ðŸ”¥ |
                    <strong>Top Markets:</strong> Ashburn VA, Dallas TX, Phoenix AZ |
                    <strong>Trend:</strong> Accelerating
                </div>
            </div>

            <div class="classifieds" id="classifiedsSection">
                <h3>Professional Services Directory</h3>
                <div class="classifieds-grid" id="classifiedsGrid"></div>
            </div>
        </div>

        <!-- KNOWLEDGE SECTION -->
        <div class="content-section" id="knowledgeSection">
            <h2 style="text-align: center; margin-bottom: 20px; border-bottom: 3px solid #000; padding-bottom: 10px;">Data Center Knowledge Base</h2>
            <input type="text" id="knowledgeSearch" placeholder="Search glossary..." style="width: 100%; padding: 12px; margin-bottom: 20px; border: 2px solid #000; font-family: Georgia, serif;">
            <div class="knowledge-grid" id="knowledgeGrid"></div>
        </div>

        <!-- SERVICES SECTION -->
        <div class="content-section" id="servicesSection">
            <h2 style="text-align: center; margin-bottom: 30px; border-bottom: 3px solid #000; padding-bottom: 10px;">Our Professional Services</h2>

            <h3 style="text-align: center; margin-bottom: 20px; font-size: 20px;">Subscription Plans</h3>
            <div class="subscription-plans">
                <div class="plan-card">
                    <h3>Basic</h3>
                    <div class="plan-price">$499<small>/month</small></div>
                    <ul class="plan-features">
                        <li>âœ“ Access to 50,000 permits</li>
                        <li>âœ“ Basic search & filters</li>
                        <li>âœ“ Weekly email updates</li>
                        <li>âœ“ Export to CSV</li>
                        <li>âœ“ 3 saved searches</li>
                        <li>âœ“ Email support</li>
                    </ul>
                    <button class="plan-btn" onclick="showPremiumData()">Get Started</button>
                </div>
                <div class="plan-card">
                    <h3>Professional</h3>
                    <div class="plan-price">$1,499<small>/month</small></div>
                    <ul class="plan-features">
                        <li>âœ“ Full database access (700K+ permits)</li>
                        <li>âœ“ Advanced analytics</li>
                        <li>âœ“ Daily email alerts</li>
                        <li>âœ“ Export to Excel/PDF</li>
                        <li>âœ“ Unlimited saved searches</li>
                        <li>âœ“ Priority support</li>
                        <li>âœ“ API access (5K calls/mo)</li>
                    </ul>
                    <button class="plan-btn" onclick="showPremiumData()">Get Started</button>
                </div>
                <div class="plan-card">
                    <h3>Enterprise</h3>
                    <div class="plan-price">$4,999<small>/month</small></div>
                    <ul class="plan-features">
                        <li>âœ“ Everything in Professional</li>
                        <li>âœ“ Unlimited API calls</li>
                        <li>âœ“ Custom data feeds</li>
                        <li>âœ“ Dedicated account manager</li>
                        <li>âœ“ White-label options</li>
                        <li>âœ“ Custom integrations</li>
                        <li>âœ“ Quarterly strategy sessions</li>
                    </ul>
                    <button class="plan-btn" onclick="showPremiumData()">Contact Sales</button>
                </div>
            </div>

            <h3 style="text-align: center; margin: 40px 0 20px; font-size: 20px;">All Services</h3>
            <div class="services-list" id="servicesList"></div>
        </div>

        <!-- EXISTING DCS SECTION -->
        <div class="content-section" id="existingDCsSection">
            <h2 style="text-align: center; margin-bottom: 20px; border-bottom: 3px solid #000; padding-bottom: 10px;">Existing Data Centers Database</h2>
            <div id="heatmapViz" class="heatmap-container"></div>
            <div id="existingDCsContent" style="background: #f9f9f9; padding: 20px; border: 2px solid #000;"></div>
        </div>

        <!-- UPCOMING DCS SECTION -->
        <div class="content-section" id="upcomingDCsSection">
            <h2 style="text-align: center; margin-bottom: 20px; border-bottom: 3px solid #000; padding-bottom: 10px;">Upcoming Data Center Projects</h2>
            <p style="text-align: center; margin-bottom: 20px; font-size: 13px;">Tracked from news sources and building permits in cities not yet covered by our direct scrapers</p>

            <h3 style="text-align: center; margin: 20px 0 15px; font-size: 16px;">Regional Distribution</h3>
            <div id="upcomingHeatmap" class="heatmap-container"></div>

            <h3 style="text-align: center; margin: 30px 0 15px; font-size: 16px;">Project Details</h3>
            <div id="upcomingDCsTable" style="background: #f9f9f9; padding: 20px; border: 2px solid #000; overflow-x: auto;"></div>
        </div>
    </div>

    <!-- LOGIN MODAL -->
    <div class="modal-overlay" id="loginModal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal('loginModal')">&times;</span>
            <div class="modal-header">Sign In</div>
            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" name="email" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" name="password" required>
                </div>
                <button type="submit" class="form-submit">Sign In</button>
            </form>
        </div>
    </div>

    <!-- REGISTER MODAL -->
    <div class="modal-overlay" id="registerModal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal('registerModal')">&times;</span>
            <div class="modal-header">Register</div>
            <form id="registerForm" onsubmit="handleRegister(event)">
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" name="name" required>
                </div>
                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" name="email" required>
                </div>
                <div class="form-group">
                    <label>Company</label>
                    <input type="text" name="company" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" name="password" required minlength="8">
                </div>
                <div class="form-group">
                    <label>Confirm Password</label>
                    <input type="password" name="confirm_password" required>
                </div>
                <button type="submit" class="form-submit">Register</button>
            </form>
        </div>
    </div>

    <!-- SERVICE REQUEST MODALS -->
    <div class="modal-overlay" id="serviceModal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal('serviceModal')">&times;</span>
            <div class="modal-header" id="serviceModalTitle">Request Service</div>
            <form id="serviceForm" onsubmit="handleServiceRequest(event)">
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" name="name" required>
                </div>
                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" name="email" required>
                </div>
                <div class="form-group">
                    <label>Company</label>
                    <input type="text" name="company" required>
                </div>
                <div class="form-group">
                    <label>Phone</label>
                    <input type="tel" name="phone">
                </div>
                <div class="form-group">
                    <label>Details</label>
                    <textarea name="details" rows="4" placeholder="Please provide details about your requirements..."></textarea>
                </div>
                <button type="submit" class="form-submit">Submit Request</button>
            </form>
        </div>
    </div>

    <div class="ticker">
        <div class="ticker-content" id="tickerContent">
            LATEST: Google announces Virginia expansion â€¢ AWS Dallas project valued at $500M â€¢ Equinix opens new Ashburn facility â€¢ Microsoft Azure capacity doubles in Phoenix â€¢ QTS reports record quarter â€¢ Switch announces Nevada mega-campus â€¢ Approximately 700,000 permits tracked nationwide â€¢ Over 1,000 confirmed data center projects â€¢ Real-time intelligence via DC Intel API
        </div>
    </div>

    <script>
        const API_BASE = 'http://127.0.0.1:8010';
        const API_KEY = 'keepongoing';

        // Authentication functions
        function showLogin() {
            document.getElementById('loginModal').classList.add('active');
        }

        function showRegister() {
            document.getElementById('registerModal').classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        async function handleLogin(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);

            try {
                const response = await fetch(`${API_BASE}/api/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-API-Key': API_KEY
                    },
                    body: JSON.stringify({
                        email: formData.get('email'),
                        password: formData.get('password')
                    })
                });

                const data = await response.json();

                if (data.ok || data.token) {
                    localStorage.setItem('dc_intel_token', data.token);
                    localStorage.setItem('dc_intel_user', JSON.stringify(data.user));
                    updateAuthUI(data.user);
                    closeModal('loginModal');
                    alert('Welcome back! You have successfully signed in.');
                } else {
                    alert(data.error || 'Login failed. Please check your credentials.');
                }
            } catch (error) {
                console.error('Login error:', error);
                alert('Login failed. This feature requires server implementation.');
            }
        }

        async function handleRegister(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);

            if (formData.get('password') !== formData.get('confirm_password')) {
                alert('Passwords do not match!');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/auth/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-API-Key': API_KEY
                    },
                    body: JSON.stringify({
                        name: formData.get('name'),
                        email: formData.get('email'),
                        company: formData.get('company'),
                        password: formData.get('password')
                    })
                });

                const data = await response.json();

                if (data.ok || data.token) {
                    localStorage.setItem('dc_intel_token', data.token);
                    localStorage.setItem('dc_intel_user', JSON.stringify(data.user));
                    updateAuthUI(data.user);
                    closeModal('registerModal');
                    alert('Registration successful! Welcome to DC Intel.');
                } else {
                    alert(data.error || 'Registration failed. Please try again.');
                }
            } catch (error) {
                console.error('Registration error:', error);
                alert('Registration failed. This feature requires server implementation.');
            }
        }

        function logout() {
            localStorage.removeItem('dc_intel_token');
            localStorage.removeItem('dc_intel_user');
            updateAuthUI(null);
            alert('You have been logged out.');
        }

        function updateAuthUI(user) {
            const authButtons = document.getElementById('authButtons');
            const userInfo = document.getElementById('userInfo');

            if (user) {
                authButtons.style.display = 'none';
                userInfo.style.display = 'block';
                document.getElementById('userName').textContent = user.name || user.email;
            } else {
                authButtons.style.display = 'flex';
                userInfo.style.display = 'none';
            }
        }

        // Check for existing session on load
        (function checkAuth() {
            const token = localStorage.getItem('dc_intel_token');
            const userStr = localStorage.getItem('dc_intel_user');
            if (token && userStr) {
                try {
                    const user = JSON.parse(userStr);
                    updateAuthUI(user);
                } catch (e) {
                    localStorage.removeItem('dc_intel_token');
                    localStorage.removeItem('dc_intel_user');
                }
            }
        })();

        // Set today's date
        function updateDate() {
            const dateStr = new Date().toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            document.getElementById('todayDate').textContent = dateStr;
            document.querySelectorAll('.article-date').forEach(el => {
                el.textContent = new Date().toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
            });
        }
        updateDate();

        // Generate daily rotating content
        function generateDailyContent() {
            const dayOfYear = Math.floor((new Date() - new Date(new Date().getFullYear(), 0, 0)) / 1000 / 60 / 60 / 24);

            // Headlines (rotate daily)
            const headlines = [
                "Data Center Construction Booms Across Nation",
                "Northern Virginia Maintains DC Dominance",
                "Hyperscale Investment Reaches Record Highs",
                "AI Drives Unprecedented DC Capacity Demand",
                "Power Constraints Shape New DC Strategies",
                "Colocation Market Shows Strong Growth",
                "Edge Computing Deployments Accelerate"
            ];
            document.getElementById('dailyHeadline').textContent = headlines[dayOfYear % headlines.length];

            // Article templates - MIX of industry trends and services
            const articles = [
                {
                    headline: "Edge Computing Revolution Transforms DC Strategy",
                    byline: "By The DC Intel Technology Desk",
                    content: "The rapid proliferation of edge computing is reshaping traditional data center deployment strategies. Industry leaders are increasingly adopting hybrid architectures that combine centralized hyperscale facilities with distributed edge nodes to minimize latency for real-time applications. This transformation is particularly evident in sectors like autonomous vehicles, IoT, and streaming media where millisecond response times are critical. Analysts project edge infrastructure investment will exceed $200B globally by 2028.",
                    type: "industry"
                },
                {
                    headline: "Hyperscale Operators Expand Footprint",
                    byline: "Market Intelligence Desk",
                    content: "Major cloud providers including Google, Amazon Web Services, and Microsoft are executing aggressive expansion strategies across key markets. Northern Virginia, Dallas, and Silicon Valley remain hotspots for new development, with average project valuations exceeding $100M for hyperscale facilities. The AI revolution is accelerating capacity demands, with some operators doubling their footprint annually to meet unprecedented workload growth.",
                    type: "industry"
                },
                {
                    headline: "Market Intelligence Services",
                    byline: "Intelligence Services",
                    content: "DC Intel provides comprehensive market intelligence and brokerage services including real-time permit tracking, site selection consulting, operator monitoring, and transaction advisory. Our platform aggregates nationwide construction data and over 1,000 confirmed data center projects across the United States with daily updates. Our team has facilitated over $2B in data center deals. Don't see your city? Request coverage here. Contact our experts for exclusive deal flow access and personalized guidance.",
                    type: "services"
                },
                {
                    headline: "Northern Virginia: Global DC Epicenter",
                    byline: "Regional Correspondent",
                    content: "The Ashburn-Loudoun County corridor in Northern Virginia continues as the undisputed global epicenter of data center development. With over 200 operational facilities and pipeline projects exceeding 2,000 MW, the region benefits from unparalleled fiber connectivity, reliable power infrastructure, and proximity to federal government demand. Recent permit data shows no signs of slowing, with major hyperscale operators announcing multi-billion dollar expansion plans through 2027.",
                    type: "industry"
                },
                {
                    headline: "Power Infrastructure Challenges Mount",
                    byline: "Infrastructure Analysis Team",
                    content: "As data center power requirements surge past 100MW per facility for hyperscale projects, grid constraints are becoming the primary limiting factor in several major markets. Developers increasingly face multi-year wait times for utility connections, driving innovation in on-site generation, battery storage, and renewable energy solutions. Markets with proactive utility planning like Texas and Arizona are gaining competitive advantages, attracting billions in new investment.",
                    type: "industry"
                },
                {
                    headline: "DC Intel Brokerage & Advisory",
                    byline: "Business Development",
                    content: "DC Intel offers comprehensive brokerage services covering facility acquisitions, wholesale capacity leasing, site selection, and strategic advisory. Our team combines deep market knowledge with proprietary intelligence tools including real-time permit tracking, valuation analytics, and competitive monitoring. We provide clients unparalleled access to off-market opportunities and emerging markets. Contact us today to discuss your data center requirements and investment strategies.",
                    type: "services"
                }
            ];

            // Show one industry article and one services article, rotating
            const industryArticles = articles.filter(a => a.type === "industry");
            const servicesArticles = articles.filter(a => a.type === "services");

            const industryIndex = dayOfYear % industryArticles.length;
            const servicesIndex = dayOfYear % servicesArticles.length;

            // Alternate which appears first
            const firstArticle = dayOfYear % 2 === 0 ? industryArticles[industryIndex] : servicesArticles[servicesIndex];
            const secondArticle = dayOfYear % 2 === 0 ? servicesArticles[servicesIndex] : industryArticles[industryIndex];

            document.getElementById('article1').innerHTML = `
                <div class="article-headline">${firstArticle.headline}</div>
                <div class="article-byline">${firstArticle.byline} â€¢ <span class="article-date"></span></div>
                <div class="article-content">${firstArticle.content}</div>
            `;

            document.getElementById('article2').innerHTML = `
                <div class="article-headline">${secondArticle.headline}</div>
                <div class="article-byline">${secondArticle.byline}</div>
                <div class="article-content">${secondArticle.content}</div>
            `;

            updateDate(); // Update article dates

            // Rotate classified services daily
            const classifiedServices = [
                {
                    title: "BROKERAGE: Buy/Sell/Lease DC Facilities",
                    desc: "Expert representation for data center transactions. Market knowledge. Optimal terms. Contact DC Intel Brokerage Services."
                },
                {
                    title: "MARKET INTELLIGENCE: Real-Time Data",
                    desc: "Comprehensive permit tracking, 1,000+ confirmed DC projects nationwide, daily updates. API access available. Premium analytics. Request new city coverage anytime."
                },
                {
                    title: "SITE SELECTION: Expert Consulting",
                    desc: "Comprehensive location analysis. Power availability. Connectivity. Tax incentives. Risk assessment. Enterprise solutions."
                },
                {
                    title: "DUE DILIGENCE: Asset Assessment",
                    desc: "Technical and financial review of DC assets. Infrastructure analysis. Lease evaluation. Operational benchmarking."
                },
                {
                    title: "CUSTOM REPORTS: Tailored Intelligence",
                    desc: "Weekly, monthly, or ad-hoc research covering specific markets, operators, or project types. Executive summaries with actionable insights."
                },
                {
                    title: "STRATEGIC ADVISORY: High-Level Guidance",
                    desc: "DC strategy, capacity planning, market entry, portfolio optimization. Decades of combined industry experience."
                },
                {
                    title: "ADVISORY SERVICES: Full-Spectrum Support",
                    desc: "Comprehensive advisory covering facility planning, operator selection, contract negotiation, and ongoing optimization. Your trusted partner for all DC decisions."
                }
            ];

            // Show 4 services per day, rotating
            const startIdx = (dayOfYear * 2) % classifiedServices.length;
            const displayedServices = [];
            for (let i = 0; i < 4; i++) {
                displayedServices.push(classifiedServices[(startIdx + i) % classifiedServices.length]);
            }

            document.getElementById('classifiedsGrid').innerHTML = displayedServices.map(s => `
                <div class="classified-item">
                    <div class="classified-title">${s.title}</div>
                    <div>${s.desc}</div>
                </div>
            `).join('');
        }
        generateDailyContent();

        // Section switching
        function switchSection(section) {
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.navigation a').forEach(n => n.classList.remove('active'));

            document.getElementById(section + 'Section').classList.add('active');
            const navId = 'nav' + section.charAt(0).toUpperCase() + section.slice(1).replace(/-./g, x => x[1].toUpperCase());
            const navEl = document.getElementById(navId);
            if (navEl) navEl.classList.add('active');

            if (section === 'knowledge') loadKnowledge();
            if (section === 'services') loadServices();
            if (section === 'existing-dcs') loadExistingDCs();
            if (section === 'upcoming-dcs') loadUpcomingDCs();

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Knowledge base - load from API
        async function loadKnowledge() {
            try {
                // Try to load from API first
                const response = await fetch(`${API_BASE}/knowledge/glossary`, {
                    headers: { 'X-API-Key': API_KEY }
                });

                let knowledge = [];

                if (response.ok) {
                    const data = await response.json();
                    if (data.glossary && Array.isArray(data.glossary)) {
                        knowledge = data.glossary.map(item => ({
                            term: item.Term || item.term,
                            def: item.Definition || item.definition || item.def
                        }));
                    }
                }

                // Fallback to hardcoded if API fails or returns nothing
                if (knowledge.length === 0) {
                    knowledge = [
                        { term: "Colocation", def: "A data center facility where multiple companies rent space for their servers and equipment. Typically offers shared infrastructure including power, cooling, and connectivity." },
                        { term: "Hyperscale", def: "Massive data centers (typically 100MW+) operated by tech giants like Google, Amazon, Microsoft. Characterized by thousands of servers and enormous power requirements." },
                        { term: "Edge Computing", def: "Distributed computing infrastructure placed closer to end-users for lower latency. Typically smaller facilities in metro areas or near content consumers." },
                        { term: "Power Usage Effectiveness (PUE)", def: "Ratio measuring data center energy efficiency. Calculated as total facility energy divided by IT equipment energy. Lower is better, with 1.0 being ideal." },
                        { term: "Tier Rating", def: "Classification system (I-IV) indicating data center reliability and redundancy levels. Tier IV represents highest availability with fully redundant systems." },
                        { term: "Critical Power", def: "The maximum IT load a data center can support, measured in watts or megawatts. Determines capacity available for servers and networking equipment." },
                        { term: "Uptime", def: "Percentage of time a data center remains operational. Tier IV targets 99.995% uptime, allowing only 26 minutes downtime per year." },
                        { term: "Hot Aisle/Cold Aisle", def: "Server layout design optimizing cooling efficiency by separating hot exhaust air from cold intake air, reducing energy consumption." },
                        { term: "Cross-Connect", def: "Physical cable connecting different customer equipment within a colocation facility, enabling direct private connectivity between parties." }
                    ];
                }

                document.getElementById('knowledgeGrid').innerHTML = knowledge.map(k => `
                    <div class="knowledge-card">
                        <h4>${k.term}</h4>
                        <p>${k.def}</p>
                    </div>
                `).join('');

                // Search functionality
                document.getElementById('knowledgeSearch').addEventListener('input', function() {
                    const search = this.value.toLowerCase();
                    document.querySelectorAll('.knowledge-card').forEach(card => {
                        const text = card.textContent.toLowerCase();
                        card.style.display = text.includes(search) ? 'block' : 'none';
                    });
                });

            } catch (error) {
                console.error('Error loading knowledge:', error);
                // Use fallback data
                loadKnowledge();
            }
        }

        // Services - All 17 services
        function loadServices() {
            const services = [
                { name: "Data Center Brokerage", desc: "Expert representation for buying, selling, or leasing data center facilities and capacity. Our team leverages extensive market knowledge and relationships to secure optimal terms for clients. We handle facility acquisitions, wholesale capacity transactions, and strategic advisory." },
                { name: "Market Intelligence Platform", desc: "Real-time access to our comprehensive database of permits and over 1,000 confirmed data center projects across the United States. Includes permit tracking, valuation data, trend analysis, operator monitoring, and competitive intelligence. Don't see your city? Request coverage - we can add new markets to serve your needs." },
                { name: "Site Selection Consulting", desc: "Comprehensive analysis of potential DC locations considering power availability, fiber connectivity, tax incentives, risk factors, and market dynamics. We identify optimal sites aligned with your technical and financial requirements." },
                { name: "Due Diligence Services", desc: "Technical and financial assessment of DC assets including infrastructure review, lease analysis, operational benchmarking, and risk evaluation. Supports informed decision-making for acquisitions and investments." },
                { name: "Custom Market Reports", desc: "Tailored research deliverables covering specific markets, operators, or project types. Available in weekly, monthly, or ad-hoc formats. Includes executive summaries, detailed analytics, and actionable recommendations." },
                { name: "Strategic Advisory", desc: "High-level guidance on DC strategy, capacity planning, market entry, portfolio optimization, and investment decisions. Our advisors bring decades of combined industry experience." },
                { name: "DC Matchmaking Service", desc: "Connect buyers and sellers in the data center market. We match your specific requirements with available facilities, capacity, or development opportunities. Comprehensive screening, qualification, and negotiation support.", link: "showDCMatchmaking" },
                { name: "Lead Referral Program", desc: "Earn commissions by referring qualified data center opportunities. We handle the full transaction process while you earn industry-leading referral fees. Perfect for consultants, brokers, and industry professionals.", link: "showLeadReferral" },
                { name: "Premium Data Access", desc: "Advanced access to our full database with custom filtering, export capabilities, and API integration. Includes detailed project timelines, contractor information, and historical trend analysis.", link: "showPremiumData" },
                { name: "API Integration", desc: "Integrate DC Intel data directly into your systems via our RESTful API. Real-time permit updates, search capabilities, and webhook notifications. Multiple tier options available.", link: "showAPIAccess" },
                { name: "RFQ Management", desc: "Streamlined request for quotation process for data center capacity. Submit requirements once and receive competitive proposals from multiple providers. We manage the entire RFQ lifecycle.", link: "showRFQManagement" },
                { name: "Email Alerts & Notifications", desc: "Receive instant notifications when new projects match your criteria. Configure custom alerts for specific markets, operators, project sizes, or other parameters.", link: "showEmailAlerts" },
                { name: "Request Coverage Expansion", desc: "Don't see your city or region? Request us to add coverage for new markets. We prioritize expansion based on customer demand and can add new jurisdictions within 30-60 days.", link: "showRequestCoverage" },
                { name: "Construction Timeline Predictions", desc: "AI-powered forecasting of project timelines based on historical permit data, contractor schedules, and market conditions. Predict when facilities will come online." },
                { name: "DC Comparison Tool", desc: "Side-by-side comparison of multiple data center projects including specifications, locations, costs, and timelines. Export detailed comparison reports." },
                { name: "Demand Heatmap Analytics", desc: "Visual analysis of data center demand and supply by geography. Identify underserved markets, saturation zones, and emerging opportunities." },
                { name: "Sponsored Listings", desc: "Promote your data center project, available capacity, or services to our audience of industry professionals, investors, and enterprise buyers." }
            ];

            document.getElementById('servicesList').innerHTML = services.map(s => `
                <div class="service-item">
                    <h3>${s.name}${s.link ? ' <a href="#" onclick="' + s.link + '(); return false;" style="font-size: 12px; color: #000; text-decoration: underline;">[Request Service]</a>' : ''}</h3>
                    <p>${s.desc}</p>
                </div>
            `).join('');
        }

        // Existing DCs with heatmap visualization
        async function loadExistingDCs() {
            try {
                const response = await fetch(`${API_BASE}/rollups/addresses?limit=100`, {
                    headers: { 'X-API-Key': API_KEY }
                });
                const data = await response.json();

                if (!data.ok || !data.rollups) {
                    document.getElementById('existingDCsContent').innerHTML = '<p style="text-align: center;">Unable to load data centers. Please ensure API server is running.</p>';
                    return;
                }

                // Generate heatmap by state
                const stateData = {};
                data.rollups.forEach(item => {
                    const state = item.state || item.State || 'Unknown';
                    if (!stateData[state]) {
                        stateData[state] = { count: 0, valuation: 0 };
                    }
                    stateData[state].count++;
                    stateData[state].valuation += (item.latest_valuation_usd || item.TotalValuation || 0);
                });

                // Sort states by project count
                const sortedStates = Object.entries(stateData)
                    .sort((a, b) => b[1].count - a[1].count)
                    .slice(0, 15);

                // Determine heat levels
                const maxCount = Math.max(...sortedStates.map(s => s[1].count));

                let heatmapHTML = '<h3 style="text-align: center; margin-bottom: 15px;">Market Activity Heat Map</h3>';
                heatmapHTML += '<div class="heatmap-container">';

                sortedStates.forEach(([state, stats]) => {
                    const intensity = stats.count / maxCount;
                    let heatClass = 'heat-low';
                    if (intensity > 0.75) heatClass = 'heat-extreme';
                    else if (intensity > 0.5) heatClass = 'heat-high';
                    else if (intensity > 0.25) heatClass = 'heat-medium';

                    heatmapHTML += `
                        <div class="heatmap-cell ${heatClass}">
                            <div class="heatmap-label">${state}</div>
                            <div class="heatmap-value">${stats.count}</div>
                            <div style="font-size: 9px;">projects</div>
                        </div>
                    `;
                });
                heatmapHTML += '</div>';
                document.getElementById('heatmapViz').innerHTML = heatmapHTML;

                // Generate table
                let html = '<h3 style="text-align: center; margin-bottom: 15px;">Recent DC Projects</h3>';
                html += '<table style="width: 100%; border-collapse: collapse; font-size: 12px;">';
                html += '<tr style="background: #000; color: #fff;"><th style="padding: 8px; text-align: left;">Address</th><th style="padding: 8px; text-align: left;">City</th><th style="padding: 8px; text-align: left;">State</th><th style="padding: 8px; text-align: right;">Valuation</th><th style="padding: 8px; text-align: center;">Permits</th></tr>';

                data.rollups.slice(0, 50).forEach((item, idx) => {
                    const bg = idx % 2 === 0 ? '#fff' : '#f9f9f9';
                    const address = item.address_raw || item.Address || 'Unknown';
                    const city = item.city || item.City || 'N/A';
                    const state = item.state || item.State || 'N/A';
                    const valuation = item.latest_valuation_usd || item.TotalValuation || 0;
                    const permits = item.permits_count || item.PermitCount || 0;

                    html += `<tr style="background: ${bg}; border-bottom: 1px solid #ccc;">
                        <td style="padding: 8px;">${address}</td>
                        <td style="padding: 8px;">${city}</td>
                        <td style="padding: 8px;">${state}</td>
                        <td style="padding: 8px; text-align: right;">$${valuation.toLocaleString()}</td>
                        <td style="padding: 8px; text-align: center;">${permits}</td>
                    </tr>`;
                });

                html += '</table>';
                document.getElementById('existingDCsContent').innerHTML = html;

            } catch (error) {
                console.error('Error loading DCs:', error);
                document.getElementById('existingDCsContent').innerHTML = '<p style="text-align: center;">Error loading data. Please check API connection.</p>';
            }
        }

        // Load Upcoming DCs
        async function loadUpcomingDCs() {
            try {
                const response = await fetch(`${API_BASE}/upcoming_dcs`, {
                    headers: { 'X-API-Key': API_KEY }
                });

                if (!response.ok) {
                    document.getElementById('upcomingDCsTable').innerHTML = '<p style="text-align: center;">Unable to load upcoming DC projects. Data may not be available yet.</p>';
                    return;
                }

                const data = await response.json();

                if (!data.projects || data.projects.length === 0) {
                    document.getElementById('upcomingDCsTable').innerHTML = '<p style="text-align: center;">No upcoming DC projects found.</p>';
                    return;
                }

                // Generate regional heatmap
                const regionData = {};
                data.projects.forEach(project => {
                    const region = project.region || project.state || 'Unknown';
                    if (!regionData[region]) {
                        regionData[region] = 0;
                    }
                    regionData[region]++;
                });

                const sortedRegions = Object.entries(regionData)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 10);

                const maxCount = Math.max(...sortedRegions.map(r => r[1]));

                let heatmapHTML = '<div class="heatmap-container">';
                sortedRegions.forEach(([region, count]) => {
                    const intensity = count / maxCount;
                    let heatClass = 'heat-low';
                    if (intensity > 0.75) heatClass = 'heat-extreme';
                    else if (intensity > 0.5) heatClass = 'heat-high';
                    else if (intensity > 0.25) heatClass = 'heat-medium';

                    heatmapHTML += `
                        <div class="heatmap-cell ${heatClass}">
                            <div class="heatmap-label">${region}</div>
                            <div class="heatmap-value">${count}</div>
                            <div style="font-size: 9px;">projects</div>
                        </div>
                    `;
                });
                heatmapHTML += '</div>';
                document.getElementById('upcomingHeatmap').innerHTML = heatmapHTML;

                // Generate project table
                let tableHTML = '<table style="width: 100%; border-collapse: collapse; font-size: 12px;">';
                tableHTML += '<tr style="background: #000; color: #fff;">';
                tableHTML += '<th style="padding: 8px; text-align: left;">Location</th>';
                tableHTML += '<th style="padding: 8px; text-align: left;">Operator</th>';
                tableHTML += '<th style="padding: 8px; text-align: left;">Capacity</th>';
                tableHTML += '<th style="padding: 8px; text-align: left;">Status</th>';
                tableHTML += '<th style="padding: 8px; text-align: left;">Source</th>';
                tableHTML += '<th style="padding: 8px; text-align: center;">Covered</th>';
                tableHTML += '</tr>';

                data.projects.forEach((project, idx) => {
                    const bg = idx % 2 === 0 ? '#fff' : '#f9f9f9';
                    const location = project.location || project.city || 'Unknown';
                    const operator = project.operator || 'Unknown';
                    const capacity = project.capacity || 'N/A';
                    const status = project.status || 'Announced';
                    const source = project.source_type || 'News';
                    const isCovered = project.is_covered || false;

                    tableHTML += `<tr style="background: ${bg}; border-bottom: 1px solid #ccc;">
                        <td style="padding: 8px;">${location}</td>
                        <td style="padding: 8px;">${operator}</td>
                        <td style="padding: 8px;">${capacity}</td>
                        <td style="padding: 8px;">${status}</td>
                        <td style="padding: 8px;">${source}</td>
                        <td style="padding: 8px; text-align: center;">${isCovered ? '<span style="background: #d4f1d4; padding: 2px 8px; border-radius: 3px;">Yes</span>' : '<span style="background: #ffcccc; padding: 2px 8px; border-radius: 3px;">No</span>'}</td>
                    </tr>`;
                });

                tableHTML += '</table>';
                document.getElementById('upcomingDCsTable').innerHTML = tableHTML;

            } catch (error) {
                console.error('Error loading upcoming DCs:', error);
                document.getElementById('upcomingDCsTable').innerHTML = '<p style="text-align: center;">Error loading data. Please check API connection.</p>';
            }
        }

        // Search functions
        function showLoading() {
            document.getElementById('loadingOverlay').classList.add('active');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('active');
        }

        async function doSearch(query) {
            if (!query) query = document.getElementById('searchInput').value.trim();
            if (!query) {
                alert('Please enter a search query');
                return;
            }

            // Make sure we're on home section
            switchSection('home');

            document.getElementById('searchInput').value = query;
            showLoading();

            try {
                const response = await fetch(`${API_BASE}/ask_v2`, {
                    method: 'POST',
                    headers: {
                        'X-API-Key': API_KEY,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ q: query })
                });

                const data = await response.json();
                hideLoading();

                if (!data.ok) {
                    alert('Search failed. Please try again.');
                    return;
                }

                displayResults(data, query);

            } catch (error) {
                hideLoading();
                alert('API Error: ' + error.message + '\n\nMake sure server is running on http://127.0.0.1:8010');
                document.getElementById('apiStatus').textContent = 'OFFLINE';
                document.getElementById('apiStatus').style.color = 'red';
            }
        }

        function displayResults(data, query) {
            const contentArea = document.getElementById('contentArea');
            let html = `<div class="headline-main">Search Results: "${query}"</div>`;

            // Service inquiry response
            if (data.intent === 'SERVICE_INQUIRY' && data.response) {
                html += `
                    <div class="article">
                        <div class="article-headline">DC Intel Services</div>
                        <div class="article-byline">Intelligence Desk</div>
                        <div class="article-content">${data.response}</div>
                    </div>
                `;
            }

            // Rollup/facility results
            if (data.rollups && data.rollups.total > 0) {
                const items = data.rollups.items.slice(0, 12);
                items.forEach((item, idx) => {
                    // Handle both field naming conventions
                    const address = item.address_raw || item.Address || 'Unknown Location';
                    const city = item.city || item.City || 'N/A';
                    const state = item.state || item.State || 'N/A';
                    const description = item.latest_description || item.Description || 'No description available';
                    const valuation = item.latest_valuation_usd || item.TotalValuation || 0;
                    const permitCount = item.permits_count || item.PermitCount || 0;
                    const latestDate = item.last_seen_applied_date || item.LatestDate || 'N/A';

                    html += `
                        <div class="article">
                            <div class="article-headline">${idx + 1}. ${address}</div>
                            <div class="article-byline">${city}, ${state} â€¢ Valuation: $${valuation.toLocaleString()}</div>
                            <div class="article-content">
                                ${description.substring(0, 200)}...
                                <br><strong>Permits:</strong> ${permitCount} |
                                <strong>Latest:</strong> ${latestDate}
                            </div>
                        </div>
                    `;
                });
            }

            // News results
            if (data.news && data.news.total > 0) {
                const newsItems = data.news.items.slice(0, 6);
                newsItems.forEach((item) => {
                    html += `
                        <div class="article">
                            <div class="article-headline">${item.Title || item.Headline || 'News Article'}</div>
                            <div class="article-byline">Published: ${item.PublishedDate || item.Date || 'Unknown'}</div>
                            <div class="article-content">
                                ${item.Summary || item.Snippet || 'No summary available.'}
                            </div>
                        </div>
                    `;
                });
            }

            // No results
            if ((!data.rollups || data.rollups.total === 0) &&
                (!data.news || data.news.total === 0) &&
                data.intent !== 'SERVICE_INQUIRY') {
                html += `
                    <div class="article">
                        <div class="article-headline">No Results Found</div>
                        <div class="article-content">
                            No matching facilities or news articles found for your query.
                            Try refining your search terms or use one of the quick query links above.
                        </div>
                    </div>
                `;
            }

            contentArea.innerHTML = html;
            contentArea.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Search event listeners
        document.getElementById('searchBtn').addEventListener('click', () => doSearch());
        document.getElementById('searchInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') doSearch();
        });

        // Service request functions
        function showServiceModal(serviceName) {
            document.getElementById('serviceModalTitle').textContent = serviceName;
            document.getElementById('serviceModal').classList.add('active');
            document.getElementById('serviceForm').reset();
        }

        function showPremiumData() {
            showServiceModal('Premium Data Access Request');
        }

        function showDCMatchmaking() {
            showServiceModal('DC Matchmaking Service Request');
        }

        function showLeadReferral() {
            showServiceModal('Lead Referral Program Enrollment');
        }

        function showAPIAccess() {
            showServiceModal('API Integration Request');
        }

        function showRFQManagement() {
            showServiceModal('RFQ Management Request');
        }

        function showEmailAlerts() {
            showServiceModal('Email Alerts Configuration');
        }

        function showRequestCoverage() {
            showServiceModal('Request Coverage Expansion');
        }

        async function handleServiceRequest(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            const serviceName = document.getElementById('serviceModalTitle').textContent;

            const requestData = {
                service: serviceName,
                name: formData.get('name'),
                email: formData.get('email'),
                company: formData.get('company'),
                phone: formData.get('phone'),
                details: formData.get('details')
            };

            try {
                const response = await fetch(`${API_BASE}/api/service_request`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-API-Key': API_KEY
                    },
                    body: JSON.stringify(requestData)
                });

                const data = await response.json();

                if (data.ok || response.ok) {
                    alert('Thank you! Your service request has been submitted. We will contact you within 24 hours.');
                    closeModal('serviceModal');
                } else {
                    alert('Request submitted locally. Our team will review and respond soon.');
                    closeModal('serviceModal');
                }
            } catch (error) {
                console.error('Service request error:', error);
                alert('Request submitted. We will contact you at the email address provided.');
                closeModal('serviceModal');
            }
        }

        // Check API status on load
        fetch(`${API_BASE}/rollups/addresses?limit=1`, {
            headers: { 'X-API-Key': API_KEY }
        })
        .then(res => {
            if (res.ok) {
                document.getElementById('apiStatus').textContent = 'ONLINE';
                document.getElementById('apiStatus').style.color = 'green';
            }
        })
        .catch(() => {
            document.getElementById('apiStatus').textContent = 'OFFLINE';
            document.getElementById('apiStatus').style.color = 'red';
        });
    </script>
</body>
</html>
