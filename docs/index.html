   <!DOCTYPE html>
<!-- Updated: Dec 9, 2025 - CRITICAL FIX: onclick handlers (single quotes) + 3-state Source toggle + YYYY-MM-DD date sorting -->
<!-- This fix resolves "Unexpected end of input" syntax error when clicking column headers -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DataCenter Hive Dashboard</title>
    <link rel="icon" type="image/png" href="9e224nbi.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #f5f5dc;
            font-family: Georgia, 'Times New Roman', Times, serif;
            color: #000;
            padding: 20px;
        }

        .newspaper-container {
            max-width: 1200px;
            margin: 0 auto;
            background: #fff;
            padding: 40px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .masthead {
            border-bottom: 4px double #000;
            padding-bottom: 20px;
            margin-bottom: 15px;
            position: relative;
        }

        .masthead-header {
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: space-between;
            padding: 10px 20px 15px 20px;
            position: relative;
        }

        .masthead-logo {
            height: 120px;
            width: auto;
            max-width: 220px;
            object-fit: contain;
            object-position: left center;
            flex-shrink: 0;
            padding: 6px;
            box-shadow: 0 0 0 3px #f7f7f0, 0 0 0 5px #000;
        }

        .masthead-title-group {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            text-align: center;
        }

        .masthead h1 {
            font-size: 32px;
            font-weight: bold;
            letter-spacing: 3px;
            font-family: Georgia, 'Times New Roman', serif;
            margin: 0;
            color: #1a1a1a;
        }

        .masthead .tagline {
            font-size: 13px;
            font-style: italic;
            margin-top: 8px;
            color: #333;
        }

        .auth-buttons {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            flex-direction: row;
            gap: 10px;
            z-index: 10000;
        }

        .auth-btn {
            padding: 8px 16px;
            background: #000;
            color: #fff;
            border: 2px solid #000;
            font-family: Georgia, serif;
            font-size: 12px;
            cursor: pointer;
            font-weight: bold;
            text-decoration: none;
            transition: all 0.3s;
        }

        .auth-btn:hover {
            background: #fff;
            color: #000;
        }

        .auth-btn.secondary {
            background: #fff;
            color: #000;
        }

        .auth-btn.secondary:hover {
            background: #000;
            color: #fff;
        }

        .user-info {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 12px;
            padding: 8px 16px;
            background: #f0f0f0;
            border: 2px solid #000;
            z-index: 10001;
        }

        .user-info strong {
            font-weight: bold;
        }

        .logout-btn {
            margin-left: 10px;
            padding: 4px 10px;
            background: #000;
            color: #fff;
            border: 1px solid #000;
            cursor: pointer;
            font-size: 10px;
        }

        .logout-btn:hover {
            background: #333;
        }

        .edition-info {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            align-items: center;
            font-size: 11px;
            margin-bottom: 20px;
            padding: 5px 0;
            border-bottom: 1px solid #ccc;
            gap: 10px;
        }

        .edition-date {
            font-weight: bold;
            text-align: left;
        }

        .navigation {
            text-align: center;
            font-size: 12px;
            font-weight: bold;
        }

        .navigation a {
            color: #000;
            text-decoration: none;
            padding: 5px 15px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            font-weight: 600;
        }

        .navigation a:hover {
            border-bottom: 2px solid #000;
        }

        .navigation a.active {
            border-bottom: 3px solid #000;
            font-weight: 700;
        }

        .api-status {
            text-align: right;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .search-box-container {
            background: #f9f9f9;
            border: 2px solid #000;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
        }

        .search-box-container h3 {
            font-size: 18px;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .search-input-wrapper {
            display: flex;
            gap: 10px;
            max-width: 600px;
            margin: 0 auto;
        }

        #searchInput {
            flex: 1;
            padding: 12px;
            font-family: Georgia, serif;
            font-size: 14px;
            border: 1px solid #333;
        }

        #searchBtn {
            padding: 12px 30px;
            background: #000;
            color: #fff;
            border: none;
            font-family: Georgia, serif;
            font-size: 14px;
            cursor: pointer;
            font-weight: bold;
        }

        #searchBtn:hover {
            background: #333;
        }

        .quick-queries {
            margin-top: 10px;
            font-size: 11px;
        }

        .quick-queries a {
            color: #000;
            text-decoration: underline;
            margin: 0 10px;
            cursor: pointer;
        }

        .quick-queries a:hover {
            color: #666;
        }

        .columns {
            column-count: 2;
            column-gap: 0;
            column-rule: none;
            text-align: justify;
            line-height: 1.6;
        }

        .headline-main {
            column-span: all;
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
            border-bottom: 3px solid #000;
            padding-bottom: 10px;
        }

        .article {
            break-inside: avoid;
            margin-bottom: 25px;
            border: 2px solid #000;
            padding: 15px;
            background: #fffef8;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
        }

        .article-headline {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 5px;
            text-align: center;
        }

        .article-byline {
            font-size: 10px;
            font-style: italic;
            color: #666;
            margin-bottom: 8px;
            text-align: center;
        }

        .article-content {
            font-size: 13px;
            line-height: 1.7;
        }

        .classifieds {
            column-span: all;
            background: #fffef0;
            border: 1px solid #000;
            padding: 15px;
            margin-top: 30px;
        }

        .classifieds h3 {
            font-size: 18px;
            text-transform: uppercase;
            text-align: center;
            border-bottom: 2px double #000;
            padding-bottom: 5px;
            margin-bottom: 15px;
        }

        .classifieds-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            font-size: 11px;
        }

        .classified-item {
            border: 1px solid #ccc;
            padding: 10px;
            background: #fff;
            cursor: pointer;
            transition: all 0.3s;
        }

        .classified-item:hover {
            background: #f0f0f0;
            border-color: #000;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .classified-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        /* Modal Popup Styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 9999;
            justify-content: center;
            align-items: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: #fff;
            padding: 40px;
            max-width: 600px;
            width: 90%;
            border: 4px solid #000;
            position: relative;
            font-family: Georgia, serif;
        }

        .modal-close {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 30px;
            cursor: pointer;
            background: none;
            border: none;
            font-weight: bold;
            z-index: 10001;
            color: #000;
            line-height: 1;
            padding: 5px 10px;
            user-select: none;
        }

        .modal-close:hover {
            color: #999;
            transform: scale(1.1);
        }

        .modal-content h2 {
            font-size: 24px;
            margin-bottom: 20px;
            border-bottom: 2px solid #000;
            padding-bottom: 10px;
        }

        .modal-content ul {
            list-style: disc;
            margin-left: 20px;
            margin-bottom: 20px;
            line-height: 1.8;
        }

        .modal-btn {
            background: #000;
            color: #fff;
            padding: 12px 30px;
            border: 2px solid #000;
            font-family: Georgia, serif;
            font-size: 14px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 20px;
        }

        .modal-btn:hover {
            background: #fff;
            color: #000;
        }

        .ticker {
            background: #000;
            color: #fff;
            padding: 10px;
            font-size: 11px;
            font-family: 'Courier New', monospace;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            overflow: hidden;
            white-space: nowrap;
        }

        .ticker-content {
            display: inline-block;
            padding-left: 100%;
            animation: ticker 30s linear infinite;
            will-change: transform;
            transform: translateZ(0);
            backface-visibility: hidden;
        }

        @keyframes ticker {
            0% { transform: translateX(0); }
            100% { transform: translateX(-100%); }
        }

        .weather-box {
            column-span: all;
            background: #e8e8e8;
            border: 2px solid #000;
            padding: 10px;
            margin: 20px 0;
            text-align: center;
            font-size: 12px;
        }

        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.9);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .loading-overlay.active {
            display: flex;
        }

        .loading-spinner {
            font-size: 24px;
            font-weight: bold;
        }

        /* Knowledge section - newspaper clipping style */
        .knowledge-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        .knowledge-card {
            background: #fffef5; /* Aged paper color */
            border: 2px solid #000;
            padding: 15px;
            box-shadow:
                3px 3px 6px rgba(0,0,0,0.3),
                inset 0 0 20px rgba(0,0,0,0.05);
            position: relative;
            transition: all 0.3s ease;
        }

        .knowledge-card:nth-child(3n+1) {
            transform: rotate(-0.5deg);
        }

        .knowledge-card:nth-child(3n+2) {
            transform: rotate(0.8deg);
        }

        .knowledge-card:nth-child(3n+3) {
            transform: rotate(-1deg);
        }

        .knowledge-card:hover {
            transform: rotate(0deg) scale(1.02);
            box-shadow:
                5px 5px 12px rgba(0,0,0,0.4),
                inset 0 0 30px rgba(0,0,0,0.08);
            z-index: 10;
        }

        .knowledge-card h4 {
            font-size: 16px;
            margin-bottom: 10px;
            text-align: center;
            border-bottom: 2px solid #000;
            padding-bottom: 8px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            background: rgba(0,0,0,0.03);
            margin: -15px -15px 10px -15px;
            padding: 12px 15px 8px 15px;
        }

        .knowledge-card p {
            font-size: 12px;
            line-height: 1.6;
            text-align: justify;
            margin-top: 10px;
        }

        /* Knowledge tabs */
        .knowledge-tab {
            font-family: 'Arial Black', sans-serif;
            font-size: 14px;
            font-weight: bold;
            padding: 10px 20px;
            border: 2px solid #000;
            background: #f5f5f0;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .knowledge-tab:hover {
            background: #e0e0d8;
            transform: translateY(-2px);
            box-shadow: 2px 4px 6px rgba(0,0,0,0.3);
        }

        .knowledge-tab.active-tab {
            background: #000;
            color: #fff;
            box-shadow: inset 2px 2px 4px rgba(0,0,0,0.5);
        }

        /* Taxonomy layout */
        .taxonomy-wrapper {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 16px;
            margin-top: 10px;
        }
        .taxonomy-card {
            background: #fffef5;
            border: 2px solid #000;
            padding: 14px;
            box-shadow: 3px 3px 6px rgba(0,0,0,0.3);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .taxonomy-card:hover {
            transform: translateY(-2px);
            box-shadow: 5px 5px 10px rgba(0,0,0,0.35);
        }
        .taxonomy-card h3 {
            font-size: 16px;
            margin: 0 0 10px 0;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid #000;
            padding-bottom: 8px;
        }
        .taxonomy-row {
            padding: 6px 0;
            border-bottom: 1px dashed #ddd;
        }
        .taxonomy-row:last-child {
            border-bottom: none;
        }
        .taxonomy-term {
            font-weight: bold;
            font-size: 13px;
        }
        .taxonomy-def {
            font-size: 12px;
            color: #333;
            margin-top: 2px;
            line-height: 1.5;
        }
        .taxonomy-extra {
            font-size: 11px;
            color: #555;
            margin-top: 2px;
        }

        /* Taxonomy cards */
        .taxonomy-card {
            background: #fffef5;
            border: 2px solid #000;
            padding: 20px;
            box-shadow: 3px 3px 6px rgba(0,0,0,0.3);
            transform: rotate(-0.5deg);
            transition: all 0.3s ease;
        }

        .taxonomy-card:hover {
            transform: rotate(0deg) scale(1.02);
            box-shadow: 5px 5px 12px rgba(0,0,0,0.4);
            z-index: 10;
        }

        .taxonomy-card h3 {
            font-size: 18px;
            margin-bottom: 15px;
            text-align: center;
            border-bottom: 3px double #000;
            padding-bottom: 10px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1.5px;
        }

        .taxonomy-item {
            padding: 8px;
            border-bottom: 1px dotted #666;
            font-size: 13px;
            line-height: 1.6;
        }

        .taxonomy-item:last-child {
            border-bottom: none;
        }

        /* Services section */
        .subscription-plans {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 40px;
        }

        .plan-card {
            background: #fffef5;
            border: 3px double #000;
            padding: 20px;
            text-align: center;
            box-shadow: 3px 3px 8px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }

        .plan-card:hover {
            transform: translateY(-5px);
            box-shadow: 5px 5px 15px rgba(0,0,0,0.3);
        }

        .plan-card h3 {
            font-size: 22px;
            margin-bottom: 10px;
            text-transform: uppercase;
            border-bottom: 2px solid #000;
            padding-bottom: 10px;
        }

        .plan-price {
            font-size: 36px;
            font-weight: bold;
            margin: 20px 0;
        }

        .plan-price small {
            font-size: 14px;
            font-weight: normal;
        }

        .plan-features {
            text-align: left;
            margin: 20px 0;
            font-size: 13px;
            line-height: 1.8;
        }

        .plan-features li {
            margin-bottom: 8px;
        }

        .plan-btn {
            width: 100%;
            padding: 12px;
            background: #000;
            color: #fff;
            border: 2px solid #000;
            font-family: Georgia, serif;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
        }

        .plan-btn:hover {
            background: #fff;
            color: #000;
        }

        .services-list {
            display: grid;
            gap: 20px;
        }

        .service-item {
            border-left: 4px solid #000;
            padding-left: 20px;
        }

        /* Layout & typography enhancements */
        .masthead {
            margin-bottom: 25px;
        }
        h2, h3 {
            letter-spacing: 0.5px;
        }
        h2 {
            font-size: 22px;
        }
        h3 {
            font-size: 18px;
        }
        p, li {
            line-height: 1.6;
            font-size: 13px;
        }
        .cta-btn {
            display: inline-block;
            text-align: center;
            padding: 12px 18px;
            font-weight: bold;
            border: 2px solid #000;
            background: #000;
            color: #fff;
            cursor: pointer;
        }
        .cta-btn.light {
            background: #fff;
            color: #000;
        }
        .cta-btn:hover {
            opacity: 0.9;
        }

        /* Navigation / tabs */
        .navigation a,
        .knowledge-tab {
            transition: all 0.2s ease;
        }
        .navigation {
            margin-bottom: 10px;
        }
        .navigation a.active,
        .knowledge-tab.active-tab {
            background: #000;
            color: #fff;
            border-radius: 4px;
            padding: 6px 12px;
        }
        .navigation a:hover,
        .knowledge-tab:hover {
            background: #111;
            color: #fff;
        }

        /* Tables */
        .table-wrapper {
            overflow: auto;
        }
        .table-sticky thead th {
            position: sticky;
            top: 0;
            background: #f5f5f5;
            z-index: 2;
        }
        .table-zebra tbody tr:nth-child(odd) {
            background: #fafafa;
        }
        .table-legend {
            font-size: 12px;
            margin: 8px 0;
            color: #333;
        }
        .tier-pill {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            border: 2px solid #000;
            border-radius: 999px;
            font-weight: bold;
            font-size: 12px;
        }
        .badge {
            display: inline-block;
            padding: 2px 8px;
            border: 1px solid #000;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .badge.free { background: #f5f5f5; }
        .badge.basic { background: #e8f5ff; }
        .badge.premium { background: #fff3e0; }
        .badge.enterprise { background: #f3e8ff; }

        /* Status chips */
        .chip {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            color: #fff;
        }
        .chip.draft { background: #777; }
        .chip.active { background: #2d9c5f; }
        .chip.permit { background: #1f6feb; }
        .chip.review { background: #c47f17; }

        /* Modals */
        .modal-overlay {
            backdrop-filter: blur(2px);
        }
        .modal-content {
            padding: 24px;
        }
        .modal-close {
            transition: transform 0.2s ease, color 0.2s ease;
        }
        .modal-close:hover {
            color: #c00;
            transform: scale(1.08);
        }

        /* News grid for News UI */
        .news-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }
        .news-view {
            column-count: 1;
        }
        .news-card {
            border: 2px solid #000;
            background: #fff;
            padding: 12px;
            box-shadow: 3px 3px 0 #000;
            display: flex;
            flex-direction: column;
            min-height: 100%;
        }
        .news-card h4 {
            margin: 0 0 8px;
            font-size: 16px;
        }
        .news-meta {
            font-size: 11px;
            color: #555;
            margin-bottom: 8px;
        }
        .news-btn {
            margin-top: auto;
            display: inline-block;
            padding: 6px 10px;
            border: 2px solid #000;
            background: #f7f7f7;
            color: #000;
            font-size: 12px;
            font-weight: bold;
            text-decoration: none;
        }
        .news-btn:hover {
            background: #000;
            color: #fff;
        }
        /* Study guide resource buttons */
        .study-link {
            display: inline-block;
            padding: 6px 10px;
            border: 2px solid #000;
            background: #f7f7f7;
            color: #000;
            font-size: 12px;
            font-weight: bold;
            text-decoration: none;
        }
        .study-link:hover {
            background: #000;
            color: #fff;
        }
        .service-item h3 {
            font-size: 18px;
            margin-bottom: 8px;
        }

        .service-item p {
            font-size: 14px;
            line-height: 1.7;
        }

        /* Heatmap for Existing DCs */
        .heatmap-container {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            gap: 10px;
            margin-bottom: 20px;
            justify-items: center;
            max-width: 100%;
            margin-left: auto;
            margin-right: auto;
        }

        .heatmap-cell {
            background: #f0f0f0;
            border: 1px solid #000;
            padding: 10px;
            text-align: center;
            font-size: 11px;
            transition: all 0.3s;
            min-width: 100px;
            width: 100%;
        }

        .heatmap-cell:hover {
            transform: scale(1.05);
            z-index: 10;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .heatmap-cell.heat-low {
            background: #d4f1d4;
        }

        .heatmap-cell.heat-medium {
            background: #fff4b3;
        }

        .heatmap-cell.heat-high {
            background: #ffcccc;
        }

        .heatmap-cell.heat-extreme {
            background: #ff6666;
            color: #fff;
            font-weight: bold;
        }

        .heatmap-label {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .heatmap-value {
            font-size: 16px;
            font-weight: bold;
        }

        /* Hexbin Heatmap Wrapper - Override narrow grid layout */
        #heatmapViz, #upcomingHeatmap {
            display: block !important;  /* Override grid layout */
            width: 100% !important;
            max-width: 960px !important;
            margin: 0 auto !important;
            padding: 0 !important;
        }

        #upcomingHexmapContainer {
            width: 100%;
            max-width: 100%;
            min-height: 500px;
            height: auto;
            position: relative;
            background: #f8f8f8;
            border: 1px solid #ddd;
            display: block;
            overflow: visible;
        }

        /* Hexbin Heatmap Styles - Force wide landscape layout */
        #hexmapContainer {
            width: 100%;
            max-width: 100%;
            min-height: 500px;
            height: auto;
            position: relative;
            background: #f8f8f8;
            border: 1px solid #ddd;
            display: block;
            overflow: visible;
        }

        .hexagon {
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .hexagon:hover {
            stroke: #000 !important;
            stroke-width: 3px !important;
            filter: brightness(1.3);
            opacity: 1 !important;
        }

        .hexmap-tooltip {
            position: absolute;
            padding: 10px;
            background: rgba(0, 0, 0, 0.9);
            color: #fff;
            border-radius: 5px;
            pointer-events: none;
            font-size: 12px;
            line-height: 1.5;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 1000;
        }

        .hexmap-legend {
            padding: 15px;
            background: #fff;
            border: 1px solid #ddd;
            margin-top: 10px;
        }

        .hexmap-legend h4 {
            margin: 0 0 10px 0;
            font-size: 14px;
        }

        .legend-item {
            display: inline-block;
            margin-right: 15px;
        }

        .legend-color {
            display: inline-block;
            width: 30px;
            height: 15px;
            margin-right: 5px;
            vertical-align: middle;
            border: 1px solid #999;
        }

        /* Modal System */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: #fffef5;
            border: 4px double #000;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 5px 5px 20px rgba(0,0,0,0.5);
            position: relative;
        }

        .modal-header {
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            border-bottom: 3px solid #000;
            padding-bottom: 10px;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .modal-close {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
            font-weight: bold;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 13px;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px;
            font-family: Georgia, serif;
            font-size: 13px;
            border: 2px solid #000;
            background: #fff;
        }

        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }

        .form-submit {
            width: 100%;
            padding: 12px;
            background: #000;
            color: #fff;
            border: 2px solid #000;
            font-family: Georgia, serif;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
        }

        .form-submit:hover {
            background: #333;
        }

        @media print {
            .search-box-container, .ticker, #searchBtn, .navigation { display: none; }
        }
    
        .modal-logo {
            display: block;
            margin: 0 auto 20px;
            height: 80px;
            width: auto;
            max-width: 280px;
            object-fit: contain;
            padding: 4px;
            box-shadow: 0 0 0 3px #f7f7f0, 0 0 0 5px #000;
        }
    </style>

    <!-- D3.js libraries for hexbin heatmap -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://d3js.org/d3-hexbin.v0.2.min.js"></script>
    <script src="https://d3js.org/d3-geo.v3.min.js"></script>
    <script src="https://d3js.org/topojson.v3.min.js"></script>
    <!-- SheetJS library for Excel export -->
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner">Loading Latest Intelligence...</div>
    </div>

    <div class="newspaper-container">
        <div class="masthead">
            <div class="auth-buttons" id="authButtons">
                <button class="auth-btn secondary" onclick="console.log('Sign In clicked'); showLogin(); return false;">Sign In</button>
                <button class="auth-btn" onclick="console.log('Register clicked'); showRegister(); return false;">Register</button>
                <button class="auth-btn secondary" id="logoutFallback" style="display: none;" onclick="logout(); return false;">Logout</button>
            </div>
            <div class="user-info" id="userInfo" style="display: none;">
                Welcome, <strong id="userName">User</strong>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
            <div class="masthead-header">
                <a href="#" onclick="switchSection('home'); window.scrollTo(0,0); return false;" aria-label="Go to Home">
                    <img src="9e224nbi.png" alt="DC Intel Logo" class="masthead-logo">
                </a>
                <div class="masthead-title-group">
                    <h1>DATACENTER HIVE</h1>
                    <div class="tagline">"Expert Advisory & Market Intelligence for Data Centers"</div>
                </div>
            </div>
        </div>

            <div class="edition-info">
                <div class="edition-date">Daily Edition       <span id="todayDate"></span></div>
                <div class="navigation">
                    <a href="#" onclick="window.location.reload(); return false;" class="active" id="navHome">Home</a> |
                    <a href="#" onclick="switchSection('knowledge'); return false;" id="navKnowledge">Knowledge</a> |
                    <a href="#" onclick="loadLatestNews(); return false;" id="navNews">News</a> |
                    <a href="#" onclick="switchSection('pricing'); return false;" id="navPricing">Pricing</a> |
                    <a href="#" onclick="switchSection('services'); return false;" id="navServices">Services</a> |
                    <a href="#" onclick="switchSection('existing-dcs'); return false;" id="navExisting">Existing DCs</a> |
                    <a href="#" onclick="switchSection('upcoming-dcs'); return false;" id="navUpcoming">Upcoming DCs</a>
                </div>
            <div class="api-status">API Status: <strong id="apiStatus">ONLINE</strong></div>
        </div>

        <!-- HOME SECTION -->
        <div class="content-section active" id="homeSection">
            <div class="search-box-container">
                <h3>DC Intelligence Search Bureau</h3>
                <div class="search-input-wrapper">
                    <input type="text" id="searchInput" placeholder="Search data center projects, operators, locations...">
                    <button id="searchBtn">Search</button>
                </div>
                <div class="quick-queries">
                    Quick Links:
                    <a href="#" onclick="showQuickLinkCategory('hyperscale'); return false;">Hyperscale</a> |
                    <a href="#" onclick="showQuickLinkCategory('colocation'); return false;">Colocation</a> |
                    <a href="#" onclick="showQuickLinkCategory('edge'); return false;">Edge</a> |
                    <a href="#" onclick="showQuickLinkCategory('100mw'); return false;">100MW+</a>
                </div>
            </div>

            <div id="contentArea" class="columns">
                <div class="headline-main" id="dailyHeadline">
                    Data Center Construction Booms Across Nation
                </div>

                <div class="article" id="article1">
                    <div class="article-headline">Loading...</div>
                    <div class="article-byline">DC Intel</div>
                    <div class="article-content">Loading content...</div>
                </div>

                <div class="article" id="article2">
                    <div class="article-headline">Loading...</div>
                    <div class="article-byline">DC Intel</div>
                    <div class="article-content">Loading content...</div>
                </div>

                <div class="weather-box">
                    <strong>DC MARKET HEAT INDEX:</strong> <span id="marketHeat">EXTREMELY HOT         </span> |
                    <strong>Top Markets:</strong> <span id="topMarkets">Ashburn VA, Dallas TX, Phoenix AZ</span> |
                    <strong>Trend:</strong> <span id="marketTrend">Accelerating</span>
                </div>
            </div>

            <div class="classifieds" id="classifiedsSection">
                <h3>Professional Services Directory</h3>
                <div class="classifieds-grid" id="classifiedsGrid"></div>
            </div>
        </div>

        <!-- KNOWLEDGE SECTION -->
        <div class="content-section" id="knowledgeSection">
            <h2 style="text-align: center; margin-bottom: 20px; border-bottom: 3px solid #000; padding-bottom: 10px;">Data Center Knowledge Base</h2>

            <!-- Knowledge Tabs -->
            <div style="display: flex; gap: 10px; margin-bottom: 12px; border-bottom: 2px solid #000; padding-bottom: 5px; justify-content: center; flex-wrap: wrap;">
                <button onclick="switchKnowledgeTab('glossary')" id="tabGlossary" class="knowledge-tab active-tab">
                    GLOSSARY
                </button>
                <button onclick="switchKnowledgeTab('handbook')" id="tabHandbook" class="knowledge-tab">
                    HANDBOOK
                </button>
                <button onclick="switchKnowledgeTab('taxonomy')" id="tabTaxonomy" class="knowledge-tab">
                    TAXONOMY
                </button>
                <button onclick="switchKnowledgeTab('studyguides')" id="tabStudyguides" class="knowledge-tab">
                    STUDY GUIDES
                </button>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; flex-wrap: wrap; gap: 10px;">
                <div class="tier-pill">
                    Current tier: <span id="tierPillLabel" style="text-transform: uppercase;">FREE</span>
                </div>
                <div style="font-size: 12px;">
                    Study guide access: <strong>Free</strong> (open)    <strong>Basic</strong> (Core Fundamentals)    <strong>Premium</strong> (Essential Infrastructure + Core)    <strong>Enterprise</strong> (Complete Library)
                </div>
            </div>

            <!-- Glossary View -->
            <div id="glossaryView" class="knowledge-view">
                <input type="text" id="knowledgeSearch" placeholder="Search glossary terms..." style="width: 100%; padding: 12px; margin-bottom: 20px; border: 2px solid #000; font-family: Georgia, serif;">
                <div class="knowledge-grid" id="knowledgeGrid"></div>
            </div>

            <!-- Handbook View -->
            <div id="handbookView" class="knowledge-view" style="display: none;">
                <div id="handbookContent" style="background: #fffef5; border: 3px double #000; padding: 30px; max-width: 900px; margin: 0 auto; line-height: 1.8; font-size: 14px; box-shadow: 3px 3px 8px rgba(0,0,0,0.3);">
                    <p style="text-align: center; font-style: italic;">Loading handbook...</p>
                </div>
            </div>

            <!-- Taxonomy View -->
            <div id="taxonomyView" class="knowledge-view" style="display: none;">
                <h3 style="text-align: center; margin-bottom: 12px; border-bottom: 2px solid #000; padding-bottom: 6px;">Taxonomy</h3>
                <div id="taxonomyContent" class="taxonomy-wrapper"></div>
            </div>

            <!-- Study Guides View -->
            <div id="studyguidesView" class="knowledge-view" style="display: none;">
                <div style="max-width: 1000px; margin: 0 auto;">
                    <p style="text-align: center; font-size: 15px; margin-bottom: 30px; line-height: 1.7;">
                        Professional study guides and educational resources for data center professionals, students, and job seekers.
                        <strong>Business customers:</strong> See our <a href="#" onclick="switchSection('pricing'); return false;" style="color: #000; text-decoration: underline;">subscription plans</a> for full access.
                    </p>

                    <!-- A la carte paid guides -->
                    <div style="margin-bottom: 16px; border: 2px solid #000; padding: 10px; background: #fff;">
                        <h3 style="margin: 0 0 6px; font-size: 17px; letter-spacing: 1px;">PAID STUDY GUIDES (A LA CARTE)</h3>
                        <div style="font-size: 13px; line-height: 1.6;">
                            <div><strong>Core Fundamentals ($49)</strong> - Operations, infrastructure basics, market essentials.</div>
                            <div><strong>Essential Infrastructure ($99)</strong> - Site selection, sustainability metrics, best practices, power and network design.</div>
                            <div><strong>Enterprise Library (custom)</strong> - Full collection, all tiers, and updates. Contact us for pricing.</div>
                        </div>
                    </div>

                    <!-- FREE Study Guides -->
                    <div style="margin-bottom: 40px;">
                        <h3 style="border-bottom: 3px solid #000; padding-bottom: 8px; margin-bottom: 20px; font-size: 18px; letter-spacing: 1px;">FREE STUDY GUIDES</h3>

                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                            <!-- Free Guide 1: Market Overview -->
                            <div style="border: 3px solid #000; padding: 20px; background: #fffef5;">
                                <div style="display: flex; justify-content: space-between; align-items: center; gap: 6px; border-bottom: 2px solid #ccc; padding-bottom: 8px;">
                                    <h4 style="margin-top: 0; font-size: 16px;">DC Market Overview 2025</h4>
                                    <span class="badge free">Free</span>
                                </div>
                                <p style="font-size: 13px; line-height: 1.6; margin: 15px 0;">
                                    A comprehensive overview of the data center industry: key players, market trends, major markets, and growth forecasts. Perfect introduction for newcomers.
                                </p>
                                <ul style="font-size: 12px; line-height: 1.8; margin: 15px 0 20px; padding-left: 20px;">
                                    <li>18 pages       PDF format</li>
                                    <li>Market size & growth trends</li>
                                    <li>Top 10 DC markets in US</li>
                                    <li>Key industry players</li>
                                </ul>
                                <button style="width: 100%; padding: 10px; background: #000; color: #fff; border: 2px solid #000; font-family: Georgia, serif; font-size: 13px; font-weight: bold; cursor: pointer;"
                                        onclick="alert('Enter your email to download:\n\nsupport@dc-intel.com')">
                                    FREE DOWNLOAD (Email Required)
                                </button>
                            </div>

                            <!-- Free Guide 2: Glossary -->
                            <div style="border: 3px solid #000; padding: 20px; background: #fffef5;">
                                <div style="display: flex; justify-content: space-between; align-items: center; gap: 6px; border-bottom: 2px solid #ccc; padding-bottom: 8px;">
                                    <h4 style="margin-top: 0; font-size: 16px;">DC Industry Glossary</h4>
                                    <span class="badge free">Free</span>
                                </div>
                                <p style="font-size: 13px; line-height: 1.6; margin: 15px 0;">
                                    Essential terminology guide covering 200+ data center terms, acronyms, and technical concepts. Great reference for interviews and daily work.
                                </p>
                                <ul style="font-size: 12px; line-height: 1.8; margin: 15px 0 20px; padding-left: 20px;">
                                    <li>24 pages       PDF format</li>
                                    <li>200+ industry terms</li>
                                    <li>Technical & business terms</li>
                                    <li>Acronyms explained</li>
                                </ul>
                                <button style="width: 100%; padding: 10px; background: #000; color: #fff; border: 2px solid #000; font-family: Georgia, serif; font-size: 13px; font-weight: bold; cursor: pointer;"
                                        onclick="alert('Enter your email to download:\n\nsupport@dc-intel.com')">
                                    FREE DOWNLOAD (Email Required)
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- SUBSCRIPTION KNOWLEDGE LIBRARY -->
                    <div style="margin-bottom: 40px;">
                        <h3 style="border-bottom: 3px solid #000; padding-bottom: 8px; margin-bottom: 15px; font-size: 18px; letter-spacing: 1px;">PREMIUM KNOWLEDGE LIBRARY</h3>

                        <!-- Disclaimer about AI-curated content -->
                        <div style="background: #fffef5; border: 2px solid #000; padding: 15px; margin-bottom: 25px; font-size: 12px; line-height: 1.6;">
                            <strong>Note:</strong> Content developed from research papers guided and curated by our data center experts. Each topic includes comprehensive research materials, visual summaries, and educational videos.
                        </div>

                        <!-- BASIC TIER CONTENT -->
                        <div class="tier-basic-only" style="margin-bottom: 35px; display: none;">
                            <div style="background: #000; color: #fff; padding: 8px 15px; margin-bottom: 20px; font-weight: bold; letter-spacing: 1px; font-size: 14px;">
                                BASIC TIER ($299/month) - CORE FUNDAMENTALS
                            </div>

                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                                <!-- Handbook Part A -->
                                <div style="border: 3px solid #000; padding: 20px; background: #fff;">
                                    <h4 style="margin-top: 0; font-size: 15px; border-bottom: 2px solid #ccc; padding-bottom: 8px;">DC Handbook - Part A</h4>
                                    <p style="font-size: 12px; font-style: italic; margin: 10px 0;">Executive Summary</p>
                                    <div style="font-size: 12px; line-height: 1.8; margin: 15px 0;">
                                        <div style="margin-bottom: 8px;">           <a class="study-link" href="knowledge/sources/Handbook - Part A - Executive Summary/Cloud_To_Concrete.pdf">Research Paper (PDF)</a></div>
                                        <div style="margin-bottom: 8px;">           <a class="study-link" href="knowledge/sources/Handbook - Part A - Executive Summary/PartA_Executive_Summary.pdf">Deep-Dive Study (PDF)</a></div>
                                        <div style="margin-bottom: 8px;">          <a class="study-link" href="knowledge/sources/Handbook - Part A - Executive Summary/Overview.png" target="_blank">Infographic (PNG)</a></div>
                                    </div>
                                </div>

                                <!-- Handbook Part B -->
                                <div style="border: 3px solid #000; padding: 20px; background: #fff;">
                                    <h4 style="margin-top: 0; font-size: 15px; border-bottom: 2px solid #ccc; padding-bottom: 8px;">DC Handbook - Part B</h4>
                                    <p style="font-size: 12px; font-style: italic; margin: 10px 0;">Core Infrastructure</p>
                                    <div style="font-size: 12px; line-height: 1.8; margin: 15px 0;">
                                        <div style="margin-bottom: 8px;">           <a class="study-link" href="knowledge/sources/Handbook - Part B - Core/Data Center Handbook (Part B).pdf">Research Paper (PDF)</a></div>
                                        <div style="margin-bottom: 8px;">           <a class="study-link" href="knowledge/sources/Handbook - Part B - Core/Data_Center_Core_Pillars.pdf">Deep-Dive Study (PDF)</a></div>
                                        <div style="margin-bottom: 8px;">          <a class="study-link" href="knowledge/sources/Handbook - Part B - Core/unnamed (4).png" target="_blank">Infographic (PNG)</a></div>
                                        <div style="margin-bottom: 8px;">         <a class="study-link" href="#" onclick="openVideo(this.getAttribute('data-video'), this.getAttribute('data-title')); return false;" data-video="knowledge/sources/Handbook - Part B - Core/Inside_the_Digital_Engine.mp4" data-title="DC Handbook - Part B: Core Infrastructure">Watch Video</a></div>
                                    </div>
                                </div>

                                <!-- Handbook Part C -->
                                <div style="border: 3px solid #000; padding: 20px; background: #fff;">
                                    <h4 style="margin-top: 0; font-size: 15px; border-bottom: 2px solid #ccc; padding-bottom: 8px;">DC Handbook - Part C</h4>
                                    <p style="font-size: 12px; font-style: italic; margin: 10px 0;">Advanced Topics</p>
                                    <div style="font-size: 12px; line-height: 1.8; margin: 15px 0;">
                                        <div style="margin-bottom: 8px;">           <a class="study-link" href="knowledge/sources/Handbook - Part C/Cloud_To_Concrete.pdf">Research Paper (PDF)</a></div>
                                        <div style="margin-bottom: 8px;">           <a class="study-link" href="knowledge/sources/Handbook - Part C/Data Center Handbook-C.pdf">Deep-Dive Study (PDF)</a></div>
                                        <div style="margin-bottom: 8px;">          <a class="study-link" href="knowledge/sources/Handbook - Part C/Infrastructure and Operations.png" target="_blank">Infographic (PNG)</a></div>
                                        <div style="margin-bottom: 8px;">         <a class="study-link" href="#" onclick="openVideo(this.getAttribute('data-video'), this.getAttribute('data-title')); return false;" data-video="knowledge/sources/Handbook - Part C/Inside_the_Digital_Fortress.mp4" data-title="DC Handbook - Part C: Advanced Topics">Watch Video</a></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- PREMIUM TIER CONTENT -->
                        <div class="tier-premium-only" style="margin-bottom: 35px; display: none;">
                            <div style="background: #000; color: #fff; padding: 8px 15px; margin-bottom: 20px; font-weight: bold; letter-spacing: 1px; font-size: 14px;">
                                PREMIUM TIER ($999/month) - ESSENTIAL INFRASTRUCTURE
                                <span style="font-weight: normal; font-size: 12px; margin-left: 10px;">(Includes all Basic content +)</span>
                            </div>

                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                                <!-- Building Design -->
                                <div style="border: 3px solid #000; padding: 20px; background: #fff;">
                                    <h4 style="margin-top: 0; font-size: 15px; border-bottom: 2px solid #ccc; padding-bottom: 8px;">Building Design & Construction</h4>
                                    <div style="font-size: 12px; line-height: 1.8; margin: 15px 0;">
                                        <div style="margin-bottom: 8px;">           <a class="study-link" href="knowledge/sources/Building Design and Construction/Data Center Building Design & Construction Source Pack (2020-2025).pdf">Research Paper (PDF)</a></div>
                                        <div style="margin-bottom: 8px;">           <a class="study-link" href="knowledge/sources/Building Design and Construction/Anatomy_of_the_Modern_Data_Center.pdf">Deep-Dive Study (PDF)</a></div>
                                        <div style="margin-bottom: 8px;">          <a class="study-link" href="knowledge/sources/Building Design and Construction/Data Center Design.png" target="_blank">Infographic (PNG)</a></div>
                                        <div style="margin-bottom: 8px;">         <a class="study-link" href="#" onclick="openVideo(this.getAttribute('data-video'), this.getAttribute('data-title')); return false;" data-video="knowledge/sources/Building Design and Construction/How_to_Build_the_Internet.mp4" data-title="Building Design & Construction">Watch Video</a></div>
                                    </div>
                                </div>

                                <!-- Cooling Systems -->
                                <div style="border: 3px solid #000; padding: 20px; background: #fff;">
                                    <h4 style="margin-top: 0; font-size: 15px; border-bottom: 2px solid #ccc; padding-bottom: 8px;">Cooling Systems</h4>
                                    <div style="font-size: 12px; line-height: 1.8; margin: 15px 0;">
                                        <div style="margin-bottom: 8px;">           <a class="study-link" href="knowledge/sources/Colling Systems(B)/Cooling Systems Source Pack (B-Cooling).pdf">Research Paper (PDF)</a></div>
                                        <div style="margin-bottom: 8px;">           <a class="study-link" href="knowledge/sources/Colling Systems(B)/Data_Center_Thermal_Frontier.pdf">Deep-Dive Study (PDF)</a></div>
                                        <div style="margin-bottom: 8px;">          <a class="study-link" href="knowledge/sources/Colling Systems(B)/Cooling systems.png" target="_blank">Infographic (PNG)</a></div>
                                        <div style="margin-bottom: 8px;">         <a class="study-link" href="#" onclick="openVideo(this.getAttribute('data-video'), this.getAttribute('data-title')); return false;" data-video="knowledge/sources/Colling Systems(B)/The_Unseen_Engine__Cooling_AI.mp4" data-title="Cooling Systems">Watch Video</a></div>
                                    </div>
                                </div>

                                <!-- Power Infrastructure -->
                                <div style="border: 3px solid #000; padding: 20px; background: #fff;">
                                    <h4 style="margin-top: 0; font-size: 15px; border-bottom: 2px solid #ccc; padding-bottom: 8px;">Power Infrastructure</h4>
                                    <div style="font-size: 12px; line-height: 1.8; margin: 15px 0;">
                                        <div style="margin-bottom: 8px;">           <a class="study-link" href="knowledge/sources/Power infrastructure/Data Center Power Infrastructure Source Pack (2020      2025).pdf">Research Paper (PDF)</a></div>
                                        <div style="margin-bottom: 8px;">           <a class="study-link" href="knowledge/sources/Power infrastructure/Data_Center_Power_Shift.pdf">Deep-Dive Study (PDF)</a></div>
                                        <div style="margin-bottom: 8px;">          <a class="study-link" href="knowledge/sources/Power infrastructure/Power.png" target="_blank">Infographic (PNG)</a></div>
                                        <div style="margin-bottom: 8px;">         <a class="study-link" href="#" onclick="openVideo(this.getAttribute('data-video'), this.getAttribute('data-title')); return false;" data-video="knowledge/sources/Power infrastructure/The_Power_Problem.mp4" data-title="Power Infrastructure">Watch Video</a></div>
                                    </div>
                                </div>

                                <!-- Network and Connectivity -->
                                <div style="border: 3px solid #000; padding: 20px; background: #fff;">
                                    <h4 style="margin-top: 0; font-size: 15px; border-bottom: 2px solid #ccc; padding-bottom: 8px;">Network & Connectivity</h4>
                                    <div style="font-size: 12px; line-height: 1.8; margin: 15px 0;">
                                        <div style="margin-bottom: 8px;">           <a class="study-link" href="knowledge/sources/Network and Connectivity/Data Center Network & Connectivity Source Pack (B-Network).pdf">Research Paper (PDF)</a></div>
                                        <div style="margin-bottom: 8px;">           <a class="study-link" href="knowledge/sources/Network and Connectivity/Digital_Architecture_The_Interconnection_Story.pdf">Deep-Dive Study (PDF)</a></div>
                                        <div style="margin-bottom: 8px;">          <a class="study-link" href="knowledge/sources/Network and Connectivity/Anatomy.png" target="_blank">Infographic (PNG)</a></div>
                                        <div style="margin-bottom: 8px;">         <a class="study-link" href="#" onclick="openVideo(this.getAttribute('data-video'), this.getAttribute('data-title')); return false;" data-video="knowledge/sources/Network and Connectivity/Data_Center_Connectivity.mp4" data-title="Network & Connectivity">Watch Video</a></div>
                                    </div>
                                </div>

                                <!-- Markets and Drivers -->
                                <div style="border: 3px solid #000; padding: 20px; background: #fff;">
                                    <h4 style="margin-top: 0; font-size: 15px; border-bottom: 2px solid #ccc; padding-bottom: 8px;">Markets & Drivers</h4>
                                    <div style="font-size: 12px; line-height: 1.8; margin: 15px 0;">
                                        <div style="margin-bottom: 8px;">           <a class="study-link" href="knowledge/sources/Markets and Drivers/Markets & Drivers Source Pack (U.S. Data Center Hubs 2020      2025).pdf">Research Paper (PDF)</a></div>
                                        <div style="margin-bottom: 8px;">           <a class="study-link" href="knowledge/sources/Markets and Drivers/The_AI_Power_Shift.pdf">Deep-Dive Study (PDF)</a></div>
                                        <div style="margin-bottom: 8px;">          <a class="study-link" href="knowledge/sources/Markets and Drivers/Top US Center Hubs.png" target="_blank">Infographic (PNG)</a></div>
                                        <div style="margin-bottom: 8px;">         <a class="study-link" href="#" onclick="openVideo(this.getAttribute('data-video'), this.getAttribute('data-title')); return false;" data-video="knowledge/sources/Markets and Drivers/America_s_Digital_Gold_Rush.mp4" data-title="Markets & Drivers">Watch Video</a></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ENTERPRISE TIER CONTENT -->
                        <div class="tier-enterprise-only" style="margin-bottom: 20px; display: none;">
                            <div style="background: #000; color: #fff; padding: 8px 15px; margin-bottom: 20px; font-weight: bold; letter-spacing: 1px; font-size: 14px;">
                                ENTERPRISE TIER ($2,499/month) - COMPLETE LIBRARY
                                <span style="font-weight: normal; font-size: 12px; margin-left: 10px;">(Includes all Premium content +)</span>
                            </div>

                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                                <!-- Disaster Recovery -->
                                <div style="border: 3px solid #000; padding: 20px; background: #fff;">
                                    <h4 style="margin-top: 0; font-size: 15px; border-bottom: 2px solid #ccc; padding-bottom: 8px;">Disaster Recovery & Business Continuity</h4>
                                    <div style="font-size: 12px; line-height: 1.8; margin: 15px 0;">
                                        <div style="margin-bottom: 8px;">           <a class="study-link" href="knowledge/sources/Disaster Recovery and Business Continuity/Data Center Disaster Recovery & Business Continuity Source Pack (2020-2025).pdf">Research Paper (PDF)</a></div>
                                        <div style="margin-bottom: 8px;">           <a class="study-link" href="knowledge/sources/Disaster Recovery and Business Continuity/Operational_Resilience_The_New_Imperative.pdf">Deep-Dive Study (PDF)</a></div>
                                        <div style="margin-bottom: 8px;">          <a class="study-link" href="knowledge/sources/Disaster Recovery and Business Continuity/Key Trends.png" target="_blank">Infographic (PNG)</a></div>
                                        <div style="margin-bottom: 8px;">         <a class="study-link" href="#" onclick="openVideo(this.getAttribute('data-video'), this.getAttribute('data-title')); return false;" data-video="knowledge/sources/Disaster Recovery and Business Continuity/Keeping_the_Digital_World_On.mp4" data-title="Disaster Recovery & Business Continuity">Watch Video</a></div>
                                    </div>
                                </div>

                                <!-- Emerging Technologies -->
                                <div style="border: 3px solid #000; padding: 20px; background: #fff;">
                                    <h4 style="margin-top: 0; font-size: 15px; border-bottom: 2px solid #ccc; padding-bottom: 8px;">Emerging Technologies</h4>
                                    <div style="font-size: 12px; line-height: 1.8; margin: 15px 0;">
                                        <div style="margin-bottom: 8px;">           <a class="study-link" href="knowledge/sources/Emerging Technologies/Data Center Emerging Technologies Source Pack (2020-2025).pdf">Research Paper (PDF)</a></div>
                                        <div style="margin-bottom: 8px;">           <a class="study-link" href="knowledge/sources/Emerging Technologies/AI_Rebuilds_Infrastructure.pdf">Deep-Dive Study (PDF)</a></div>
                                        <div style="margin-bottom: 8px;">          <a class="study-link" href="knowledge/sources/Emerging Technologies/Infrastructure Revolution.png" target="_blank">Infographic (PNG)</a></div>
                                        <div style="margin-bottom: 8px;">         <a class="study-link" href="#" onclick="openVideo(this.getAttribute('data-video'), this.getAttribute('data-title')); return false;" data-video="knowledge/sources/Emerging Technologies/The_Data_Center_Revolution.mp4" data-title="Emerging Technologies">Watch Video</a></div>
                                    </div>
                                </div>

                                <!-- Fire Suppression -->
                                <div style="border: 3px solid #000; padding: 20px; background: #fff;">
                                    <h4 style="margin-top: 0; font-size: 15px; border-bottom: 2px solid #ccc; padding-bottom: 8px;">Fire Suppression & Life Safety</h4>
                                    <div style="font-size: 12px; line-height: 1.8; margin: 15px 0;">
                                        <div style="margin-bottom: 8px;">           <a class="study-link" href="knowledge/sources/Fire Suppression and Life Safety/Data Center Fire Suppression & Life Safety Source Pack (2020-2025).pdf">Research Paper (PDF)</a></div>
                                        <div style="margin-bottom: 8px;">           <a class="study-link" href="knowledge/sources/Fire Suppression and Life Safety/Data_Center_Fire_Safety_Evolution_2025.pdf">Deep-Dive Study (PDF)</a></div>
                                        <div style="margin-bottom: 8px;">          <a class="study-link" href="knowledge/sources/Fire Suppression and Life Safety/unnamed (8).png" target="_blank">Infographic (PNG)</a></div>
                                        <div style="margin-bottom: 8px;">         <a class="study-link" href="#" onclick="openVideo(this.getAttribute('data-video'), this.getAttribute('data-title')); return false;" data-video="knowledge/sources/Fire Suppression and Life Safety/Protecting_the_Cloud (1).mp4" data-title="Fire Suppression & Life Safety">Watch Video</a></div>
                                    </div>
                                </div>

                                <!-- Physical Security -->
                                <div style="border: 3px solid #000; padding: 20px; background: #fff;">
                                    <h4 style="margin-top: 0; font-size: 15px; border-bottom: 2px solid #ccc; padding-bottom: 8px;">Physical Security & Access Controls</h4>
                                    <div style="font-size: 12px; line-height: 1.8; margin: 15px 0;">
                                        <div style="margin-bottom: 8px;">           <a class="study-link" href="knowledge/sources/Physcial Security and Access Controls/Data Center Physical Security & Access Control Source Pack (2020-2025).pdf">Research Paper (PDF)</a></div>
                                        <div style="margin-bottom: 8px;">           <a class="study-link" href="knowledge/sources/Physcial Security and Access Controls/The_Hardened_Core_Transformation_2020-2025.pdf">Deep-Dive Study (PDF)</a></div>
                                        <div style="margin-bottom: 8px;">          <a class="study-link" href="knowledge/sources/Physcial Security and Access Controls/Digital Fortress.png" target="_blank">Infographic (PNG)</a></div>
                                        <div style="margin-bottom: 8px;">         <a class="study-link" href="#" onclick="openVideo(this.getAttribute('data-video'), this.getAttribute('data-title')); return false;" data-video="knowledge/sources/Physcial Security and Access Controls/Protecting_the_Cloud.mp4" data-title="Physical Security & Access Controls">Watch Video</a></div>
                                    </div>
                                </div>

                                <!-- Reliability and Compliance -->
                                <div style="border: 3px solid #000; padding: 20px; background: #fff;">
                                    <h4 style="margin-top: 0; font-size: 15px; border-bottom: 2px solid #ccc; padding-bottom: 8px;">Reliability & Compliance Standards</h4>
                                    <div style="font-size: 12px; line-height: 1.8; margin: 15px 0;">
                                        <div style="margin-bottom: 8px;">           <a class="study-link" href="knowledge/sources/Realiability and Compliance Standards/Compliance & Reliability Source Pack.pdf">Research Paper (PDF)</a></div>
                                        <div style="margin-bottom: 8px;">           <a class="study-link" href="knowledge/sources/Realiability and Compliance Standards/The_Architecture_of_Trust.pdf">Deep-Dive Study (PDF)</a></div>
                                        <div style="margin-bottom: 8px;">          <a class="study-link" href="knowledge/sources/Realiability and Compliance Standards/Reliability and Complience.png" target="_blank">Infographic (PNG)</a></div>
                                        <div style="margin-bottom: 8px;">         <a class="study-link" href="#" onclick="openVideo(this.getAttribute('data-video'), this.getAttribute('data-title')); return false;" data-video="knowledge/sources/Realiability and Compliance Standards/Building_Trust_in_the_Cloud.mp4" data-title="Reliability & Compliance Standards">Watch Video</a></div>
                                    </div>
                                </div>

                                <!-- Sustainability -->
                                <div style="border: 3px solid #000; padding: 20px; background: #fff;">
                                    <h4 style="margin-top: 0; font-size: 15px; border-bottom: 2px solid #ccc; padding-bottom: 8px;">Sustainability & Energy Efficiency</h4>
                                    <div style="font-size: 12px; line-height: 1.8; margin: 15px 0;">
                                        <div style="margin-bottom: 8px;">           <a class="study-link" href="knowledge/sources/Sustainability and Energy Efficiency/Data Center Sustainability & Energy Efficiency Source Pack (2020-2025) (1).pdf">Research Paper (PDF)</a></div>
                                        <div style="margin-bottom: 8px;">           <a class="study-link" href="knowledge/sources/Sustainability and Energy Efficiency/The_Data_Center_Sustainability_Evolution.pdf">Deep-Dive Study (PDF)</a></div>
                                        <div style="margin-bottom: 8px;">          <a class="study-link" href="knowledge/sources/Sustainability and Energy Efficiency/Sustainability.png" target="_blank">Infographic (PNG)</a></div>
                                        <div style="margin-bottom: 8px;">         <a class="study-link" href="#" onclick="openVideo(this.getAttribute('data-video'), this.getAttribute('data-title')); return false;" data-video="knowledge/sources/Sustainability and Energy Efficiency/The_Green_Cloud.mp4" data-title="Sustainability & Energy Efficiency">Watch Video</a></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Business Customers CTA -->
                    <div style="background: #f9f9f9; border: 3px double #000; padding: 25px; text-align: center;">
                        <h4 style="margin-top: 0; font-size: 18px;">Need More Than Study Guides?</h4>
                        <p style="font-size: 14px; line-height: 1.6; margin-bottom: 20px;">
                            Business customers get access to our full data center intelligence platform, expert advisory services, and real-time market data.
                        </p>
                        <button style="padding: 12px 30px; background: #000; color: #fff; border: 2px solid #000; font-family: Georgia, serif; font-size: 14px; font-weight: bold; cursor: pointer;"
                                onclick="switchSection('pricing'); return false;">
                            VIEW SUBSCRIPTION PLANS
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- PRICING SECTION -->
        <div class="content-section" id="pricingSection">
            <h2 style="text-align: center; margin-bottom: 30px; border-bottom: 3px solid #000; padding-bottom: 10px;">Subscription Pricing</h2>

            <p style="text-align: center; max-width: 800px; margin: 0 auto 40px; font-size: 15px; line-height: 1.6;">
                Comprehensive Data Center Intelligence | 4,436+ Facilities | 80+ Markets | Real-Time Permit Tracking
            </p>

            <!-- Pricing Tiers Grid -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 30px; max-width: 1100px; margin: 0 auto 40px;">

                <!-- BASIC TIER -->
                <div style="border: 3px solid #000; padding: 25px; background: #fffef5; position: relative; box-shadow: 4px 4px 0 #000;">
                    <div style="background: #000; color: #fff; border: 2px solid #000; padding: 8px; text-align: center; margin: -25px -25px 20px; font-weight: bold; letter-spacing: 1px;">
                        BASIC TIER
                    </div>
                    <div style="text-align: center; font-size: 28px; font-weight: bold; margin-bottom: 10px;">
                        $299<span style="font-size: 14px; font-weight: normal;">/month</span>
                    </div>
                    <p style="text-align: center; font-size: 13px; margin-bottom: 20px; font-style: italic;">
                        Self-service intelligence
                    </p>
                    <hr style="border: 1px solid #ccc; margin: 20px 0;">
                    <ul style="list-style: none; padding: 0; font-size: 13px; line-height: 2;">
                        <li>-  <strong>Full DC directory access</strong> (4,436+ facilities)</li>
                        <li>-  <strong>Certification data</strong> (SOC2, HIPAA, PCI, ISO27001)</li>
                        <li>-  <strong>Building permits database</strong> (2.52M permits, 32 cities)</li>
                        <li>-  <strong>Upcoming DCs map</strong> (coordinates only)</li>
                        <li>-  <strong>Weekly permit email alerts</strong></li>
                        <li>-  Monthly market reports</li>
                        <li>-  Data export (CSV/Excel)</li>
                        <li>-  Email support (48-hour response time)</li>
                        <li style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #ccc;"><strong>-  Study Guide Access: Core Fundamentals</strong></li>
                    </ul>
                    <button style="width: 100%; padding: 12px; margin-top: 20px; background: #000; color: #fff; border: 2px solid #000; font-family: Georgia, serif; font-size: 14px; font-weight: bold; cursor: pointer;"
                            onclick="alert('Stripe checkout integration - Coming soon!')">
                        SUBSCRIBE NOW
                    </button>
                </div>

                <!-- PREMIUM TIER -->
                <div style="border: 3px solid #000; padding: 25px; background: #fff; position: relative;">
                    <div style="background: #000; color: #fff; border: 2px solid #000; padding: 8px; text-align: center; margin: -25px -25px 20px; font-weight: bold; letter-spacing: 1px;">
                        PREMIUM TIER
                    </div>
                    <div style="text-align: center; font-size: 28px; font-weight: bold; margin-bottom: 10px;">
                        $999<span style="font-size: 14px; font-weight: normal;">/month</span>
                    </div>
                    <p style="text-align: center; font-size: 13px; margin-bottom: 20px; font-style: italic;">
                        Guided advisory
                    </p>
                    <hr style="border: 1px solid #ccc; margin: 20px 0;">
                    <ul style="list-style: none; padding: 0; font-size: 13px; line-height: 2;">
                        <li>-  Everything in Basic</li>
                        <li>-  <strong>Upcoming DCs with full project descriptions</strong></li>
                        <li>-  <strong>Quarterly advisor calls</strong> (4 calls per year)</li>
                        <li>-  <strong>DC matchmaking service</strong> (we find facilities for you)</li>
                        <li>-  <strong>Priority email support</strong> (4-hour response time)</li>
                        <li>-  <strong>Daily permit alerts</strong> (vs weekly in Basic)</li>
                        <li>-  <strong>Custom market report</strong> (1 per quarter)</li>
                        <li>-  <strong>Warm introductions</strong> to data center operators</li>
                        <li>-  <strong>Monthly market intelligence briefing</strong></li>
                        <li>-  <strong>Deal alert notifications</strong> (M&A, leases, announcements)</li>
                        <li style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #ccc;"><strong>-  Study Guide Access: Essential Infrastructure + Core Fundamentals</strong></li>
                    </ul>
                    <button style="width: 100%; padding: 12px; margin-top: 20px; background: #000; color: #fff; border: 2px solid #000; font-family: Georgia, serif; font-size: 14px; font-weight: bold; cursor: pointer;"
                            onclick="alert('Stripe checkout + Calendly integration - Coming soon!')">
                        SUBSCRIBE NOW
                    </button>
                </div>

                <!-- ENTERPRISE TIER (Coming Soon) -->
                <div style="border: 3px solid #000; padding: 25px; background: #fff; position: relative; opacity: 0.9;">
                    <!-- Coming Soon Badge -->
                    <div style="position: absolute; top: 15px; right: 15px; background: #ff6b00; color: #fff; padding: 5px 10px; font-size: 11px; font-weight: bold; letter-spacing: 1px; border: 2px solid #000;">
                        COMING SOON
                    </div>
                    <div style="background: #000; color: #fff; border: 2px solid #000; padding: 8px; text-align: center; margin: -25px -25px 20px; font-weight: bold; letter-spacing: 1px;">
                        ENTERPRISE TIER
                    </div>
                    <div style="text-align: center; font-size: 28px; font-weight: bold; margin-bottom: 10px;">
                        $2,499<span style="font-size: 14px; font-weight: normal;">/month</span>
                    </div>
                    <p style="text-align: center; font-size: 13px; margin-bottom: 5px; font-style: italic;">
                        Full-service advisory & brokerage
                    </p>
                    <p style="text-align: center; font-size: 12px; margin-bottom: 20px; color: #ff6b00; font-weight: bold;">
                        Available December 6, 2025
                    </p>
                    <hr style="border: 1px solid #ccc; margin: 20px 0;">
                    <ul style="list-style: none; padding: 0; font-size: 13px; line-height: 2;">
                        <li>-  Everything in Premium</li>
                        <li>-  <strong>Full permit history for upcoming DCs</strong> (descriptions + valuations)</li>
                        <li>-  <strong>DC News Archive</strong> (full historical archive of all DC-related articles)</li>
                        <li>-  <strong>2 advisor calls per month</strong> (24 calls per year)</li>
                        <li>-  <strong>Dedicated account manager</strong> (email/Slack)</li>
                        <li>-  <strong>Full RFQ management</strong> (we handle your RFP process)</li>
                        <li>-  <strong>Site visit coordination</strong></li>
                        <li>-  <strong>Pricing negotiation support</strong> (written strategy)</li>
                        <li>-  <strong>Contract review assistance</strong> (redlines & feedback)</li>
                        <li>-  <strong>Custom research projects</strong> (unlimited requests)</li>
                        <li>-  <strong>API access</strong> (programmatic data access)</li>
                        <li>-  <strong>White-glove concierge service</strong></li>
                        <li style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #ccc;"><strong>-  Study Guide Access: Complete Library (all guides)</strong></li>
                        <li style="margin-top: 10px; font-style: italic; color: #666;">+ Success fees: 5-10% of first year contract value</li>
                    </ul>
                    <button style="width: 100%; padding: 12px; margin-top: 20px; background: #fff; color: #000; border: 2px solid #000; font-family: Georgia, serif; font-size: 14px; font-weight: bold; cursor: pointer;"
                            onclick="alert('Enterprise tier launching December 6, 2025. Enter your email to be notified:\n\nsupport@dc-intel.com')">
                        NOTIFY ME
                    </button>
                </div>

            </div>

            <!-- Legal Disclaimer -->
            <div style="max-width: 900px; margin: 40px auto; padding: 20px; background: #f9f9f9; border: 2px solid #ccc; font-size: 12px; line-height: 1.6;">
                <p style="font-weight: bold; margin-bottom: 10px;">IMPORTANT DISCLAIMER:</p>
                <p>
                    DC-Intel is a market intelligence and advisory firm, <strong>not a licensed real estate broker</strong>. We provide data, analysis, and expert guidance to help you make informed decisions about data center site selection. We do not negotiate contracts on your behalf or represent operators. All final decisions and contract negotiations remain your responsibility.
                </p>
                <p style="margin-top: 10px;">
                    Premium tier consultation services are advisory in nature and do not constitute brokerage activities. Success fees (when applicable) are advisory completion bonuses paid by you for our ongoing advisory services through deal closure.
                </p>
            </div>

            <!-- FAQ Section -->
            <div style="max-width: 900px; margin: 0 auto 40px;">
                <h3 style="text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 25px; font-size: 18px; letter-spacing: 1px;">FREQUENTLY ASKED QUESTIONS</h3>

                <div style="margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #ccc;">
                    <p style="font-weight: bold; margin-bottom: 8px; font-size: 14px;">Why pay when brokers are free?</p>
                    <p style="font-size: 13px; line-height: 1.6;">
                        Traditional brokers work for the operator (who pays them), not you. They're incentivized to recommend the highest-paying operator, not the best fit for your needs. We work exclusively for you. Our fee-based model means we recommend what's actually best for your requirements.
                    </p>
                </div>

                <div style="margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #ccc;">
                    <p style="font-weight: bold; margin-bottom: 8px; font-size: 14px;">What's included in advisory services?</p>
                    <p style="font-size: 13px; line-height: 1.6;">
                        <strong>Premium tier ($999/month):</strong> Includes 1 quarterly advisor call (every 3 months) plus priority email support with 4-hour response times. Our experts help with site selection, market analysis, facility evaluation, and strategic planning.<br><br>
                        <strong>Enterprise tier ($2,499/month):</strong> Includes 2 advisor calls per month (24 calls per year) plus a dedicated account manager via email/Slack. You get unlimited consultation time, full RFQ management, site visit coordination, and white-glove concierge service.<br><br>
                        All tiers emphasize email-first communication for efficiency, with scheduled calls for strategic discussions and complex decision-making.
                    </p>
                </div>

                <div style="margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #ccc;">
                    <p style="font-weight: bold; margin-bottom: 8px; font-size: 14px;">Can I upgrade or downgrade my plan?</p>
                    <p style="font-size: 13px; line-height: 1.6;">
                        Yes! You can upgrade or downgrade your subscription at any time. Changes take effect at the start of your next billing cycle. Contact us at support@dc-intel.com to make changes.
                    </p>
                </div>
            </div>
        </div>

        <!-- SERVICES SECTION -->
        <div class="content-section" id="servicesSection">
            <h2 style="text-align: center; margin-bottom: 30px; border-bottom: 3px solid #000; padding-bottom: 10px;">Advisory & Intelligence Services</h2>

            <!-- Services Overview -->
            <div style="max-width: 900px; margin: 0 auto 40px; padding: 30px; background: #fffef5; border: 3px double #000;">
                <h3 style="text-align: center; margin-top: 0; font-size: 22px; border-bottom: 2px solid #000; padding-bottom: 15px; margin-bottom: 20px;">
                    We're Not Brokers       We're Your Data Center Intelligence Partner
                </h3>
                <p style="font-size: 15px; line-height: 1.8; margin-bottom: 15px;">
                    DC-Intel provides <strong>market intelligence and advisory services</strong> to help you make informed decisions about data center site selection, market analysis, and strategic planning. Unlike traditional brokers who work for operators, we work exclusively for you.
                </p>
                <p style="font-size: 15px; line-height: 1.8; margin-bottom: 20px;">
                    Our proprietary data platform combines <strong>4,436+ data center facilities</strong>, <strong>2.52M+ building permits from 32 cities</strong>, and <strong>real-time industry news</strong> to give you the competitive intelligence edge.
                </p>
                <div style="text-align: center;">
                    <button style="padding: 15px 40px; background: #000; color: #fff; border: 2px solid #000; font-family: Georgia, serif; font-size: 16px; font-weight: bold; cursor: pointer; margin-right: 15px;"
                            onclick="switchSection('pricing'); return false;">
                        VIEW PRICING PLANS
                    </button>
                    <button style="padding: 15px 40px; background: #fff; color: #000; border: 2px solid #000; font-family: Georgia, serif; font-size: 16px; font-weight: bold; cursor: pointer;"
                            onclick="alert('Contact us at support@dc-intel.com or schedule a demo')">
                        SCHEDULE A DEMO
                    </button>
                </div>
            </div>

            <!-- What We Offer -->
            <div style="max-width: 1100px; margin: 0 auto 40px;">
                <h3 style="text-align: center; margin-bottom: 30px; font-size: 20px; border-bottom: 2px solid #000; padding-bottom: 10px;">
                    What We Offer
                </h3>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px;">
                    <!-- Service 1: Market Intelligence -->
                    <div style="border: 3px solid #000; padding: 20px; background: #fff;">
                        <h4 style="margin-top: 0; font-size: 16px; border-bottom: 2px solid #ccc; padding-bottom: 10px;">          Market Intelligence</h4>
                        <ul style="font-size: 13px; line-height: 1.8; padding-left: 20px;">
                            <li>4,436+ data center facilities tracked</li>
                            <li>Certification data (SOC2, HIPAA, PCI-DSS, ISO27001)</li>
                            <li>2.52M+ building permits from 32 cities</li>
                            <li>Real-time industry news monitoring</li>
                            <li>Market heat maps & trend analysis</li>
                        </ul>
                        <p style="font-size: 12px; margin-top: 15px; font-style: italic; color: #666;">
                            Available in: Basic, Premium, Enterprise
                        </p>
                    </div>

                    <!-- Service 2: Advisory Services -->
                    <div style="border: 3px solid #000; padding: 20px; background: #fff;">
                        <h4 style="margin-top: 0; font-size: 16px; border-bottom: 2px solid #ccc; padding-bottom: 10px;">         Advisory Services</h4>
                        <ul style="font-size: 13px; line-height: 1.8; padding-left: 20px;">
                            <li>DC matchmaking service (find facilities for you)</li>
                            <li>Custom market reports (quarterly)</li>
                            <li>Warm introductions to operators</li>
                            <li>Deal alert notifications</li>
                            <li>Priority email support</li>
                        </ul>
                        <p style="font-size: 12px; margin-top: 15px; font-style: italic; color: #666;">
                            Available in: Premium, Enterprise
                        </p>
                    </div>

                    <!-- Service 3: Full-Service Support -->
                    <div style="border: 3px solid #000; padding: 20px; background: #fff;">
                        <h4 style="margin-top: 0; font-size: 16px; border-bottom: 2px solid #ccc; padding-bottom: 10px;">         Full-Service Support</h4>
                        <ul style="font-size: 13px; line-height: 1.8; padding-left: 20px;">
                            <li>RFQ/RFP management</li>
                            <li>Site visits coordination</li>
                            <li>Pricing negotiations assistance</li>
                            <li>Contract review support</li>
                            <li>White-glove concierge service</li>
                        </ul>
                        <p style="font-size: 12px; margin-top: 15px; font-style: italic; color: #666;">
                            Available in: Enterprise tier only
                        </p>
                    </div>
                </div>
            </div>

            <!-- Pricing CTA -->
            <div style="max-width: 900px; margin: 0 auto; padding: 30px; background: #f9f9f9; border: 3px double #000; text-align: center;">
                <h3 style="margin-top: 0; font-size: 20px;">Ready to Get Started?</h3>
                <p style="font-size: 15px; line-height: 1.7; margin-bottom: 25px;">
                    Choose from our <strong>Basic ($299/mo)</strong>, <strong>Premium ($999/mo)</strong>, or <strong>Enterprise ($2,499/mo)</strong> plans.
                    Each tier is designed to match your level of need       from self-service data access to full white-glove advisory.
                </p>

                <!-- Study Guide Inclusions -->
                <div style="background: #fff; padding: 20px; margin: 20px 0; border: 2px solid #000; text-align: left;">
                    <h4 style="margin-top: 0; margin-bottom: 15px; font-size: 16px; text-align: center; border-bottom: 1px solid #ddd; padding-bottom: 10px;">
                        Study Guide Access Included with Each Tier
                    </h4>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; font-size: 14px;">
                        <!-- Basic -->
                        <div style="padding: 15px; background: #f5f5f5; border: 1px solid #ddd;">
                            <div style="font-weight: bold; margin-bottom: 8px; color: #000;">Basic</div>
                            <div style="font-size: 13px; color: #666; line-height: 1.6;">
                                <strong>Core Fundamentals</strong><br>
                                Essential foundational knowledge
                            </div>
                        </div>

                        <!-- Premium -->
                        <div style="padding: 15px; background: #f5f5f5; border: 1px solid #ddd;">
                            <div style="font-weight: bold; margin-bottom: 8px; color: #000;">Premium</div>
                            <div style="font-size: 13px; color: #666; line-height: 1.6;">
                                <strong>Essential Infrastructure</strong><br>
                                + Core Fundamentals<br>
                                <em style="color: #999;">(2 packages)</em>
                            </div>
                        </div>

                        <!-- Enterprise -->
                        <div style="padding: 15px; background: #f5f5f5; border: 1px solid #ddd;">
                            <div style="font-weight: bold; margin-bottom: 8px; color: #000;">Enterprise</div>
                            <div style="font-size: 13px; color: #666; line-height: 1.6;">
                                <strong>Complete Library</strong><br>
                                All study guides included<br>
                                <em style="color: #999;">(Full access)</em>
                            </div>
                        </div>
                    </div>
                </div>
                <button style="padding: 15px 40px; background: #000; color: #fff; border: 2px solid #000; font-family: Georgia, serif; font-size: 16px; font-weight: bold; cursor: pointer;"
                        onclick="switchSection('pricing'); return false;">
                    SEE ALL PRICING OPTIONS
                </button>
            </div>
        </div>

        <!-- EXISTING DCS SECTION -->
        <div class="content-section" id="existingDCsSection">
            <h2 style="text-align: center; margin-bottom: 20px; border-bottom: 3px solid #000; padding-bottom: 10px;">Existing Data Centers Database</h2>

            <!-- Tabs for Existing DCs -->
            <div style="text-align: center; margin-bottom: 20px; border-bottom: 2px solid #ccc;">
                <a href="#" onclick="showExistingTab('heatmap'); return false;" id="existingTabHeatmap" style="display: inline-block; padding: 10px 20px; margin: 0 5px; font-weight: bold; color: #000; text-decoration: none; border-bottom: 3px solid #000;">Heatmap</a>
                <a href="#" onclick="showExistingTab('table'); return false;" id="existingTabTable" style="display: inline-block; padding: 10px 20px; margin: 0 5px; font-weight: bold; color: #666; text-decoration: none; border-bottom: 3px solid transparent;">Table View</a>
                <a href="#" onclick="showExistingTab('contact'); return false;" id="existingTabContact" style="display: inline-block; padding: 10px 20px; margin: 0 5px; font-weight: bold; color: #666; text-decoration: none; border-bottom: 3px solid transparent;">Request Data</a>
            </div>

            <div id="existingTabHeatmapContent" style="display: block;">
                <div id="heatmapViz" class="heatmap-container"></div>
            </div>

            <div id="existingTabTableContent" style="display: none;">
                <div style="background: #f9f9f9; padding: 20px; border: 2px solid #000;">
                    <div style="margin-bottom: 12px; display: flex; flex-wrap: wrap; gap: 10px; align-items: center;">
                        <input id="existingSearch" type="text" placeholder="Filter existing DCs (name, city, state, provider, certs)" style="flex: 1 1 240px; padding: 10px; border: 2px solid #000; font-size: 12px;">
                        <button onclick="clearExistingFilter()" style="padding: 10px 14px; border: 2px solid #000; background: #fff; cursor: pointer; font-weight: bold;">Clear</button>
                        <div id="existingExportBtns" style="display: none; gap: 10px;">
                            <button onclick="exportExistingDCsToCSV()" style="padding: 10px 16px; border: 2px solid #000; background: #fff; cursor: pointer; font-weight: bold; transition: all 0.2s;"> CSV</button>
                            <button onclick="exportExistingDCsToExcel()" style="padding: 10px 16px; border: 2px solid #000; background: #e8f5e9; cursor: pointer; font-weight: bold; transition: all 0.2s;"> Excel</button>
                        </div>
                    </div>
                    <p style="text-align: center; margin-bottom: 15px;">Comprehensive table view of all existing data centers</p>
                    <div id="existingDCsTableView"></div>
                </div>
            </div>

            <div id="existingTabContactContent" style="display: none;">
                <div style="max-width: 600px; margin: 0 auto; background: #f9f9f9; padding: 30px; border: 2px solid #000;">
                    <h3 style="text-align: center; margin-bottom: 20px;">Request Existing DC Data</h3>
                    <form onsubmit="handleServiceRequest(event, 'Existing DC Data')">
                        <div class="form-group">
                            <label>Your Name</label>
                            <input type="text" name="name" required>
                        </div>
                        <div class="form-group">
                            <label>Company</label>
                            <input type="text" name="company" required>
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" name="email" required>
                        </div>
                        <div class="form-group">
                            <label>Phone Number</label>
                            <input type="tel" name="phone">
                        </div>
                        <div class="form-group">
                            <label>Specific Requirements</label>
                            <textarea name="requirements" rows="4" placeholder="Tell us what specific data or regions you're interested in..."></textarea>
                        </div>
                        <button type="submit" class="form-submit">Submit Request</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- UPCOMING DCS SECTION -->
        <div class="content-section" id="upcomingDCsSection">
            <h2 style="text-align: center; margin-bottom: 20px; border-bottom: 3px solid #000; padding-bottom: 10px;">Upcoming Data Center Projects</h2>
            <p style="text-align: center; margin-bottom: 20px; font-size: 13px;">Intelligence gathered from industry news sources and public construction permits nationwide</p>

            <!-- Tabs for Upcoming DCs -->
            <div style="text-align: center; margin-bottom: 20px; border-bottom: 2px solid #ccc;">
                <a href="#" onclick="showUpcomingTab('heatmap'); return false;" id="upcomingTabHeatmap" style="display: inline-block; padding: 10px 20px; margin: 0 5px; font-weight: bold; color: #000; text-decoration: none; border-bottom: 3px solid #000;">Heatmap</a>
                <a href="#" onclick="showUpcomingTab('table'); return false;" id="upcomingTabTable" style="display: inline-block; padding: 10px 20px; margin: 0 5px; font-weight: bold; color: #666; text-decoration: none; border-bottom: 3px solid transparent;">Project Table</a>
                <a href="#" onclick="showUpcomingTab('contact'); return false;" id="upcomingTabContact" style="display: inline-block; padding: 10px 20px; margin: 0 5px; font-weight: bold; color: #666; text-decoration: none; border-bottom: 3px solid transparent;">Request Data</a>
            </div>

            <div id="upcomingTabHeatmapContent" style="display: block;">
                <div id="upcomingHeatmap" class="heatmap-container"></div>
            </div>

            <div id="upcomingTabTableContent" style="display: none;">
                <div style="margin-bottom: 12px; display: flex; flex-wrap: wrap; gap: 10px; align-items: center;">
                    <input id="upcomingSearch" type="text" placeholder="Filter upcoming DCs (location, status, provider)" style="flex: 1 1 240px; padding: 10px; border: 2px solid #000; font-size: 12px;">
                    <button onclick="clearUpcomingFilter()" style="padding: 10px 14px; border: 2px solid #000; background: #fff; cursor: pointer; font-weight: bold;">Clear</button>
                    <div id="upcomingExportBtns" style="display: none; gap: 10px;">
                        <button onclick="exportUpcomingDCsToCSV()" style="padding: 10px 16px; border: 2px solid #000; background: #fff; cursor: pointer; font-weight: bold; transition: all 0.2s;"> CSV</button>
                        <button onclick="exportUpcomingDCsToExcel()" style="padding: 10px 16px; border: 2px solid #000; background: #e8f5e9; cursor: pointer; font-weight: bold; transition: all 0.2s;"> Excel</button>
                    </div>
                </div>
                <h3 style="text-align: center; margin: 20px 0 15px; font-size: 16px;">Project Details</h3>
                <div id="upcomingDCsTable" style="background: #f9f9f9; padding: 20px; border: 2px solid #000; overflow-x: auto;"></div>
            </div>

            <div id="upcomingTabContactContent" style="display: none;">
                <div style="max-width: 600px; margin: 0 auto; background: #f9f9f9; padding: 30px; border: 2px solid #000;">
                    <h3 style="text-align: center; margin-bottom: 20px;">Request Upcoming DC Project Data</h3>
                    <form onsubmit="handleServiceRequest(event, 'Upcoming DC Projects')">
                        <div class="form-group">
                            <label>Your Name</label>
                            <input type="text" name="name" required>
                        </div>
                        <div class="form-group">
                            <label>Company</label>
                            <input type="text" name="company" required>
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" name="email" required>
                        </div>
                        <div class="form-group">
                            <label>Phone Number</label>
                            <input type="tel" name="phone">
                        </div>
                        <div class="form-group">
                            <label>Project Focus Areas</label>
                            <textarea name="requirements" rows="4" placeholder="Tell us what regions, project types, or specific information you need..."></textarea>
                        </div>
                        <button type="submit" class="form-submit">Submit Request</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- LOGIN MODAL -->
    <div class="modal-overlay" id="loginModal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal('loginModal', event)">&times;</span>
            <img src="9e224nbi.png" alt="DC Intel Logo" class="modal-logo">
            <div class="modal-header">Sign In</div>
            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" name="email" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" name="password" required>
                </div>
                <button type="submit" class="form-submit">Sign In</button>
            </form>
        </div>
    </div>

    <!-- REGISTER MODAL -->
    <div class="modal-overlay" id="registerModal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal('registerModal', event)">&times;</span>
            <img src="9e224nbi.png" alt="DC Intel Logo" class="modal-logo">
            <div class="modal-header">Register</div>
            <form id="registerForm" onsubmit="handleRegister(event)">
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" name="name" required>
                </div>
                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" name="email" required>
                </div>
                <div class="form-group">
                    <label>Company</label>
                    <input type="text" name="company" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" name="password" required minlength="8">
                </div>
                <div class="form-group">
                    <label>Confirm Password</label>
                    <input type="password" name="confirm_password" required>
                </div>
                <button type="submit" class="form-submit">Register</button>
            </form>
        </div>
    </div>

    <!-- SERVICE REQUEST MODALS -->
    <div class="modal-overlay" id="serviceModal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal('serviceModal')">&times;</span>
            <div class="modal-header" id="serviceModalTitle">Request Service</div>
            <form id="serviceForm" onsubmit="handleServiceRequest(event)">
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" name="name" required>
                </div>
                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" name="email" required>
                </div>
                <div class="form-group">
                    <label>Company</label>
                    <input type="text" name="company" required>
                </div>
                <div class="form-group">
                    <label>Phone</label>
                    <input type="tel" name="phone">
                </div>
                <div class="form-group">
                    <label>Details</label>
                    <textarea name="details" rows="4" placeholder="Please provide details about your requirements..."></textarea>
                </div>
                <button type="submit" class="form-submit">Submit Request</button>
            </form>
        </div>
    </div>

    <!-- EMAIL CAPTURE MODAL (for unlocking certifications data) -->
    <div class="modal-overlay" id="emailCaptureModal">
        <div class="modal-content" style="max-width: 500px;">
            <span class="modal-close" onclick="closeEmailCaptureModal()">&times;</span>
            <div class="modal-header">          Unlock Certification Data</div>
            <div style="padding: 20px; font-size: 14px; line-height: 1.6;">
                <p style="margin-bottom: 15px;">Enter your email to unlock <strong>certification columns</strong> (SOC2, HIPAA, PCI-DSS, ISO27001) for all 4,436+ data centers.</p>
                <p style="margin-bottom: 15px; font-size: 13px; color: #666;">This is completely free. We'll only send you occasional updates about new DC intel.</p>
                <form id="emailCaptureForm" onsubmit="handleEmailCapture(event)">
                    <div class="form-group">
                        <label>Email Address</label>
                        <input type="email" id="emailCaptureInput" name="email" required placeholder="your@email.com">
                    </div>
                    <button type="submit" class="form-submit" style="width: 100%;">Unlock Certifications Data</button>
                </form>
                <p style="margin-top: 15px; font-size: 11px; color: #999; text-align: center;">
                    Want even more data? <a href="#" onclick="closeEmailCaptureModal(); switchSection('pricing'); return false;" style="color: #667eea; text-decoration: underline;">View Paid Plans</a>
                </p>
            </div>
        </div>
    </div>

    <div class="ticker">
        <div class="ticker-content" id="tickerContent">
            LATEST: Google announces Virginia expansion       AWS Dallas project valued at $500M       Equinix opens new Ashburn facility       Microsoft Azure capacity doubles in Phoenix       QTS reports record quarter       Switch announces Nevada mega-campus       Approximately 700,000 permits tracked nationwide       Over 1,000 confirmed data center projects       Real-time intelligence via DC Intel API
        </div>
    </div>

    <script>
        // Session persistence enabled - users stay signed in across pages
        // Storage is only cleared on explicit logout or browser close

        const API_BASE = 'http://127.0.0.1:8010';
        const API_KEY = 'keepongoing';

        // Public Data API Configuration (tier-based access via JWT)
        const PUBLIC_API_BASE = 'https://dc-intel-api.onrender.com';

        // Helper function to get authentication headers with JWT token
        function authHeaders() {
            const token = localStorage.getItem('dc_intel_token');
            if (token && !token.startsWith('test_token_')) {
                return { 'Authorization': `Bearer ${token}` };
            }
            return {};
        }

        // User subscription tier management
        // Tiers: 'free', 'basic', 'premium', 'enterprise'
        // For demo purposes, defaulting to 'free'. In production, this would be fetched from auth/session
        // Initialize from localStorage or defaults
        let userTier = localStorage.getItem('dc_intel_tier') || 'free';
        let userEmail = localStorage.getItem('dc_intel_email') || null;
        let hasEmailAccess = !!userEmail; // True if user provided email
        let taxonomyLoaded = false;
        let existingSort = { key: null, dir: 1 };
        let upcomingSort = { key: 'firstSeen', dir: -1 }; // Default: sort by newest dates first
        let upcomingSourceFilter = 'all'; // Filter by data source: 'all', 'news', or 'permit'

        // Helper function to check tier access
        function hasTierAccess(requiredTier) {
            const tierLevels = { 'free': 0, 'basic': 1, 'premium': 2, 'enterprise': 3 };
            return tierLevels[userTier] >= tierLevels[requiredTier];
        }

        function setExistingSort(key) {
            if (existingSort.key === key) {
                existingSort.dir *= -1;
            } else {
                existingSort.key = key;
                existingSort.dir = 1;
            }
            loadExistingDCs();
        }

        function setUpcomingSort(key) {
            // Special handling for "source" column: 3-state toggle
            if (key === 'source') {
                if (upcomingSort.key === 'source' && upcomingSort.dir === 1) {
                    // First click: news first (dir=1) -> Second click: permits first (dir=-1)
                    upcomingSort.dir = -1;
                } else if (upcomingSort.key === 'source' && upcomingSort.dir === -1) {
                    // Second click: permits first -> Third click: reset to default (newest dates first)
                    upcomingSort.key = 'firstSeen';
                    upcomingSort.dir = -1;
                } else {
                    // Not currently sorted by source -> First click: show news first
                    upcomingSort.key = 'source';
                    upcomingSort.dir = 1;
                }
            } else {
                // Standard 2-state toggle for other columns
                if (upcomingSort.key === key) {
                    upcomingSort.dir *= -1;
                } else {
                    upcomingSort.key = key;
                    upcomingSort.dir = 1;
                }
            }
            loadUpcomingDCs();
        }

        function filterUpcomingBySource(source) {
            upcomingSourceFilter = source;

            // Update button styles
            const allBtn = document.getElementById('filterAll');
            const newsBtn = document.getElementById('filterNews');
            const permitBtn = document.getElementById('filterPermit');

            if (allBtn) allBtn.style.background = source === 'all' ? '#000' : '#fff';
            if (allBtn) allBtn.style.color = source === 'all' ? '#fff' : '#000';
            if (newsBtn) newsBtn.style.background = source === 'news' ? '#000' : '#fff';
            if (newsBtn) newsBtn.style.color = source === 'news' ? '#fff' : '#000';
            if (permitBtn) permitBtn.style.background = source === 'permit' ? '#000' : '#fff';
            if (permitBtn) permitBtn.style.color = source === 'permit' ? '#fff' : '#000';

            loadUpcomingDCs();
        }

        // Helper function to check if user has email access (unlocked certifications)
        function hasEmailGateAccess() {
            return hasEmailAccess || hasTierAccess('basic'); // Paid tiers get it automatically
        }

        // Helper function to set tier (for testing - remove in production)
        function setTier(tier) {
            userTier = tier;
            localStorage.setItem('dc_intel_tier', tier);
            console.log(`User tier set to: ${tier}`);
            // Reload current section
            const currentSection = document.querySelector('.content-section:not([style*="display: none"])');
            if (currentSection && currentSection.id === 'upcomingDCsSection') {
                loadUpcomingDCs();
            } else if (currentSection && currentSection.id === 'existingDCsSection') {
                loadExistingDCs();
            }
        }

        // Email capture modal functions
        function showEmailCaptureModal() {
            document.getElementById('emailCaptureModal').classList.add('active');
        }

        function closeEmailCaptureModal() {
            document.getElementById('emailCaptureModal').classList.remove('active');
        }

        function handleEmailCapture(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const email = formData.get('email');

            // Store email in localStorage
            localStorage.setItem('dc_intel_email', email);
            userEmail = email;
            hasEmailAccess = true;

            console.log('Email captured:', email);

            // Close modal
            closeEmailCaptureModal();

            // Show success message
            alert('Thank you! Certification data is now unlocked. Refreshing the table...');

            // Reload Existing DCs to show unlocked columns
            loadExistingDCs();
        }

        // Helper to clear email (for testing)
        function clearEmail() {
            localStorage.removeItem('dc_intel_email');
            userEmail = null;
            hasEmailAccess = false;
            console.log('Email cleared. Reload page to see locked state.');
            loadExistingDCs();
        }

        // Authentication functions
        function showLogin() {
            document.getElementById('loginModal').classList.add('active');
        }

        function showRegister() {
            document.getElementById('registerModal').classList.add('active');
        }

        function closeModal(modalId, event) {
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
            }
            return false;
        }

        // Simple modal handlers - click outside to close
        document.addEventListener('DOMContentLoaded', function() {
            // Close modal when clicking on the dark overlay (not on the modal content)
            document.querySelectorAll('.modal-overlay').forEach(overlay => {
                overlay.addEventListener('click', function(e) {
                    // Only close if clicking directly on the overlay background
                    if (e.target.classList.contains('modal-overlay')) {
                        e.preventDefault();
                        e.stopPropagation();
                        closeModal(overlay.id, e);
                    }
                });
            });
        });

        async function handleLogin(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            const email = formData.get('email');
            const password = formData.get('password');

            // TEST ACCOUNTS - For testing tier access
            const testAccounts = {
                'basic@test.com': { password: 'basic123', name: 'Basic User', tier: 'basic' },
                'premium@test.com': { password: 'premium123', name: 'Premium User', tier: 'premium' },
                'enterprise@test.com': { password: 'enterprise123', name: 'Enterprise User', tier: 'enterprise' }
            };

            // Check for test account first
            if (testAccounts[email]) {
                const account = testAccounts[email];
                if (password === account.password) {
                    // Successful test account login
                    const user = {
                        email: email,
                        name: account.name,
                        tier: account.tier
                    };
                    localStorage.setItem('dc_intel_token', 'test_token_' + Date.now());
                    localStorage.setItem('dc_intel_user', JSON.stringify(user));
                    localStorage.setItem('dc_intel_tier', account.tier);
                    userTier = account.tier;  // Update global tier variable

                    // Reload page immediately to refresh the UI
                    window.location.reload();
                    return;
                } else {
                    alert('Invalid password for test account.');
                    return;
                }
            }

            // If not a test account, try backend JWT API
            try {
                const response = await fetch(`${PUBLIC_API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email: email,
                        password: password
                    })
                });

                if (!response.ok) {
                    const error = await response.json();
                    alert(error.detail || 'Login failed. Please check your credentials.');
                    return;
                }

                const data = await response.json();

                // JWT auth response: {access_token, token_type, tier, expires_in}
                if (data.access_token) {
                    localStorage.setItem('dc_intel_token', data.access_token);
                    localStorage.setItem('dc_intel_tier', data.tier);
                    localStorage.setItem('dc_intel_user', JSON.stringify({
                        email: email,
                        tier: data.tier
                    }));
                    userTier = data.tier;

                    // Reload page immediately to refresh the UI
                    window.location.reload();
                } else {
                    alert('Login failed. Invalid response from server.');
                }
            } catch (error) {
                console.error('Login error:', error);
                alert('Login failed. Backend API not available. Use test accounts: basic@test.com, premium@test.com, or enterprise@test.com');
            }
        }

        async function handleRegister(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);

            if (formData.get('password') !== formData.get('confirm_password')) {
                alert('Passwords do not match!');
                return;
            }

            try {
                const response = await fetch(`${PUBLIC_API_BASE}/api/auth/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-API-Key': API_KEY
                    },
                    body: JSON.stringify({
                        name: formData.get('name'),
                        email: formData.get('email'),
                        company: formData.get('company'),
                        password: formData.get('password')
                    })
                });

                const data = await response.json();

                if (data.ok || data.token) {
                    localStorage.setItem('dc_intel_token', data.token);
                    localStorage.setItem('dc_intel_user', JSON.stringify(data.user));
                    updateAuthUI(data.user);
                    closeModal('registerModal');
                    alert('Registration successful! Welcome to DC Intel.');
                } else {
                    alert(data.error || 'Registration failed. Please try again.');
                }
            } catch (error) {
                console.error('Registration error:', error);
                alert('Registration failed. This feature requires server implementation.');
            }
        }

        function logout() {
            // Clear ALL stored data on logout
            localStorage.clear();
            sessionStorage.clear();
            userTier = 'free';
            hasEmailAccess = false;
            userEmail = null;
            updateAuthUI(null);
            if (typeof updateTierVisibility === 'function') {
                updateTierVisibility();
            }
            alert('You have been logged out.');
            // Reload page to reset all content and tier access
            window.location.reload();
        }

        function updateAuthUI(user) {
            const authButtons = document.getElementById('authButtons');
            const userInfo = document.getElementById('userInfo');
            const logoutFallback = document.getElementById('logoutFallback');

            if (user) {
                authButtons.style.display = 'none';
                userInfo.style.display = 'block';
                document.getElementById('userName').textContent = user.name || user.email;
                if (logoutFallback) logoutFallback.style.display = 'inline-block';
            } else {
                authButtons.style.display = 'flex';
                userInfo.style.display = 'none';
                if (logoutFallback) logoutFallback.style.display = 'none';
            }
        }

        // Check if user is already logged in on page load
        (function checkAuth() {
            const token = localStorage.getItem('dc_intel_token');
            const userStr = localStorage.getItem('dc_intel_user');
            if (token && userStr) {
                try {
                    const user = JSON.parse(userStr);
                    // ALWAYS restore tier from localStorage
                    const storedTier = localStorage.getItem('dc_intel_tier');
                    if (storedTier) {
                        userTier = storedTier;
                    } else if (user.tier) {
                        // Fallback: set from user object if not in localStorage
                        localStorage.setItem('dc_intel_tier', user.tier);
                        userTier = user.tier;
                    }
                    console.log('Auth restored - User:', user.email, 'Tier:', userTier);
                    updateAuthUI(user);
                } catch (e) {
                    console.error('checkAuth error:', e);
                    localStorage.removeItem('dc_intel_token');
                    localStorage.removeItem('dc_intel_user');
                    localStorage.removeItem('dc_intel_tier');
                }
            }
        })();

        // Initialize on page load - clear session and update tier visibility
        window.addEventListener('load', function() {
            console.log('Initializing dashboard - restoring session if available...');

            // CRITICAL: Hide ALL overlays to ensure buttons are clickable
            const loadingOverlay = document.getElementById('loadingOverlay');
            if (loadingOverlay) {
                loadingOverlay.classList.remove('active');
                console.log('Loading overlay hidden');
            }

            // Hide any modal overlays that might be stuck active
            const modalOverlays = document.querySelectorAll('.modal-overlay');
            modalOverlays.forEach(function(modal) {
                modal.classList.remove('active');
            });
            console.log('All modal overlays hidden - buttons should now be clickable');

            // Refresh tier visibility using stored tier (or default 'free')
            userTier = localStorage.getItem('dc_intel_tier') || userTier || 'free';
            console.log(`Session restored. Current tier: ${userTier}`);
            if (typeof updateTierVisibility === 'function') {
                updateTierVisibility();
                console.log('Tier visibility initialized based on stored tier/email access');
            } else {
                console.error('updateTierVisibility function not found');
            }
        });

        // Hexbin Heatmap Rendering Function
        async function renderHexbinHeatmap(containerId) {
            try {
                // Load enriched geocoded data from API
                const response = await fetch(`${PUBLIC_API_BASE}/existing-dcs`, {
                    headers: authHeaders()
                });
                const data = await response.json();
                const dcData = data.items || [];

                console.log(`Loaded ${dcData.length} DCs with coordinates`);

                // Clear existing content
                const container = document.getElementById(containerId);
                container.innerHTML = `
                    <h3 style="text-align: center; margin-bottom: 15px;">Data Center Geographic Distribution (Hexbin Heatmap)</h3>
                    <div id="hexmapContainer" style="width: 100%; margin-bottom: 20px;"></div>
                    <div class="hexmap-legend" style="text-align: center; clear: both;">
                        <h4 style="margin-bottom: 10px;">Density Legend</h4>
                        <div style="display: inline-block;">
                            <div class="legend-item"><span class="legend-color" style="background: #fee5d9"></span> 1-2 DCs</div>
                            <div class="legend-item"><span class="legend-color" style="background: #fcae91"></span> 3-5 DCs</div>
                            <div class="legend-item"><span class="legend-color" style="background: #fb6a4a"></span> 6-10 DCs</div>
                            <div class="legend-item"><span class="legend-color" style="background: #de2d26"></span> 11-20 DCs</div>
                            <div class="legend-item"><span class="legend-color" style="background: #a50f15"></span> 20+ DCs</div>
                        </div>
                        <p style="margin-top: 10px; font-size: 12px;">Hover over hexagons to see details. Showing ${dcData.length} geocoded data centers.</p>
                    </div>
                    <div class="hexmap-tooltip"></div>
                `;

                // Set up dimensions - force wide landscape US map (2:1 ratio like 16x8 or 18x9)
                const width = 1200;
                const height = 500;
                const margin = {top: 10, right: 10, bottom: 10, left: 10};

                // Create SVG
                const svg = d3.select('#hexmapContainer')
                    .append('svg')
                    .attr('width', '100%')
                    .attr('height', height)
                    .attr('viewBox', `0 0 ${width} ${height}`)
                    .attr('preserveAspectRatio', 'xMidYMid meet');

                // Create projection for US map
                const projection = d3.geoAlbersUsa()
                    .scale(1300)
                    .translate([width / 2, height / 2]);

                // Project DC coordinates
                const projectedData = dcData
                    .map(d => {
                        const projected = projection([d.longitude, d.latitude]);
                        if (projected) {
                            return {
                                ...d,
                                x: projected[0],
                                y: projected[1]
                            };
                        }
                        return null;
                    })
                    .filter(d => d !== null);

                console.log(`Projected ${projectedData.length} DCs onto map`);

                // Create hexbin generator - larger radius for prominent honeycomb cells
                const hexbin = d3.hexbin()
                    .radius(20)
                    .extent([[margin.left, margin.top], [width - margin.right, height - margin.bottom]]);

                // Generate hexbins
                const bins = hexbin(projectedData.map(d => [d.x, d.y]));

                // Color scale
                const colorScale = d3.scaleThreshold()
                    .domain([1, 3, 6, 11, 20])
                    .range(['#fee5d9', '#fcae91', '#fb6a4a', '#de2d26', '#a50f15']);

                // Tooltip
                const tooltip = d3.select('.hexmap-tooltip');

                // Draw hexagons - prominent honeycomb cells
                svg.append('g')
                    .selectAll('path')
                    .data(bins)
                    .join('path')
                    .attr('class', 'hexagon')
                    .attr('d', hexbin.hexagon())
                    .attr('transform', d => `translate(${d.x},${d.y})`)
                    .attr('fill', d => colorScale(d.length))
                    .attr('fill-opacity', 0.9)
                    .attr('stroke', '#333')
                    .attr('stroke-width', 1.5)
                    .on('mouseover', function(event, d) {
                        // Get DC details for this hexbin
                        const dcs = d.map(point => {
                            const dc = projectedData.find(dc => dc.x === point[0] && dc.y === point[1]);
                            return dc;
                        }).filter(dc => dc);

                        const providers = [...new Set(dcs.map(dc => dc.provider))].slice(0, 5);
                        const cities = [...new Set(dcs.map(dc => dc.city))].slice(0, 5);

                        tooltip.style('opacity', 1)
                            .html(`
                                <strong>${d.length} Data Center${d.length > 1 ? 's' : ''}</strong><br/>
                                <strong>Providers:</strong> ${providers.join(', ')}${providers.length < dcs.length ? '...' : ''}<br/>
                                <strong>Cities:</strong> ${cities.join(', ')}${cities.length < [...new Set(dcs.map(dc => dc.city))].length ? '...' : ''}
                            `)
                            .style('left', (event.pageX + 10) + 'px')
                            .style('top', (event.pageY - 10) + 'px');
                    })
                    .on('mouseout', function() {
                        tooltip.style('opacity', 0);
                    });

                console.log(`Rendered ${bins.length} hexagons`);

            } catch (error) {
                console.error('Error rendering hexbin heatmap:', error);
                document.getElementById(containerId).innerHTML = `
                    <p style="text-align: center; padding: 40px;">
                        Unable to load hexbin heatmap. Please ensure geocoded data is available.
                    </p>
                `;
            }
        }

        // Hexbin Heatmap Rendering Function for Upcoming DCs
        async function renderUpcomingHexbinHeatmap(containerId) {
            try {
                // Load geocoded upcoming DC data
                const response = await fetch('upcoming_dcs_geocoded.json');
                const upcomingData = await response.json();

                console.log(`Loaded ${upcomingData.length} upcoming DCs with coordinates`);

                // Clear existing content
                const container = document.getElementById(containerId);
                container.innerHTML = `
                    <h3 style="text-align: center; margin-bottom: 15px;">Upcoming Data Center Projects (Hexbin Heatmap)</h3>
                    <div id="upcomingHexmapContainer"></div>
                    <div class="hexmap-legend">
                        <h4>Project Density Legend</h4>
                        <div class="legend-item"><span class="legend-color" style="background: #c7e9c0"></span> 1-2 Projects</div>
                        <div class="legend-item"><span class="legend-color" style="background: #74c476"></span> 3-5 Projects</div>
                        <div class="legend-item"><span class="legend-color" style="background: #31a354"></span> 6-10 Projects</div>
                        <div class="legend-item"><span class="legend-color" style="background: #006d2c"></span> 11+ Projects</div>
                        <p style="margin-top: 10px; font-size: 12px;">Hover over hexagons to see details. Showing ${upcomingData.length} upcoming projects.</p>
                    </div>
                    <div class="hexmap-tooltip"></div>
                `;

                // Set up dimensions - FORCE WIDE LANDSCAPE (2:1 ratio)
                const width = 960;
                const height = 500;
                const margin = {top: 10, right: 10, bottom: 10, left: 10};

                // Create SVG - lock into wide aspect ratio
                const svg = d3.select('#upcomingHexmapContainer')
                    .append('svg')
                    .attr('viewBox', `0 0 ${width} ${height}`)
                    .attr('preserveAspectRatio', 'xMidYMid meet')
                    .style('width', '100%')
                    .style('height', 'auto');

                // Load US GeoJSON for fitSize (creates a dummy feature covering US bounds)
                const usBounds = {
                    type: "FeatureCollection",
                    features: [{
                        type: "Feature",
                        geometry: {
                            type: "Polygon",
                            coordinates: [[
                                [-125, 49], [-125, 24], [-66, 24], [-66, 49], [-125, 49]
                            ]]
                        }
                    }]
                };

                // Create projection - FORCE FIT TO WIDE CANVAS
                const projection = d3.geoAlbersUsa()
                    .fitSize([width - margin.left - margin.right, height - margin.top - margin.bottom], usBounds);

                // Project upcoming DC coordinates
                const projectedData = upcomingData
                    .map(d => {
                        const projected = projection([d.longitude, d.latitude]);
                        if (projected) {
                            return {
                                ...d,
                                x: projected[0],
                                y: projected[1]
                            };
                        }
                        return null;
                    })
                    .filter(d => d !== null);

                console.log(`Projected ${projectedData.length} upcoming DCs onto map`);

                // Create hexbin generator - larger radius for prominent cells
                const hexbin = d3.hexbin()
                    .radius(20)
                    .extent([[margin.left, margin.top], [width - margin.right, height - margin.bottom]]);

                // Generate hexbins
                const bins = hexbin(projectedData.map(d => [d.x, d.y]));

                // Color scale (green theme for upcoming projects)
                const colorScale = d3.scaleThreshold()
                    .domain([1, 3, 6, 11])
                    .range(['#c7e9c0', '#74c476', '#31a354', '#006d2c']);

                // Tooltip
                const tooltip = d3.select('.hexmap-tooltip');

                // Draw hexagons - prominent honeycomb cells
                svg.append('g')
                    .selectAll('path')
                    .data(bins)
                    .join('path')
                    .attr('class', 'hexagon')
                    .attr('d', hexbin.hexagon())
                    .attr('transform', d => `translate(${d.x},${d.y})`)
                    .attr('fill', d => colorScale(d.length))
                    .attr('fill-opacity', 0.9)
                    .attr('stroke', '#333')
                    .attr('stroke-width', 1.5)
                    .on('mouseover', function(event, d) {
                        // Get project details for this hexbin
                        const projects = d.map(point => {
                            const project = projectedData.find(p => p.x === point[0] && p.y === point[1]);
                            return project;
                        }).filter(p => p);

                        const cities = [...new Set(projects.map(p => p.city))].slice(0, 5);
                        const states = [...new Set(projects.map(p => p.state))].slice(0, 3);
                        const totalMW = projects.reduce((sum, p) => sum + (parseFloat(p.capacity_mw) || 0), 0);
                        const statuses = [...new Set(projects.map(p => p.status))].filter(s => s && s !== 'unknown');

                        tooltip.style('opacity', 1)
                            .html(`
                                <strong>${d.length} Upcoming Project${d.length > 1 ? 's' : ''}</strong><br/>
                                ${totalMW > 0 ? `<strong>Total Capacity:</strong> ${totalMW.toFixed(0)} MW<br/>` : ''}
                                <strong>Status:</strong> ${statuses.length > 0 ? statuses.join(', ') : 'TBD'}<br/>
                                <strong>Locations:</strong> ${cities.join(', ')}${cities.length >= 5 ? '...' : ''}, ${states.join(', ')}
                            `)
                            .style('left', (event.pageX + 10) + 'px')
                            .style('top', (event.pageY - 10) + 'px');
                    })
                    .on('mouseout', function() {
                        tooltip.style('opacity', 0);
                    });

                console.log(`Rendered ${bins.length} hexagons for upcoming projects`);

            } catch (error) {
                console.error('Error rendering upcoming hexbin heatmap:', error);
                document.getElementById(containerId).innerHTML = `
                    <p style="text-align: center; padding: 40px;">
                        Unable to load upcoming projects hexbin heatmap. Please ensure geocoded data is available.
                    </p>
                `;
            }
        }

        // Set today's date
        function updateDate() {
            const dateStr = new Date().toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            document.getElementById('todayDate').textContent = dateStr;
            document.querySelectorAll('.article-date').forEach(el => {
                el.textContent = new Date().toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
            });
        }
        updateDate();

        // Load daily AI-generated content from JSON
        async function generateDailyContent() {
            const contentArea = document.getElementById('contentArea');
            if (contentArea) {
                contentArea.classList.add('columns');
                contentArea.classList.remove('news-view');
            }
            try {
                // Load daily snippets from JSON file with cache busting
                const timestamp = new Date().getTime();
                const response = await fetch(`daily_articles.json?t=${timestamp}`);

                if (!response.ok) {
                    console.error('Could not load daily articles, using fallback');
                    loadFallbackContent();
                    return;
                }

                const data = await response.json();

                // Update main headline (rotate from pool)
                const headlines = [
                    "Data Center Construction Booms Across Nation",
                    "Northern Virginia Maintains DC Dominance",
                    "Hyperscale Investment Reaches Record Highs",
                    "AI Drives Unprecedented DC Capacity Demand",
                    "Power Constraints Shape New DC Strategies",
                    "Colocation Market Shows Strong Growth",
                    "Edge Computing Deployments Accelerate"
                ];
                const dayOfYear = Math.floor((new Date() - new Date(new Date().getFullYear(), 0, 0)) / 1000 / 60 / 60 / 24);
                document.getElementById('dailyHeadline').textContent = headlines[dayOfYear % headlines.length];

                // Update Market Heat Index (daily rotation)
                const heatLevels = [
                    "EXTREMELY HOT         ",
                    "VERY HOT         ",
                    "HEATING UP          ",
                    "MODERATE          ",
                    "COOLING           ",
                    "EXTREMELY HOT         ",
                    "RECORD ACTIVITY          "
                ];
                const topMarketsOptions = [
                    "Ashburn VA, Dallas TX, Phoenix AZ",
                    "Northern Virginia, Dallas, Silicon Valley",
                    "Phoenix AZ, Atlanta GA, Chicago IL",
                    "Dallas TX, Portland OR, Columbus OH",
                    "Ashburn VA, Phoenix AZ, Portland OR",
                    "Silicon Valley, Northern Virginia, Dallas",
                    "Atlanta GA, Dallas TX, Northern Virginia"
                ];
                const trendOptions = [
                    "Accelerating",
                    "Record Growth",
                    "Strong Momentum",
                    "Steady Expansion",
                    "Moderate Growth",
                    "Unprecedented Demand",
                    "Peak Activity"
                ];
                document.getElementById('marketHeat').textContent = heatLevels[dayOfYear % heatLevels.length];
                document.getElementById('topMarkets').textContent = topMarketsOptions[dayOfYear % topMarketsOptions.length];
                document.getElementById('marketTrend').textContent = trendOptions[dayOfYear % trendOptions.length];

                // Load AI-generated articles
                const articles = data.articles || [];

                // Pick first two unique-by-headline articles
                const seen = new Set();
                const uniqueArticles = [];
                for (const a of articles) {
                    const key = (a.headline || '').trim().toLowerCase();
                    if (!key || seen.has(key)) continue;
                    seen.add(key);
                    uniqueArticles.push(a);
                    if (uniqueArticles.length === 2) break;
                }

                if (uniqueArticles.length >= 2) {
                    document.getElementById('article1').innerHTML = `
                        <div class="article-headline">${uniqueArticles[0].headline || 'Daily Brief'}</div>
                        <div class="article-byline">DC Intel News Desk       <span class="article-date"></span></div>
                        <div class="article-content">${uniqueArticles[0].content || ''}</div>
                    `;

                    document.getElementById('article2').innerHTML = `
                        <div class="article-headline">${uniqueArticles[1].headline || 'Market Intelligence'}</div>
                        <div class="article-byline">Market Intelligence       <span class="article-date"></span></div>
                        <div class="article-content">${uniqueArticles[1].content || ''}</div>
                    `;

                    console.log(`Loaded AI-generated articles from ${data.generated_date}`);
                } else {
                    loadFallbackContent();
                }

                updateDate(); // Update article dates

                // Populate classifieds section
                populateClassifieds();

            } catch (error) {
                console.error('Error loading daily articles:', error);
                loadFallbackContent();
            }
        }

        // Populate Professional Services Directory
        function populateClassifieds() {
            const dayOfYear = Math.floor((new Date() - new Date(new Date().getFullYear(), 0, 0)) / 1000 / 60 / 60 / 24);

            // SERVICES (rotating 2 per day)
            const services = [
                {
                    type: "service",
                    title: "DC MATCHMAKING SERVICE: Find Your Perfect Facility",
                    desc: "We identify and qualify facilities matching your technical requirements. Leverage our 4,436+ facility database with certification data, capacity specs, and operator intel. Save weeks of research with curated shortlists. Available in Premium and Enterprise tiers.",
                    link: "service_dc_matchmaking.html"
                },
                {
                    type: "service",
                    title: "MARKET INTELLIGENCE: Real-Time Data",
                    desc: "Comprehensive tracking of 4,436+ facilities and upcoming DC projects nationwide. Daily updates on permits, construction activity, and operator movements. Historical data, trend analysis, and competitive intelligence. Available in all tiers: Basic (CSV exports), Premium (daily alerts), Enterprise (API access).",
                    link: "service_market_intelligence.html"
                },
                {
                    type: "service",
                    title: "SITE SELECTION: Expert Consulting",
                    desc: "Advisory service for optimal DC location selection. Premium tier: 1 quarterly market analysis report + consultation call. Enterprise tier: Unlimited custom research, real-time permit tracking via API, 2 monthly consultation calls. We analyze 2.5M+ permits across 34 markets to identify growth opportunities and competitive positioning.",
                    link: "service_site_selection.html"
                },
                {
                    type: "service",
                    title: "DUE DILIGENCE: Asset Assessment",
                    desc: "Enterprise-exclusive advisory service for DC asset evaluation. Comprehensive market positioning analysis, competitive landscape assessment, and strategic recommendations. Includes unlimited consultation calls and negotiation support. Success fee: 5-10% of first-year contract value for completed transactions.",
                    link: "service_due_diligence.html"
                }
            ];

            // MARKET INSIGHTS (rotating 1 per day)
            const marketInsights = [
                {
                    type: "insight",
                    title: "         PHOENIX MARKET UPDATE",
                    desc: "Arizona leads western expansion with 47 new DC permit filings in Q3 2025. Mesa and Chandler driving growth with hyperscale activity. Average project valuation: $85M. Tracking 156 active projects statewide.",
                    link: "#"
                },
                {
                    type: "insight",
                    title: "          NORTHERN VIRGINIA DOMINANCE",
                    desc: "Loudoun & Fairfax counties account for 23% of all U.S. DC construction. 89 active projects totaling 450MW capacity. Microsoft, AWS, Google remain top operators. Historical data shows 5-year CAGR of 18%.",
                    link: "#"
                },
                {
                    type: "insight",
                    title: "     DALLAS WHOLESALE SURGE",
                    desc: "DFW metro sees 34 projects under construction, up 42% YoY. Wholesale colocation expansion dominates with QTS, CyrusOne, EdgeCore leading permits. Richardson and Irving hotspots for new development.",
                    link: "#"
                },
                {
                    type: "insight",
                    title: "          MIDWEST EMERGENCE",
                    desc: "Chicago, Columbus, and Minneapolis show strongest Midwest growth. Combined 67 active projects tracked. Enterprise and edge deployments accelerating. Columbus leads with tax incentives driving 12 new hyperscale permits.",
                    link: "#"
                },
                {
                    type: "insight",
                    title: "          SOUTHEAST EXPANSION",
                    desc: "Atlanta maintains #4 U.S. market position with 42 tracked projects. Charlotte and Richmond emerging as secondary hubs. Georgia incentives attract $2.3B in announced DC investments. Fiber infrastructure upgrades underway.",
                    link: "#"
                },
                {
                    type: "insight",
                    title: "          TEXAS TRIANGLE DOMINANCE",
                    desc: "Dallas, San Antonio, Austin combine for 91 active projects. State leads nation in new MW capacity additions. Power grid improvements accelerate development. Tracking $4.1B in construction value across all 3 metros.",
                    link: "#"
                },
                {
                    type: "insight",
                    title: "        SILICON VALLEY CAPACITY CONSTRAINTS",
                    desc: "San Jose and Santa Clara facing land scarcity as demand outpaces supply. Existing facilities at 95%+ occupancy. Developers looking to Sacramento and Stockton for expansion. Colocation pricing up 22% YoY driven by tech sector demand.",
                    link: "#"
                },
                {
                    type: "insight",
                    title: "              CHICAGO ENTERPRISE HUB EXPANSION",
                    desc: "Chicago maintains top 5 U.S. market position with 38 active projects. Strong enterprise demand from financial services and healthcare sectors. Edge deployments accelerating in suburbs. Tracking 285MW of new capacity under construction.",
                    link: "#"
                },
                {
                    type: "insight",
                    title: "         COLUMBUS HYPERSCALE BOOM",
                    desc: "Columbus emerges as Midwest hyperscale leader with 12 major projects. Tax incentive programs attract Meta, Google, Amazon investments. Low power costs and fiber connectivity drive selection. Tracking $1.8B in announced investments.",
                    link: "#"
                },
                {
                    type: "insight",
                    title: "         PORTLAND SUSTAINABLE GROWTH",
                    desc: "Portland OR sees 18 active DC projects leveraging renewable energy advantages. Hydroelectric power attracts sustainability-focused operators. Intel and AWS expanding regional footprint. Market growing 31% YoY with focus on green certifications.",
                    link: "#"
                },
                {
                    type: "insight",
                    title: "         AUSTIN TECH-DRIVEN DEMAND",
                    desc: "Austin tech boom drives DC expansion with 24 tracked projects. Tesla, Oracle, and startups fuel enterprise colocation growth. Market shifting from wholesale to retail/hybrid models. Power infrastructure upgrades underway for 150MW+ new capacity.",
                    link: "#"
                },
                {
                    type: "insight",
                    title: "             DENVER MOUNTAIN WEST HUB",
                    desc: "Denver establishes Mountain West DC dominance with 16 active projects. Strategic location for disaster recovery and west coast redundancy. Zayo and Level 3 fiber connectivity advantages. Tracking $680M in permit valuations.",
                    link: "#"
                },
                {
                    type: "insight",
                    title: "          CHARLOTTE SOUTHEAST SECONDARY",
                    desc: "Charlotte emerges as Atlanta alternative with 14 new projects. Bank of America and financial services anchor demand. Lower costs than primary markets attract price-sensitive customers. Market growing 28% YoY.",
                    link: "#"
                },
                {
                    type: "insight",
                    title: "      SEATTLE CLOUD EPICENTER",
                    desc: "Seattle leverages Microsoft and Amazon HQ presence with 21 active projects. Hyperscale and cloud-adjacent deployments dominate. Quincy WA serves as overflow market for large-scale builds. Renewable energy commitments drive operator interest.",
                    link: "#"
                },
                {
                    type: "insight",
                    title: "          PHILADELPHIA EAST COAST VALUE",
                    desc: "Philadelphia offers east coast access at lower costs than Ashburn. 11 active projects target price-conscious enterprise customers. Strong fiber connectivity to NYC, DC, Atlanta. Emerging as overflow market for northern Virginia capacity constraints.",
                    link: "#"
                }
            ];

            // FEATURE UPDATES (rotating 1 per day)
            const featureUpdates = [
                {
                    type: "update",
                    title: "         NATIONWIDE COVERAGE: All 50 States",
                    desc: "DC Intel now tracks data center development across all 50 U.S. states. From Alaska to Florida, monitor permits, construction activity, and operator movements nationwide. Complete geographic coverage for comprehensive market intelligence.",
                    link: "#"
                },
                {
                    type: "update",
                    title: "           NEW: Real-Time Permit Alerts",
                    desc: "Get notified within 24 hours of new DC permit filings. Custom alerts by state, city, operator, or project size. Email and webhook delivery available. Never miss a competitive move or market opportunity again.",
                    link: "#"
                },
                {
                    type: "update",
                    title: "          EXPANDED DATA: Historical to 2020",
                    desc: "Access complete permit history back to 2020 for trend analysis. Track market evolution, operator patterns, and capacity growth over 5 years. Perfect for investment research, competitive intelligence, and market reports.",
                    link: "#"
                },
                {
                    type: "update",
                    title: "         API v2: Enterprise Integration",
                    desc: "New RESTful API with real-time data access, webhook subscriptions, and custom query filters. Integrate DC intelligence directly into your platforms, dashboards, and workflows. Documentation and sandbox available.",
                    link: "#"
                },
                {
                    type: "update",
                    title: "         MILESTONE: 1,000+ Projects Tracked",
                    desc: "Our database now tracks over 1,000 data center projects nationwide. Daily updates ensure the most current construction activity, permit status, and operator movements. The industry's most comprehensive DC intelligence platform.",
                    link: "#"
                },
                {
                    type: "update",
                    title: "               STATE COVERAGE: From Coast to Coast",
                    desc: "Comprehensive tracking across all major and emerging markets. Primary hubs (VA, TX, AZ, IL, GA) plus secondary markets (NC, OH, OR, WA) and emerging regions. 50-state visibility for complete market awareness.",
                    link: "#"
                }
            ];

            // Daily rotation logic: 2 services + 1 insight + 1 update
            const displayedContent = [];

            // Pick 2 services (rotate through 4)
            const serviceStart = (dayOfYear * 2) % services.length;
            displayedContent.push(services[serviceStart % services.length]);
            displayedContent.push(services[(serviceStart + 1) % services.length]);

            // Pick 1 market insight (rotate through 6)
            const insightIndex = dayOfYear % marketInsights.length;
            displayedContent.push(marketInsights[insightIndex]);

            // Pick 1 feature update (rotate through 6)
            const updateIndex = dayOfYear % featureUpdates.length;
            displayedContent.push(featureUpdates[updateIndex]);

            // Generate HTML for all 4 boxes
            const servicesHTML = displayedContent.map((item, index) => {
                let clickHandler = '';
                let subtitle = '';
                let boxStyle = '';

                if (item.type === 'service') {
                    // Service boxes - link to dedicated pages
                    clickHandler = `onclick="window.location.href='${item.link}'"`;
                    subtitle = '<div style="font-size: 10px; color: #0066cc; margin-top: 5px;">Click to learn more</div>';
                } else if (item.type === 'insight') {
                    // Market insight boxes - different styling (non-clickable for now)
                    clickHandler = '';
                    subtitle = '<div style="font-size: 10px; color: #d97706; margin-top: 5px; font-weight: bold;">          Market Intelligence</div>';
                    boxStyle = 'border-left: 4px solid #d97706; cursor: default;';
                } else if (item.type === 'update') {
                    // Feature update boxes - different styling (non-clickable for now)
                    clickHandler = '';
                    subtitle = '<div style="font-size: 10px; color: #059669; margin-top: 5px; font-weight: bold;">          Platform Update</div>';
                    boxStyle = 'border-left: 4px solid #059669; cursor: default;';
                }

                return `
                    <div class="classified-item" ${clickHandler} style="${boxStyle}">
                        <div class="classified-title">${item.title}</div>
                        <div>${item.desc}</div>
                        ${subtitle}
                    </div>
                `;
            }).join('');

            document.getElementById('classifiedsGrid').innerHTML = servicesHTML;
        }

        // Modal control functions
        function openModal() {
            document.getElementById('siteSelectionModal').classList.add('active');
        }

        function closeSiteSelectionModal() {
            document.getElementById('siteSelectionModal').classList.remove('active');
        }

        // Close modal when clicking outside
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal-overlay')) {
                closeSiteSelectionModal();
            }
        });

        // Fallback content if JSON fails to load
        function loadFallbackContent() {
            const contentArea = document.getElementById('contentArea');
            if (contentArea) {
                contentArea.classList.add('columns');
                contentArea.classList.remove('news-view');
            }
            const dayOfYear = Math.floor((new Date() - new Date(new Date().getFullYear(), 0, 0)) / 1000 / 60 / 60 / 24);

            const headlines = [
                "Data Center Construction Booms Across Nation",
                "Northern Virginia Maintains DC Dominance",
                "Hyperscale Investment Reaches Record Highs"
            ];
            document.getElementById('dailyHeadline').textContent = headlines[dayOfYear % headlines.length];

            document.getElementById('article1').innerHTML = `
                <div class="article-headline">Data Center Market Shows Continued Growth</div>
                <div class="article-byline">DC Intel News Desk       <span class="article-date"></span></div>
                <div class="article-content">Industry analysis indicates sustained expansion in data center construction across major U.S. markets. Cloud computing demand and AI workloads continue driving capacity requirements, with several metropolitan areas seeing record permit activity.</div>
            `;

            document.getElementById('article2').innerHTML = `
                <div class="article-headline">Market Intelligence Platform Updates</div>
                <div class="article-byline">Market Intelligence       <span class="article-date"></span></div>
                <div class="article-content">DC Intel provides real-time permit tracking and market intelligence across 1,000+ confirmed data center projects nationwide. Our platform offers comprehensive brokerage services, site selection consulting, and custom research capabilities.</div>
            `;

            updateDate();
            populateClassifieds();
        }
        generateDailyContent();

        // Section switching
        function switchSection(section) {
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.navigation a').forEach(n => n.classList.remove('active'));

            // Map section parameters to actual section IDs
            const sectionMap = {
                'home': 'homeSection',
                'classifieds': 'classifiedsSection',
                'knowledge': 'knowledgeSection',
                'pricing': 'pricingSection',
                'services': 'servicesSection',
                'existing-dcs': 'existingDCsSection',
                'upcoming-dcs': 'upcomingDCsSection'
            };

            const sectionId = sectionMap[section];
            if (!sectionId) {
                console.error(`Unknown section: ${section}`);
                return;
            }

            const sectionElement = document.getElementById(sectionId);
            if (!sectionElement) {
                console.error(`Section element not found: ${sectionId} (from parameter: ${section})`);
                return;
            }
            sectionElement.classList.add('active');

            // Update tier visibility when switching to knowledge section (Study Guides)
            if (section === 'knowledge' && typeof updateTierVisibility === 'function') {
                updateTierVisibility();
            }

            const navId = 'nav' + section.charAt(0).toUpperCase() + section.slice(1).replace(/-./g, x => x[1].toUpperCase());
            const navEl = document.getElementById(navId);
            if (navEl) navEl.classList.add('active');

            if (section === 'knowledge') loadKnowledge();
            if (section === 'services') loadServices();
            if (section === 'existing-dcs') loadExistingDCs();
            if (section === 'upcoming-dcs') loadUpcomingDCs();

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // ===================================================================
        // STUDY GUIDE FUNCTIONALITY
        // ===================================================================

        // Get user tier from localStorage
        function getUserTier() {
            const user = localStorage.getItem('dcIntelUser');
            if (!user) return null;

            try {
                const userData = JSON.parse(user);
                return userData.tier || null;
            } catch (e) {
                console.error('Error parsing user data:', e);
                return null;
            }
        }

        // Check if user has access to a topic
        function checkAccess(topicName) {
            const tier = getUserTier();

            if (!tier) {
                return { hasAccess: false, reason: 'login' };
            }

            // Define topic access levels
            const basicTopics = [
                'DC Handbook - Part A',
                'DC Handbook - Part B',
                'DC Handbook - Part C'
            ];

            const premiumTopics = [
                'Building Design & Construction',
                'Cooling Systems',
                'Power Infrastructure',
                'Network & Connectivity',
                'Markets & Drivers'
            ];

            const enterpriseTopics = [
                'Disaster Recovery & Business Continuity',
                'Emerging Technologies',
                'Fire Suppression & Life Safety',
                'Physical Security & Access Controls',
                'Reliability & Compliance Standards',
                'Sustainability & Energy Efficiency'
            ];

            // Check access
            if (basicTopics.includes(topicName)) {
                return { hasAccess: true };
            }

            if (premiumTopics.includes(topicName)) {
                if (tier === 'premium' || tier === 'enterprise') {
                    return { hasAccess: true };
                } else {
                    return { hasAccess: false, reason: 'upgrade', requiredTier: 'Premium' };
                }
            }

            if (enterpriseTopics.includes(topicName)) {
                if (tier === 'enterprise') {
                    return { hasAccess: true };
                } else {
                    return { hasAccess: false, reason: 'upgrade', requiredTier: 'Enterprise' };
                }
            }

            return { hasAccess: true }; // Default to allow
        }

        // Update tier visibility on page load
        function updateTierVisibility() {
            const tier = userTier || 'free';
            const pill = document.getElementById('tierPillLabel');
            if (pill) {
                pill.textContent = tier.toUpperCase();
            }

            // Hide all tier-restricted sections by default
            document.querySelectorAll('.tier-basic-only, .tier-premium-only, .tier-enterprise-only').forEach(el => {
                el.style.display = 'none';
            });

            // Show sections based on user tier
            if (tier === 'basic' || tier === 'premium' || tier === 'enterprise') {
                // Basic, Premium, and Enterprise users can see Basic content
                document.querySelectorAll('.tier-basic-only').forEach(el => {
                    el.style.display = 'block';
                });
            }

            if (tier === 'premium' || tier === 'enterprise') {
                // Premium and Enterprise users can see Premium content
                document.querySelectorAll('.tier-premium-only').forEach(el => {
                    el.style.display = 'block';
                });
            }

            if (tier === 'enterprise') {
                // Only Enterprise users can see Enterprise content
                document.querySelectorAll('.tier-enterprise-only').forEach(el => {
                    el.style.display = 'block';
                });
            }
        }

        // Open video in modal with enhanced controls
        function openVideo(videoPath, title) {
            const access = checkAccess(title);

            if (!access.hasAccess) {
                if (access.reason === 'login') {
                    alert('Please log in to access Study Guide content.\n\nClick the Login button in the top-right corner.');
                    return;
                } else if (access.reason === 'upgrade') {
                    alert(`This content requires a ${access.requiredTier} subscription.\n\nPlease upgrade your plan to access this content.`);
                    return;
                }
            }

            const modal = document.getElementById('studyGuideModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');

            modalTitle.textContent = title;

            // Enhanced video player with resize controls and keyboard shortcuts
            modalContent.innerHTML = `
                <div style="position: relative; background: #000;">
                    <video id="studyGuideVideo" controls autoplay
                           style="width: 100%; max-height: 70vh; display: block; background: #000;"
                           controlsList="nodownload">
                        <source src="${videoPath}" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                </div>

                <!-- Video Controls Info -->
                <div style="background: #f5f5f5; padding: 15px; margin-top: 15px; border: 1px solid #ddd; border-radius: 4px;">
                    <div style="font-size: 14px; font-weight: bold; margin-bottom: 10px; color: #333;">
                        Video Controls:
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 12px; color: #666;">
                        <div>           Space: Play/Pause</div>
                        <div>    Right Arrow: Skip forward 5s</div>
                        <div>    Left Arrow: Skip back 5s</div>
                        <div>         Up/Down Arrow: Volume</div>
                        <div>      F: Toggle fullscreen</div>
                        <div>         Click video: Play/Pause</div>
                    </div>
                    <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #ddd; font-size: 11px; color: #888; font-style: italic;">
                        Tip: Double-click video for fullscreen. Use browser's native controls for additional options.
                    </div>
                </div>
            `;

            // Add keyboard shortcuts for video control
            const video = document.getElementById('studyGuideVideo');

            // Focus the modal so keyboard events work
            modal.tabIndex = -1;
            modal.focus();

            // Keyboard controls
            const videoKeyHandler = function(e) {
                if (!video) return;

                switch(e.key) {
                    case ' ': // Space - play/pause
                        e.preventDefault();
                        if (video.paused) {
                            video.play();
                        } else {
                            video.pause();
                        }
                        break;
                    case 'ArrowRight': // Skip forward 5s
                        e.preventDefault();
                        video.currentTime = Math.min(video.currentTime + 5, video.duration);
                        break;
                    case 'ArrowLeft': // Skip back 5s
                        e.preventDefault();
                        video.currentTime = Math.max(video.currentTime - 5, 0);
                        break;
                    case 'ArrowUp': // Volume up
                        e.preventDefault();
                        video.volume = Math.min(video.volume + 0.1, 1);
                        break;
                    case 'ArrowDown': // Volume down
                        e.preventDefault();
                        video.volume = Math.max(video.volume - 0.1, 0);
                        break;
                    case 'f':
                    case 'F': // Fullscreen toggle
                        e.preventDefault();
                        if (document.fullscreenElement) {
                            document.exitFullscreen();
                        } else {
                            video.requestFullscreen();
                        }
                        break;
                }
            };

            // Attach keyboard handler
            document.addEventListener('keydown', videoKeyHandler);

            // Store handler reference to remove it later
            modal.videoKeyHandler = videoKeyHandler;

            modal.style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        // Open PDF in modal
        function openPDF(pdfPath, title) {
            const access = checkAccess(title);

            if (!access.hasAccess) {
                if (access.reason === 'login') {
                    alert('Please log in to access Study Guide content.\n\nClick the Login button in the top-right corner.');
                    return;
                } else if (access.reason === 'upgrade') {
                    alert(`This content requires a ${access.requiredTier} subscription.\n\nPlease upgrade your plan to access this content.`);
                    return;
                }
            }

            const modal = document.getElementById('studyGuideModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');

            modalTitle.textContent = title;

            modalContent.innerHTML = `
                <div style="text-align: center; margin-bottom: 20px;">
                    <a href="${pdfPath}" download style="display: inline-block; padding: 12px 30px; background: #000; color: #fff; text-decoration: none; font-family: Georgia, serif; font-size: 14px; font-weight: bold; border: 2px solid #000;">
                        Download PDF
                    </a>
                    <a href="${pdfPath}" target="_blank" style="display: inline-block; padding: 12px 30px; background: #fff; color: #000; text-decoration: none; font-family: Georgia, serif; font-size: 14px; font-weight: bold; border: 2px solid #000; margin-left: 10px;">
                        Open in New Tab
                    </a>
                </div>
                <iframe src="${pdfPath}" style="width: 100%; height: 700px; border: 2px solid #ccc;"></iframe>
                <p style="margin-top: 15px; font-size: 13px; color: #666; text-align: center; font-style: italic;">
                    If the PDF doesn't display, click "Open in New Tab" or "Download PDF" above.
                </p>
            `;

            modal.style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        // Open image in modal
        function openImage(imagePath, title) {
            const access = checkAccess(title);

            if (!access.hasAccess) {
                if (access.reason === 'login') {
                    alert('Please log in to access Study Guide content.\n\nClick the Login button in the top-right corner.');
                    return;
                } else if (access.reason === 'upgrade') {
                    alert(`This content requires a ${access.requiredTier} subscription.\n\nPlease upgrade your plan to access this content.`);
                    return;
                }
            }

            const modal = document.getElementById('studyGuideModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');

            modalTitle.textContent = title;

            modalContent.innerHTML = `
                <div style="text-align: center;">
                    <img src="${imagePath}" alt="${title}" style="max-width: 100%; height: auto; border: 2px solid #ccc;">
                </div>
                <div style="text-align: center; margin-top: 20px;">
                    <a href="${imagePath}" download style="display: inline-block; padding: 12px 30px; background: #000; color: #fff; text-decoration: none; font-family: Georgia, serif; font-size: 14px; font-weight: bold; border: 2px solid #000;">
                        Download Image
                    </a>
                    <a href="${imagePath}" target="_blank" style="display: inline-block; padding: 12px 30px; background: #fff; color: #000; text-decoration: none; font-family: Georgia, serif; font-size: 14px; font-weight: bold; border: 2px solid #000; margin-left: 10px;">
                        Open in New Tab
                    </a>
                </div>
            `;

            modal.style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        // Close modal
        function closeStudyGuideModal() {
            const modal = document.getElementById('studyGuideModal');
            const modalContent = document.getElementById('modalContent');

            // Stop any playing videos
            const videos = modalContent.querySelectorAll('video');
            videos.forEach(video => {
                video.pause();
                video.currentTime = 0;
            });

            // Remove keyboard handler if it exists
            if (modal.videoKeyHandler) {
                document.removeEventListener('keydown', modal.videoKeyHandler);
                modal.videoKeyHandler = null;
            }

            modal.style.display = 'none';
            document.body.style.overflow = 'auto'; // Restore scrolling
            modalContent.innerHTML = ''; // Clear content
        }

        // Close modal on background click
        document.addEventListener('click', function(e) {
            const modal = document.getElementById('studyGuideModal');
            if (e.target === modal) {
                closeStudyGuideModal();
            }
        });

        // Close modal on ESC key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const modal = document.getElementById('studyGuideModal');
                if (modal && modal.style.display === 'block') {
                    closeStudyGuideModal();
                }
            }
        });


        // Tab switching for Existing DCs section
        function showExistingTab(tab) {
            // Hide all tab contents
            document.getElementById('existingTabHeatmapContent').style.display = 'none';
            document.getElementById('existingTabTableContent').style.display = 'none';
            document.getElementById('existingTabContactContent').style.display = 'none';

            // Reset all tab styles
            ['existingTabHeatmap', 'existingTabTable', 'existingTabContact'].forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    el.style.color = '#666';
                    el.style.borderBottom = '3px solid transparent';
                }
            });

            // Show selected tab content and update style
            const contentId = 'existingTab' + tab.charAt(0).toUpperCase() + tab.slice(1) + 'Content';
            const tabId = 'existingTab' + tab.charAt(0).toUpperCase() + tab.slice(1);

            const contentEl = document.getElementById(contentId);
            const tabEl = document.getElementById(tabId);

            if (contentEl) contentEl.style.display = 'block';
            if (tabEl) {
                tabEl.style.color = '#000';
                tabEl.style.borderBottom = '3px solid #000';
            }
        }

        // Tab switching for Upcoming DCs section
        function showUpcomingTab(tab) {
            // Hide all tab contents
            document.getElementById('upcomingTabHeatmapContent').style.display = 'none';
            document.getElementById('upcomingTabTableContent').style.display = 'none';
            document.getElementById('upcomingTabContactContent').style.display = 'none';

            // Reset all tab styles
            ['upcomingTabHeatmap', 'upcomingTabTable', 'upcomingTabContact'].forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    el.style.color = '#666';
                    el.style.borderBottom = '3px solid transparent';
                }
            });

            // Show selected tab content and update style
            const contentId = 'upcomingTab' + tab.charAt(0).toUpperCase() + tab.slice(1) + 'Content';
            const tabId = 'upcomingTab' + tab.charAt(0).toUpperCase() + tab.slice(1);

            const contentEl = document.getElementById(contentId);
            const tabEl = document.getElementById(tabId);

            if (contentEl) contentEl.style.display = 'block';
            if (tabEl) {
                tabEl.style.color = '#000';
                tabEl.style.borderBottom = '3px solid #000';
            }
        }

        // Handle service request form submissions
        async function handleServiceRequest(event, serviceType) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const data = Object.fromEntries(formData);

            console.log('Service request submitted:', serviceType, data);

            // Prepare request data
            const requestData = {
                service: serviceType,
                name: data.name,
                email: data.email,
                company: data.company,
                phone: data.phone || null,
                requirements: data.requirements || null
            };

            try {
                // Call the API
                const response = await fetch(`${PUBLIC_API_BASE}/api/service_request`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });

                const result = await response.json();

                if (result.ok || response.ok) {
                    alert('Thank you! Your request for ' + serviceType + ' has been submitted.\n\nYou will receive a confirmation email at ' + data.email + ' shortly.\n\nOur team will contact you within 24 hours.');
                } else {
                    alert('Request submitted. We will contact you shortly at ' + data.email + '.');
                }

                // Reset form
                event.target.reset();
            } catch (error) {
                console.error('Service request error:', error);
                // Still show success to user even if API fails
                alert('Thank you! Your request for ' + serviceType + ' has been submitted.\n\nWe will contact you at ' + data.email + ' within 24 hours.');
                event.target.reset();
            }
        }

        // Knowledge base - load from local CSV file
        async function loadKnowledge() {
            try {
                // Load from local CSV file
                const response = await fetch('knowledge/dc_glossary.csv');
                const csvText = await response.text();

                let knowledge = [];

                // Parse CSV (skip header row)
                const lines = csvText.split('\n').slice(1);
                for (const line of lines) {
                    if (!line.trim()) continue;

                    // Simple CSV parsing (handles quoted fields)
                    const match = line.match(/^"?([^",]+)"?,?"?([^"]+)"?/);
                    if (match) {
                        knowledge.push({
                            term: match[1].trim(),
                            def: match[2].replace(/^"|"$/g, '').trim()
                        });
                    }
                }

                // Fallback if file loading fails
                if (knowledge.length === 0) {
                    knowledge = [
                        { term: "Colocation", def: "A data center facility where multiple companies rent space for their servers and equipment. Typically offers shared infrastructure including power, cooling, and connectivity." },
                        { term: "Hyperscale", def: "Massive data centers (typically 100MW+) operated by tech giants like Google, Amazon, Microsoft. Characterized by thousands of servers and enormous power requirements." },
                        { term: "Edge Computing", def: "Distributed computing infrastructure placed closer to end-users for lower latency. Typically smaller facilities in metro areas or near content consumers." },
                        { term: "Power Usage Effectiveness (PUE)", def: "Ratio measuring data center energy efficiency. Calculated as total facility energy divided by IT equipment energy. Lower is better, with 1.0 being ideal." },
                        { term: "Tier Rating", def: "Classification system (I-IV) indicating data center reliability and redundancy levels. Tier IV represents highest availability with fully redundant systems." }
                    ];
                }

                document.getElementById('knowledgeGrid').innerHTML = knowledge.map(k => `
                    <div class="knowledge-card">
                        <h4>${k.term}</h4>
                        <p>${k.def}</p>
                    </div>
                `).join('');

                // Search functionality
                document.getElementById('knowledgeSearch').addEventListener('input', function() {
                    const search = this.value.toLowerCase();
                    document.querySelectorAll('.knowledge-card').forEach(card => {
                        const text = card.textContent.toLowerCase();
                        card.style.display = text.includes(search) ? 'block' : 'none';
                    });
                });

            } catch (error) {
                console.error('Error loading knowledge:', error);
                // Use fallback hardcoded data on error
                document.getElementById('knowledgeGrid').innerHTML = `
                    <div class="knowledge-card">
                        <h4>Colocation</h4>
                        <p>A data center facility where multiple companies rent space for their servers and equipment.</p>
                    </div>
                    <div class="knowledge-card">
                        <h4>Hyperscale</h4>
                        <p>Massive data centers (typically 100MW+) operated by tech giants like Google, Amazon, Microsoft.</p>
                    </div>
                `;
            }
        }

        // Switch knowledge tab
        function switchKnowledgeTab(tab) {
            // Update tab buttons
            document.querySelectorAll('.knowledge-tab').forEach(btn => btn.classList.remove('active-tab'));
            document.getElementById('tab' + tab.charAt(0).toUpperCase() + tab.slice(1)).classList.add('active-tab');

            // Show/hide views
            document.getElementById('glossaryView').style.display = tab === 'glossary' ? 'block' : 'none';
            document.getElementById('handbookView').style.display = tab === 'handbook' ? 'block' : 'none';
            document.getElementById('taxonomyView').style.display = tab === 'taxonomy' ? 'block' : 'none';
            document.getElementById('studyguidesView').style.display = tab === 'studyguides' ? 'block' : 'none';

            // Load content if needed
            if (tab === 'handbook' && !window.handbookLoaded) {
                loadHandbook();
            } else if (tab === 'taxonomy' && !window.taxonomyLoaded) {
                loadTaxonomy();
            }
        }

        // Load handbook from local markdown file
        async function loadHandbook() {
            try {
                const response = await fetch('knowledge/dc_handbook.md');
                const markdown = await response.text();

                // Convert markdown to HTML-like display
                let content = markdown
                    .replace(/^# (.+)$/gm, '<h2 style="text-align: center; font-size: 24px; margin: 20px 0; text-transform: uppercase; letter-spacing: 2px; border-bottom: 3px double #000; padding-bottom: 10px;">$1</h2>')
                    .replace(/^## (.+)$/gm, '<h3 style="font-size: 18px; margin: 18px 0 10px 0; font-weight: bold; border-bottom: 2px solid #000; padding-bottom: 5px;">$1</h3>')
                    .replace(/^### (.+)$/gm, '<h4 style="font-size: 16px; margin: 15px 0 8px 0; font-weight: bold;">$1</h4>')
                    .replace(/^\*\*(.+?)\*\*/gm, '<strong>$1</strong>')
                    .replace(/^- (.+)$/gm, '<li style="margin: 5px 0;">$1</li>')
                    .replace(/\n\n/g, '<p style="margin: 12px 0;"></p>')
                    .replace(/\n/g, '<br>');

                document.getElementById('handbookContent').innerHTML = content;
                window.handbookLoaded = true;
            } catch (error) {
                console.error('Error loading handbook:', error);
                document.getElementById('handbookContent').innerHTML = '<p style="text-align: center; color: #c00;">Failed to load handbook content.</p>';
            }
        }

        // Load taxonomy from local CSV-exported JSON
        async function loadTaxonomy() {
            try {
                const response = await fetch('taxonomy.json');
                if (!response.ok) throw new Error('taxonomy.json not found');
                const data = await response.json();
                if (data.sheets && Array.isArray(data.sheets) && data.data) {
                    const taxonomyHTML = data.sheets.map((sheetName, idx) => {
                        const sheetData = data.data[sheetName] || [];
                        const rows = sheetData.slice(0, 10).map(row => {
                            const keys = Object.keys(row || {});
                            const term = keys.length > 0 ? (row[keys[0]] || '') : '';
                            const definition = keys.length > 1 ? (row[keys[1]] || '') : '';
                            const extras = keys.slice(2).map(k => `${k}: ${row[k] || ''}`).filter(Boolean).join('<br>');
                            return `
                                <div class="taxonomy-row">
                                    <div class="taxonomy-term">${term}</div>
                                    <div class="taxonomy-def">${definition}</div>
                                    ${extras ? `<div class="taxonomy-extra">${extras}</div>` : ''}
                                </div>
                            `;
                        }).join('') || '<p class="taxonomy-def" style="text-align:center;">No entries found.</p>';

                        return `
                            <div class="taxonomy-card" style="transform: rotate(${idx % 2 === 0 ? '-' : ''}0.5deg);">
                                <h3>${sheetName.replace(/_/g, ' ')}</h3>
                                ${rows}
                            </div>
                        `;
                    }).join('');

                    document.getElementById('taxonomyContent').innerHTML = taxonomyHTML;
                    taxonomyLoaded = true;
                }
            } catch (error) {
                console.error('Error loading taxonomy:', error);
                document.getElementById('taxonomyContent').innerHTML = '<p style="text-align: center; color: #c00; grid-column: 1 / -1;">Failed to load taxonomy content.</p>';
            }
        }

        // Services - All 17 services
        function loadServices() {
            const services = [
                { id: "brokerage", name: "Data Center Brokerage", desc: "Expert representation for buying, selling, or leasing data center facilities and capacity. Our team leverages extensive market knowledge and relationships to secure optimal terms for clients. We handle facility acquisitions, wholesale capacity transactions, and strategic advisory." },
                { id: "intelligence", name: "Market Intelligence Platform", desc: "Real-time access to our comprehensive database of permits and over 1,000 confirmed data center projects across the United States. Includes permit tracking, valuation data, trend analysis, operator monitoring, and competitive intelligence. Don't see your city? Request coverage - we can add new markets to serve your needs." },
                { id: "siteselection", name: "Site Selection Consulting", desc: "Comprehensive analysis of potential DC locations considering power availability, fiber connectivity, tax incentives, risk factors, and market dynamics. We identify optimal sites aligned with your technical and financial requirements." },
                { id: "duediligence", name: "Due Diligence Services", desc: "Technical and financial assessment of DC assets including infrastructure review, lease analysis, operational benchmarking, and risk evaluation. Supports informed decision-making for acquisitions and investments." },
                { id: "reports", name: "Custom Market Reports", desc: "Tailored research deliverables covering specific markets, operators, or project types. Available in weekly, monthly, or ad-hoc formats. Includes executive summaries, detailed analytics, and actionable recommendations." },
                { id: "advisory", name: "Strategic Advisory", desc: "High-level guidance on DC strategy, capacity planning, market entry, portfolio optimization, and investment decisions. Our advisors bring decades of combined industry experience." },
                { name: "DC Matchmaking Service", desc: "Connect buyers and sellers in the data center market. We match your specific requirements with available facilities, capacity, or development opportunities. Comprehensive screening, qualification, and negotiation support.", link: "showDCMatchmaking" },
                { name: "Lead Referral Program", desc: "Earn commissions by referring qualified data center opportunities. We handle the full transaction process while you earn industry-leading referral fees. Perfect for consultants, brokers, and industry professionals.", link: "showLeadReferral" },
                { name: "Premium Data Access", desc: "Advanced access to our full database with custom filtering, export capabilities, and API integration. Includes detailed project timelines, contractor information, and historical trend analysis.", link: "showPremiumData" },
                { name: "API Integration", desc: "Integrate DC Intel data directly into your systems via our RESTful API. Real-time permit updates, search capabilities, and webhook notifications. Multiple tier options available.", link: "showAPIAccess" },
                { name: "RFQ Management", desc: "Streamlined request for quotation process for data center capacity. Submit requirements once and receive competitive proposals from multiple providers. We manage the entire RFQ lifecycle.", link: "showRFQManagement" },
                { name: "Email Alerts & Notifications", desc: "Receive instant notifications when new projects match your criteria. Configure custom alerts for specific markets, operators, project sizes, or other parameters.", link: "showEmailAlerts" },
                { name: "Request Coverage Expansion", desc: "Don't see your city or region? Request us to add coverage for new markets. We prioritize expansion based on customer demand and can add new jurisdictions within 30-60 days.", link: "showRequestCoverage" },
                { name: "Construction Timeline Predictions", desc: "AI-powered forecasting of project timelines based on historical permit data, contractor schedules, and market conditions. Predict when facilities will come online." },
                { name: "DC Comparison Tool", desc: "Side-by-side comparison of multiple data center projects including specifications, locations, costs, and timelines. Export detailed comparison reports." },
                { name: "Demand Heatmap Analytics", desc: "Visual analysis of data center demand and supply by geography. Identify underserved markets, saturation zones, and emerging opportunities." },
                { name: "Sponsored Listings", desc: "Promote your data center project, available capacity, or services to our audience of industry professionals, investors, and enterprise buyers." }
            ];

            document.getElementById('servicesList').innerHTML = services.map(s => `
                <div class="service-item">
                    <h3>
                        ${s.id ? `<a href="#" onclick="showServiceModal('${s.id}'); return false;" style="color: #000; text-decoration: none;">${s.name}</a>` : s.name}
                        ${s.link && !s.id ? ' <a href="#" onclick="' + s.link + '(); return false;" style="font-size: 12px; color: #000; text-decoration: underline;">[Request Service]</a>' : ''}
                    </h3>
                    <p>${s.desc}</p>
                </div>
            `).join('');
        }

        // Show service-specific modal
        function showServiceModal(serviceId) {
            document.getElementById('serviceModal_' + serviceId).style.display = 'flex';
        }

        // Close service modal
        function closeServiceModal(serviceId) {
            document.getElementById('serviceModal_' + serviceId).style.display = 'none';
        }

        // Handle service inquiry form submission
        function handleServiceInquiry(event, serviceType) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const data = Object.fromEntries(formData);

            console.log('Service inquiry submitted:', serviceType, data);
            alert('Thank you for your interest in ' + serviceType + '! We will contact you shortly at ' + data.email + '.');

            // Close modal and reset form
            const modalId = event.target.closest('.modal-overlay').id.replace('serviceModal_', '');
            closeServiceModal(modalId);
            event.target.reset();
        }

        // Existing DCs with heatmap visualization
        async function loadExistingDCs() {
            try {
                // Load from API
                const response = await fetch(`${PUBLIC_API_BASE}/existing-dcs`, {
                    headers: authHeaders()
                });
                const data = await response.json();
                const allDCs = data.items || [];

                if (!allDCs || allDCs.length === 0) {
                    document.getElementById('existingDCsTableView').innerHTML = '<p style="text-align: center;">Unable to load data centers.</p>';
                    return;
                }

                // Store data globally for export
                window.existingDCsData = allDCs;

                // Show export buttons for BASIC tier and above
                const exportBtns = document.getElementById('existingExportBtns');
                if (exportBtns && userTier && ['basic', 'premium', 'enterprise'].includes(userTier)) {
                    exportBtns.style.display = 'flex';
                }

                // Apply quick link category filter if active
                let filteredDCs = allDCs;
                if (window.activeQuickLinkCategory) {
                    filteredDCs = allDCs.filter(dc => matchesQuickLinkCategory(dc, window.activeQuickLinkCategory));
                }

                const tableData = { items: filteredDCs, total: filteredDCs.length };

                // Generate hexbin heatmap visualization
                await renderHexbinHeatmap('heatmapViz');

                // Email gate and tier upgrade banners
                let bannerHTML = '';

                // Email gate banner (if user hasn't provided email and isn't on paid tier)
                if (!hasEmailGateAccess()) {
                    bannerHTML += `
                        <div style="margin-bottom: 15px; padding: 15px; background: #f5f1e8; border: 3px solid #10b981; border-radius: 5px; color: #000;">
                            <h4 style="margin: 0 0 10px 0; font-size: 16px; color: #059669;">          Certification Data Locked</h4>
                            <p style="margin: 0 0 10px 0; font-size: 13px;">Unlock <strong>SOC2, HIPAA, PCI-DSS, and ISO27001</strong> certification columns for all 4,436+ facilities.</p>
                            <button onclick="showEmailCaptureModal()" style="padding: 8px 20px; background: #000; color: #fff; border: 3px solid #10b981; border-radius: 3px; font-weight: bold; cursor: pointer;">
                                Unlock for FREE (Email Required)
                            </button>
                        </div>
                    `;
                }

                // Tier upgrade banner (for free users, even if they have email)
                if (userTier === 'free') {
                    bannerHTML += `
                        <div style="margin-bottom: 15px; padding: 15px; background: #f5f1e8; border: 3px solid #9333ea; border-radius: 5px; color: #000;">
                            <h4 style="margin: 0 0 10px 0; font-size: 16px; color: #7e22ce;">          Get More Data with Paid Tiers</h4>
                            <p style="margin: 0 0 10px 0; font-size: 13px;">Unlock additional columns and features:</p>
                            <ul style="margin: 0 0 10px 0; padding-left: 20px; font-size: 12px;">
                                <li><strong>Basic ($299/mo):</strong> + Sqft, Lat & Long</li>
                                <li><strong>Premium ($999/mo):</strong> + Contact, Specs</li>
                                <li><strong>Enterprise ($2,499/mo):</strong> + API Access</li>
                            </ul>
                            <button onclick="switchSection('pricing')" style="padding: 8px 20px; background: #000; color: #fff; border: 3px solid #9333ea; border-radius: 3px; font-weight: bold; cursor: pointer;">
                                View Pricing Plans
                            </button>
                        </div>
                    `;
                }

                // Apply sort if set
                if (existingSort.key) {
                    const key = existingSort.key;
                    const dir = existingSort.dir;
                    tableData.items.sort((a, b) => {
                        const getVal = (item) => {
                            if (key === 'provider') return (item.provider || '').toLowerCase();
                            if (key === 'title') return (item.name || '').toLowerCase();
                            if (key === 'address') return (item.address_line_raw || '').toLowerCase();
                            return '';
                        };
                        const va = getVal(a);
                        const vb = getVal(b);
                        if (va < vb) return -1 * dir;
                        if (va > vb) return 1 * dir;
                        return 0;
                    });
                }

                // Generate table with tiered columns
                let filterStatus = '';
                if (window.activeQuickLinkCategory) {
                    filterStatus = `
                        <div style="text-align: center; margin-bottom: 10px; padding: 10px; background: #e0f2fe; border: 2px solid #0284c7; border-radius: 5px;">
                            <strong>Filtered by:</strong> ${getCategoryDescription(window.activeQuickLinkCategory)}
                            <button onclick="window.activeQuickLinkCategory = null; loadExistingDCs();" style="margin-left: 10px; padding: 5px 15px; background: #dc2626; color: #fff; border: none; border-radius: 3px; cursor: pointer; font-size: 11px;">
                                Clear Filter
                            </button>
                        </div>
                    `;
                }
                let html = filterStatus + `<h3 style="text-align: center; margin-bottom: 15px;">Operational Data Centers</h3>`;
                html += '<div style="text-align: center; font-size: 16px; font-weight: bold; color: #d97706; background: #fef3c7; padding: 12px; border: 2px solid #f59e0b; border-radius: 5px; margin-bottom: 15px;">Columns by tier: Free (Provider/Title/Address/Certifications)    Basic (+Sqft/Lat & Long)    Premium (+Contact/Specs)    Enterprise (+API Access)</div>';
                html += '<div class="table-wrapper">';
                html += '<table class="table-sticky table-zebra" style="width: 100%; border-collapse: collapse; font-size: 12px;">';

                // Table header with tiered columns
                html += '<tr style="background: #000; color: #fff;">';
                // FREE tier columns
                html += '<th style="padding: 8px; text-align: left; cursor: pointer;" onclick="setExistingSort(\'provider\')">Provider</th>';
                html += '<th style="padding: 8px; text-align: left; cursor: pointer;" onclick="setExistingSort(\'title\')">Title</th>';
                html += '<th style="padding: 8px; text-align: left; cursor: pointer;" onclick="setExistingSort(\'address\')">Address</th>';

                // EMAIL GATE columns (certifications)
                if (hasEmailGateAccess()) {
                    html += '<th style="padding: 8px; text-align: center; background: #10b981;">SOC2</th>';
                    html += '<th style="padding: 8px; text-align: center; background: #10b981;">HIPAA</th>';
                    html += '<th style="padding: 8px; text-align: center; background: #10b981;">PCI-DSS</th>';
                    html += '<th style="padding: 8px; text-align: center; background: #10b981;">ISO27001</th>';
                }

                // BASIC tier columns
                if (hasTierAccess('basic')) {
                    html += '<th style="padding: 8px; text-align: right; background: #4a5568;">Sq Ft</th>';
                    html += '<th style="padding: 8px; text-align: center; background: #4a5568;">Latitude</th>';
                    html += '<th style="padding: 8px; text-align: center; background: #4a5568;">Longitude</th>';
                }

                // PREMIUM tier columns
                if (hasTierAccess('premium')) {
                    html += '<th style="padding: 8px; text-align: left; background: #6b46c1;">Contact</th>';
                    html += '<th style="padding: 8px; text-align: left; background: #6b46c1;">Specs</th>';
                }

                // ENTERPRISE tier columns
                if (hasTierAccess('enterprise')) {
                    html += '<th style="padding: 8px; text-align: left; background: #d97706;">Full Address</th>';
                }

                html += '</tr>';

                // Table rows
                tableData.items.forEach((item, idx) => {
                    const bg = idx % 2 === 0 ? '#fff' : '#f9f9f9';
                    const provider = item.provider || 'Unknown';
                    const title = item.name || 'N/A';
                    const address = item.address_line_raw || 'N/A';

                    html += `<tr style="background: ${bg}; border-bottom: 1px solid #ccc;">`;

                    // FREE tier columns
                    html += `<td style="padding: 8px;">${provider}</td>`;
                    html += `<td style="padding: 8px;">${title}</td>`;
                    html += `<td style="padding: 8px;">${address}</td>`;

                    // EMAIL GATE columns (certifications)
                    if (hasEmailGateAccess()) {
                        const certs = (item.certifications || '').toUpperCase();
                        const soc2 = certs.includes('SOC 2') ? '' : 'X';
                        const hipaa = certs.includes('HIPAA') ? '' : 'X';
                        const pci = certs.includes('PCI') ? '' : 'X';
                        const iso = certs.includes('ISO 27001') ? '' : 'X';

                        const soc2Color = certs.includes('SOC 2') ? '#10b981' : '#dc2626';
                        const hipaaColor = certs.includes('HIPAA') ? '#10b981' : '#dc2626';
                        const pciColor = certs.includes('PCI') ? '#10b981' : '#dc2626';
                        const isoColor = certs.includes('ISO 27001') ? '#10b981' : '#dc2626';

                        html += `<td style="padding: 8px; text-align: center; background: #f0fdf4; color: ${soc2Color}; font-weight: bold;">${soc2}</td>`;
                        html += `<td style="padding: 8px; text-align: center; background: #f0fdf4; color: ${hipaaColor}; font-weight: bold;">${hipaa}</td>`;
                        html += `<td style="padding: 8px; text-align: center; background: #f0fdf4; color: ${pciColor}; font-weight: bold;">${pci}</td>`;
                        html += `<td style="padding: 8px; text-align: center; background: #f0fdf4; color: ${isoColor}; font-weight: bold;">${iso}</td>`;
                    }

                    // BASIC tier columns
                    if (hasTierAccess('basic')) {
                        const sqft = item.total_sqft ? `${parseInt(item.total_sqft).toLocaleString()} sf` : 'N/A';
                        const lat = item.latitude ? parseFloat(item.latitude).toFixed(4) : 'N/A';
                        const lon = item.longitude ? parseFloat(item.longitude).toFixed(4) : 'N/A';

                        html += `<td style="padding: 8px; text-align: right; background: #f7fafc; color: #4a5568; font-size: 11px;">${sqft}</td>`;
                        html += `<td style="padding: 8px; text-align: center; background: #f7fafc; color: #4a5568; font-size: 11px;">${lat}</td>`;
                        html += `<td style="padding: 8px; text-align: center; background: #f7fafc; color: #4a5568; font-size: 11px;">${lon}</td>`;
                    }

                    // PREMIUM tier columns
                    if (hasTierAccess('premium')) {
                        const contact = item.contact || item.contact_email || item.contact_phone || 'N/A';
                        const specs = item.power_capacity_mw ? `${item.power_capacity_mw} MW` : 'N/A';

                        html += `<td style="padding: 8px; background: #faf5ff; color: #6b46c1; font-size: 11px;">${contact}</td>`;
                        html += `<td style="padding: 8px; background: #faf5ff; color: #6b46c1; font-size: 11px;">${specs}</td>`;
                    }

                    // ENTERPRISE tier columns
                    if (hasTierAccess('enterprise')) {
                        const fullAddress = item.street_full_guess || item.address_line_raw || 'N/A';
                        html += `<td style="padding: 8px; background: #fffbeb; color: #d97706; font-size: 11px;">${fullAddress}</td>`;
                    }

                    html += '</tr>';
                });

                html += '</table></div>';

                // Summary bar
                const summaryHTML = `
                    <div style="margin-top: 10px; padding: 10px; background: #f0f0f0; border: 2px solid #000; font-size: 12px;">
                        <strong>Total Facilities: ${data.total}</strong>
                        <span style="float: right; font-size: 11px;">
                            Tier: <strong style="text-transform: uppercase; color: #667eea;">${userTier}</strong>
                            ${hasEmailAccess ? ' | Email: <strong style="color: #10b981;">-  Unlocked</strong>' : ''}
                        </span>
                    </div>
                `;

                // Populate the table view tab
                document.getElementById('existingDCsTableView').innerHTML = bannerHTML + html + summaryHTML;

            } catch (error) {
                console.error('Error loading DCs:', error);
                const errorMsg = '<p style="text-align: center;">Error loading data. Please check API connection.</p>';
                document.getElementById('existingDCsTableView').innerHTML = errorMsg;
            }
        }

        // Load Upcoming DCs
        // Simple CSV parser function
        function parseCSV(text) {
            const lines = text.split('\n').filter(line => line.trim());
            const headers = lines[0].split(',').map(h => h.trim().replace(/^"|"$/g, ''));
            const rows = [];

            for (let i = 1; i < lines.length; i++) {
                const values = [];
                let current = '';
                let inQuotes = false;

                for (let j = 0; j < lines[i].length; j++) {
                    const char = lines[i][j];
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        values.push(current.trim().replace(/^"|"$/g, ''));
                        current = '';
                    } else {
                        current += char;
                    }
                }
                values.push(current.trim().replace(/^"|"$/g, ''));

                if (values.length === headers.length) {
                    const row = {};
                    headers.forEach((header, idx) => {
                        row[header] = values[idx];
                    });
                    rows.push(row);
                }
            }
            return rows;
        }

        // CSV Export Functions
        function getExportColumns(tier, dataType) {
            const EXISTING_DCS_COLUMNS = {
                "free": ["provider", "title", "name", "address_line_raw", "latitude", "longitude"],
                "basic": ["total_sqft"],
                "premium": ["contact", "contact_email", "contact_phone", "power_capacity_mw"],
                "enterprise": ["street_full_guess", "city", "state", "zip", "country"]
            };

            const UPCOMING_DCS_COLUMNS = {
                "free": ["city", "state", "address_raw", "latest_status", "first_seen_applied_date", "source", "latitude", "longitude"],
                "basic": [],
                "premium": ["latest_description"],
                "enterprise": ["latest_valuation_usd", "record_ids_sample", "statuses_sample", "latest_contractor", "latest_owner", "latest_permit_type", "permits_count"]
            };

            const TIER_HIERARCHY = ["free", "basic", "premium", "enterprise"];
            const columnMap = dataType === 'existing' ? EXISTING_DCS_COLUMNS : UPCOMING_DCS_COLUMNS;
            const tierIndex = TIER_HIERARCHY.indexOf(tier);
            let allowedColumns = [];

            for (let i = 0; i <= tierIndex; i++) {
                const tierName = TIER_HIERARCHY[i];
                if (columnMap[tierName]) {
                    allowedColumns = allowedColumns.concat(columnMap[tierName]);
                }
            }

            return allowedColumns;
        }

        function convertToCSV(data, columns) {
            if (!data || data.length === 0) return '';

            // CSV header
            const header = columns.join(',');

            // CSV rows
            const rows = data.map(item => {
                return columns.map(col => {
                    let value = item[col] || '';
                    // Escape quotes and wrap in quotes if contains comma, quote, or newline
                    if (typeof value === 'string') {
                        value = value.replace(/"/g, '""');
                        if (value.includes(',') || value.includes('"') || value.includes('\n')) {
                            value = `"${value}"`;
                        }
                    }
                    return value;
                }).join(',');
            });

            return header + '\n' + rows.join('\n');
        }

        function downloadCSV(csvContent, filename) {
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function exportExistingDCsToCSV() {
            if (!window.existingDCsData || window.existingDCsData.length === 0) {
                alert('No data available to export. Please load the data first.');
                return;
            }

            const tier = userTier || 'free';
            const columns = getExportColumns(tier, 'existing');
            const csvContent = convertToCSV(window.existingDCsData, columns);
            const timestamp = new Date().toISOString().split('T')[0];
            const filename = `existing-dcs-${tier}-${timestamp}.csv`;

            downloadCSV(csvContent, filename);
        }

        function exportUpcomingDCsToCSV() {
            if (!window.upcomingDCsData || window.upcomingDCsData.length === 0) {
                alert('No data available to export. Please load the data first.');
                return;
            }

            const tier = userTier || 'free';
            const columns = getExportColumns(tier, 'upcoming');
            const csvContent = convertToCSV(window.upcomingDCsData, columns);
            const timestamp = new Date().toISOString().split('T')[0];
            const filename = `upcoming-dcs-${tier}-${timestamp}.csv`;

            downloadCSV(csvContent, filename);
        }

        // Excel Export Functions
        function exportExistingDCsToExcel() {
            if (!window.existingDCsData || window.existingDCsData.length === 0) {
                alert('No data available to export. Please load the data first.');
                return;
            }

            const tier = userTier || 'free';
            const columns = getExportColumns(tier, 'existing');

            // Filter data to only include allowed columns
            const filteredData = window.existingDCsData.map(item => {
                const filtered = {};
                columns.forEach(col => {
                    filtered[col] = item[col] || '';
                });
                return filtered;
            });

            // Create workbook and worksheet
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.json_to_sheet(filteredData);

            // Auto-size columns
            const colWidths = columns.map(col => ({
                wch: Math.max(col.length, 15)
            }));
            ws['!cols'] = colWidths;

            XLSX.utils.book_append_sheet(wb, ws, 'Existing DCs');

            // Generate filename
            const timestamp = new Date().toISOString().split('T')[0];
            const filename = `existing-dcs-${tier}-${timestamp}.xlsx`;

            // Download file
            XLSX.writeFile(wb, filename);
        }

        function exportUpcomingDCsToExcel() {
            if (!window.upcomingDCsData || window.upcomingDCsData.length === 0) {
                alert('No data available to export. Please load the data first.');
                return;
            }

            const tier = userTier || 'free';
            const columns = getExportColumns(tier, 'upcoming');

            // Filter data to only include allowed columns
            const filteredData = window.upcomingDCsData.map(item => {
                const filtered = {};
                columns.forEach(col => {
                    filtered[col] = item[col] || '';
                });
                return filtered;
            });

            // Create workbook and worksheet
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.json_to_sheet(filteredData);

            // Auto-size columns
            const colWidths = columns.map(col => ({
                wch: Math.max(col.length, 15)
            }));
            ws['!cols'] = colWidths;

            XLSX.utils.book_append_sheet(wb, ws, 'Upcoming DCs');

            // Generate filename
            const timestamp = new Date().toISOString().split('T')[0];
            const filename = `upcoming-dcs-${tier}-${timestamp}.xlsx`;

            // Download file
            XLSX.writeFile(wb, filename);
        }

        async function loadUpcomingDCs() {
            try {
                // Load from API
                const response = await fetch(`${PUBLIC_API_BASE}/upcoming-dcs?limit=5000`, {
                    headers: authHeaders()
                });

                if (!response.ok) {
                    document.getElementById('upcomingDCsTable').innerHTML = '<p style="text-align: center;">Unable to load upcoming DC projects.</p>';
                    return;
                }

                const apiData = await response.json();
                let projects = apiData.items || [];

                // Filter out TBD,TBD entries (news articles without verified locations)
                projects = projects.filter(p => {
                    const city = (p.city || '').toUpperCase().trim();
                    const state = (p.state || '').toUpperCase().trim();
                    // Remove if both city AND state are TBD
                    return !(city === 'TBD' && state === 'TBD');
                });

                // Apply quick link category filter if active
                if (window.activeQuickLinkCategory) {
                    projects = projects.filter(p => matchesQuickLinkCategory(p, window.activeQuickLinkCategory));
                }

                // Apply source filter
                if (upcomingSourceFilter === 'news') {
                    projects = projects.filter(p => p.source === 'news');
                } else if (upcomingSourceFilter === 'permit') {
                    projects = projects.filter(p => p.source === 'permit');
                }
                // If 'all', don't filter

                // Store data globally for export (before filtering)
                window.upcomingDCsData = apiData.items || [];

                // Show export buttons for BASIC tier and above
                const exportBtns = document.getElementById('upcomingExportBtns');
                if (exportBtns && userTier && ['basic', 'premium', 'enterprise'].includes(userTier)) {
                    exportBtns.style.display = 'flex';
                }

                if (!projects || projects.length === 0) {
                    document.getElementById('upcomingDCsTable').innerHTML = '<p style="text-align: center;">No upcoming DC projects found.</p>';
                    return;
                }

                console.log(`Loaded ${projects.length} upcoming DC projects (TBD,TBD entries filtered)`);

                // Generate hexbin heatmap visualization for upcoming projects
                await renderUpcomingHexbinHeatmap('upcomingHeatmap');

                // Sort projects: permits first, then news with location, then news without location
                projects.sort((a, b) => {
                    const aIsNews = a.source === 'news';
                    const bIsNews = b.source === 'news';

                    // Check if news has valid city and state (not TBD)
                    const aHasLocation = aIsNews &&
                        (a.city || '').toUpperCase().trim() !== 'TBD' &&
                        (a.state || '').toUpperCase().trim() !== 'TBD' &&
                        (a.city || '').trim() !== '' &&
                        (a.state || '').trim() !== '';
                    const bHasLocation = bIsNews &&
                        (b.city || '').toUpperCase().trim() !== 'TBD' &&
                        (b.state || '').toUpperCase().trim() !== 'TBD' &&
                        (b.city || '').trim() !== '' &&
                        (b.state || '').trim() !== '';

                    // Sorting priority: Permits -> News with location -> News without location
                    if (!aIsNews && bIsNews) return -1;  // Permits before all news
                    if (aIsNews && !bIsNews) return 1;

                    // Both are news: prioritize those with location
                    if (aIsNews && bIsNews) {
                        if (aHasLocation && !bHasLocation) return -1;
                        if (!aHasLocation && bHasLocation) return 1;
                    }

                    // Within same category, sort by date (newest first)
                    return (b.first_seen_applied_date || '').localeCompare(a.first_seen_applied_date || '');
                });

                // Apply user sort (after priority sort)
                if (upcomingSort.key) {
                    const key = upcomingSort.key;
                    const dir = upcomingSort.dir;
                    projects.sort((a, b) => {
                        const getVal = (item) => {
                            if (key === 'location') return `${item.city || ''} ${item.state || ''}`.toLowerCase();
                            if (key === 'status') return (item.latest_status || '').toLowerCase();
                            if (key === 'firstSeen') return (item.first_seen_applied_date || '');
                            if (key === 'source') return (item.source || '').toLowerCase();
                            return '';
                        };
                        const va = getVal(a);
                        const vb = getVal(b);
                        if (va < vb) return -1 * dir;
                        if (va > vb) return 1 * dir;
                        return 0;
                    });
                }

                // Generate filter status banner
                let filterStatus = '';
                if (window.activeQuickLinkCategory) {
                    filterStatus = `
                        <div style="text-align: center; margin-bottom: 10px; padding: 10px; background: #e0f2fe; border: 2px solid #0284c7; border-radius: 5px;">
                            <strong>Filtered by:</strong> ${getCategoryDescription(window.activeQuickLinkCategory)}
                            <button onclick="window.activeQuickLinkCategory = null; loadUpcomingDCs();" style="margin-left: 10px; padding: 5px 15px; background: #dc2626; color: #fff; border: none; border-radius: 3px; cursor: pointer; font-size: 11px;">
                                Clear Filter
                            </button>
                        </div>
                    `;
                }

                // Table Legend (displayed first)
                const tableLegend = '<div style="text-align: center; font-size: 16px; font-weight: bold; color: #d97706; background: #fef3c7; padding: 12px; border: 2px solid #f59e0b; border-radius: 5px; margin-bottom: 15px;">Columns by tier: Free (Location/Address/Status/First Seen/Source)    Basic (+Lat/Long)    Premium (+Most Recent Description)    Enterprise (+Total Permit Quantity per permit address/All previous Details)</div>';

                // Generate project table with tiered access columns
                                let tableHTML = filterStatus;

                // Add source filter controls
                tableHTML += '<div style="text-align: center; margin-bottom: 15px; padding: 15px; background: #f9f9f9; border: 2px solid #000;">';
                tableHTML += '<p style="font-size: 14px; margin-bottom: 10px; font-weight: bold;">Filter by Data Source:</p>';
                tableHTML += '<p style="font-size: 12px; margin-bottom: 12px; color: #555;">';
                tableHTML += '<strong>News:</strong> Projects discovered from news articles and industry announcements. ';
                tableHTML += '<strong>Permits:</strong> Data center related permits tracking new facilities, construction and upgrades to existing facilities, data center hall expansions, infrastructure builds, and all project stages from initial permits through completion.';
                tableHTML += '</p>';
                tableHTML += '<div style="display: flex; gap: 10px; justify-content: center;">';
                tableHTML += '<button onclick="filterUpcomingBySource(\'all\')" id="filterAll" style="padding: 8px 16px; cursor: pointer; background: #000; color: #fff; border: 2px solid #000; font-weight: bold;">All Sources</button>';
                tableHTML += '<button onclick="filterUpcomingBySource(\'news\')" id="filterNews" style="padding: 8px 16px; cursor: pointer; background: #fff; color: #000; border: 2px solid #000; font-weight: bold;">News Only</button>';
                tableHTML += '<button onclick="filterUpcomingBySource(\'permit\')" id="filterPermit" style="padding: 8px 16px; cursor: pointer; background: #fff; color: #000; border: 2px solid #000; font-weight: bold;">Permits Only</button>';
                tableHTML += '</div>';
                tableHTML += '</div>';
                tableHTML += '<div class="table-wrapper">';
                tableHTML += '<table class="table-sticky table-zebra" style="width: 100%; border-collapse: collapse; font-size: 12px;">';
                tableHTML += '<tr style="background: #000; color: #fff;">';
                // FREE tier columns
                tableHTML += '<th style="padding: 8px; text-align: left; cursor: pointer;" onclick="setUpcomingSort(\'location\')">Location</th>';
                tableHTML += '<th style="padding: 8px; text-align: left; cursor: pointer;" onclick="setUpcomingSort(\'address\')">Address</th>';
                tableHTML += '<th style="padding: 8px; text-align: left; cursor: pointer;" onclick="setUpcomingSort(\'status\')">Status</th>';
                tableHTML += '<th style="padding: 8px; text-align: left; cursor: pointer;" onclick="setUpcomingSort(\'firstSeen\')">First Seen</th>';
                tableHTML += '<th style="padding: 8px; text-align: left; cursor: pointer;" onclick="setUpcomingSort(\'source\')">Source</th>';
                // BASIC tier columns (+lat/long) - note we don't have lat/long in CSV yet, placeholder for now
                if (hasTierAccess('basic')) {
                    tableHTML += '<th style="padding: 8px; text-align: left; background: #4a5568;">Lat/Long</th>';
                }
                // PREMIUM tier columns (+description)
                if (hasTierAccess('premium')) {
                    tableHTML += '<th style="padding: 8px; text-align: left; background: #6b46c1;">Description</th>';
                }
                // ENTERPRISE tier columns (+valuation)
                if (hasTierAccess('enterprise')) {
                    tableHTML += '<th style="padding: 8px; text-align: right; background: #d97706;">Valuation</th>';
                    tableHTML += '<th style="padding: 8px; text-align: center; background: #d97706;">Details</th>';
                }
                tableHTML += '</tr>';
                projects.forEach((project, idx) => {
                    const isNews = project.source === 'news';

                    // Color coding: Yellow for news, Green for permits
                    const bgBase = isNews ? '#fff3cd' : '#d1e7dd';
                    const borderColor = isNews ? '#ffc107' : '#198754';
                    const icon = isNews ? '    ' : '        ';

                    const city = project.city || 'TBD';
                    const state = project.state || 'TBD';
                    const location = `${icon} ${city}, ${state}`;

                    // Address column: show link for news, address for permits
                    let addressDisplay;
                    if (isNews && project.source_url) {
                        // For news: show clickable link
                        addressDisplay = `<a href="${project.source_url}" target="_blank" style="color: #0066cc; text-decoration: underline;">View Article       </a>`;
                    } else if (project.address_raw && project.address_raw !== 'TBD') {
                        // For permits: show actual address
                        addressDisplay = project.address_raw;
                    } else {
                        addressDisplay = '-';
                    }

                    const status = project.latest_status || 'Unknown';
                    const firstSeen = project.first_seen_applied_date || '-';
                    const sourceLabel = isNews ? 'News' : 'Permit';
                    const description = project.latest_description || '-';
                    const valuation = project.latest_valuation_usd ? `$${parseFloat(project.latest_valuation_usd).toLocaleString()}` : '-';
                    const statusLower = status.toLowerCase();
                    let statusClass = 'draft';
                    if (statusLower.includes('active')) statusClass = 'active';
                    else if (statusLower.includes('permit')) statusClass = 'permit';
                    else if (statusLower.includes('review')) statusClass = 'review';

                    // Start row
                    tableHTML += `<tr style="background: ${bgBase}; border-left: 4px solid ${borderColor}; border-bottom: 1px solid #ccc;" data-project-idx="${idx}">
                        <td style="padding: 8px;">${location}</td>
                        <td style="padding: 8px;">${addressDisplay}</td>
                        <td style="padding: 8px;"><span class="chip ${statusClass}">${status}</span></td>
                        <td style="padding: 8px;">${firstSeen}</td>
                        <td style="padding: 8px;">
                            <span style="background: ${isNews ? '#ffc107' : '#198754'}; color: ${isNews ? '#000' : '#fff'}; padding: 2px 8px; border-radius: 3px; font-size: 11px; font-weight: bold;">
                                ${sourceLabel}
                            </span>
                        </td>`;

                    // BASIC tier column (lat/long)
                    if (hasTierAccess('basic')) {
                        const lat = project.latitude || '';
                        const lon = project.longitude || '';
                        const coords = (lat && lon) ? `${parseFloat(lat).toFixed(4)}, ${parseFloat(lon).toFixed(4)}` : '-';
                        tableHTML += `<td style="padding: 8px; background: #f7fafc; color: #4a5568; font-size: 11px;">${coords}</td>`;
                    }

                    // PREMIUM tier column (description)
                    if (hasTierAccess('premium')) {
                        tableHTML += `<td style="padding: 8px; background: #faf5ff; color: #6b46c1; font-size: 11px;">${description}</td>`;
                    }

                    // ENTERPRISE tier columns (valuation + details button)
                    if (hasTierAccess('enterprise')) {
                        tableHTML += `<td style="padding: 8px; text-align: right; background: #fffbeb; color: #d97706; font-weight: bold; font-size: 11px;">${valuation}</td>`;
                        tableHTML += `<td style="padding: 8px; text-align: center; background: #fffbeb;">
                            <button onclick="toggleProjectDetails(${idx})" style="padding: 2px 8px; background: #d97706; color: #fff; border: none; border-radius: 3px; cursor: pointer; font-size: 10px;">
                                Expand
                            </button>
                        </td>`;
                    }

                    tableHTML += `</tr>`;

                    // ENTERPRISE: Expandable row for permit details
                    if (hasTierAccess('enterprise')) {
                        const recordIds = (project.record_ids_sample || '').split(';').filter(id => id.trim());
                        const statuses = (project.statuses_sample || '').split(';').filter(s => s.trim());

                        tableHTML += `<tr id="details-${idx}" style="display: none; background: #fffbeb; border-left: 4px solid #d97706;">
                            <td colspan="${hasTierAccess('enterprise') ? 8 : hasTierAccess('premium') ? 7 : hasTierAccess('basic') ? 6 : 5}" style="padding: 15px;">
                                <div style="font-size: 12px;">
                                    <h4 style="margin: 0 0 10px 0; color: #d97706;">Full Project Details</h4>
                                    <p><strong>Description:</strong> ${description}</p>
                                    <p><strong>Valuation:</strong> ${valuation}</p>
                                    <p><strong>Contractor:</strong> ${project.latest_contractor || 'N/A'}</p>
                                    <p><strong>Owner:</strong> ${project.latest_owner || 'N/A'}</p>
                                    <p><strong>Permit Type:</strong> ${project.latest_permit_type || 'N/A'}</p>
                                    <p><strong>Total Permits:</strong> ${project.permits_count || 0}</p>
                                    ${recordIds.length > 0 ? `
                                    <div style="margin-top: 10px;">
                                        <strong>Sample Permit IDs:</strong>
                                        <ul style="margin: 5px 0; padding-left: 20px;">
                                            ${recordIds.slice(0, 5).map((id, i) => `<li>${id}${statuses[i] ? ` - ${statuses[i]}` : ''}</li>`).join('')}
                                        </ul>
                                    </div>
                                    ` : ''}
                                </div>
                            </td>
                        </tr>`;
                    }
                });

                tableHTML += '</table></div>';

                // Add summary
                const newsCount = projects.filter(p => p.source === 'news').length;
                const permitCount = projects.filter(p => p.source === 'permit').length;

                // Tier upgrade banner
                let upgradeBanner = '';
                if (userTier === 'free') {
                    upgradeBanner = `
                        <div style="margin-bottom: 15px; padding: 15px; background: #f5f1e8; border: 3px solid #9333ea; border-radius: 5px; color: #000;">
                            <h4 style="margin: 0 0 10px 0; font-size: 16px; color: #7e22ce;">          Unlock More Data with Paid Tiers</h4>
                            <p style="margin: 0 0 10px 0; font-size: 13px;">You're seeing basic columns. Upgrade to access:</p>
                            <ul style="margin: 0; padding-left: 20px; font-size: 12px;">
                                <li><strong>Basic ($299/mo):</strong> + Lat/Long</li>
                                <li><strong>Premium ($999/mo):</strong> + Most Recent Description</li>
                                <li><strong>Enterprise ($2,499/mo):</strong> + Total Permit Quantity per permit address, All previous Details</li>
                            </ul>
                            <button onclick="switchSection('pricing')" style="margin-top: 10px; padding: 8px 20px; background: #000; color: #fff; border: 3px solid #9333ea; border-radius: 3px; font-weight: bold; cursor: pointer;">
                                View Pricing Plans
                            </button>
                        </div>
                    `;
                }

                const summaryHTML = `
                    <div style="margin-top: 10px; padding: 10px; background: #f0f0f0; border: 2px solid #000; font-size: 12px;">
                        <strong>Total Projects: ${projects.length}</strong>
                        (<span style="color: #ffc107; font-weight: bold;">     ${newsCount} News Discoveries</span> +
                        <span style="color: #198754; font-weight: bold;">         ${permitCount} Permitted</span>)
                        <span style="float: right; font-size: 11px;">Current Tier: <strong style="text-transform: uppercase; color: #667eea;">${userTier}</strong></span>
                    </div>
                `;

                document.getElementById('upcomingDCsTable').innerHTML = tableLegend + upgradeBanner + summaryHTML + tableHTML;

            } catch (error) {
                console.error('Error loading upcoming DCs:', error);
                document.getElementById('upcomingDCsTable').innerHTML = '<p style="text-align: center;">Error loading data. Please check CSV file location.</p>';
            }
        }

        // Toggle expandable project details (Enterprise tier feature)
        function toggleProjectDetails(idx) {
            const detailsRow = document.getElementById(`details-${idx}`);
            if (detailsRow) {
                const isVisible = detailsRow.style.display !== 'none';
                detailsRow.style.display = isVisible ? 'none' : '';
                // Update button text
                const btn = document.querySelector(`tr[data-project-idx="${idx}"] button`);
                if (btn) {
                    btn.textContent = isVisible ? 'Expand' : 'Collapse';
                }
            }
        }

        // Search functions
        function showLoading() {
            document.getElementById('loadingOverlay').classList.add('active');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('active');
        }

        async function doSearch(query) {
            if (!query) query = document.getElementById('searchInput').value.trim();
            if (!query) {
                alert('Please enter a search query');
                return;
            }

            // Make sure we're on home section
            switchSection('home');

            document.getElementById('searchInput').value = query;
            showLoading();

            try {
                const response = await fetch(`${PUBLIC_API_BASE}/ask`, {
                    method: 'POST',
                    headers: {
                        ...authHeaders(),
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ q: query })
                });

                const data = await response.json();
                hideLoading();

                if (!data.ok) {
                    alert('Search failed. Please try again.');
                    return;
                }

                displayResults(data, query);

            } catch (error) {
                hideLoading();
                alert('Search Error: ' + error.message + '\n\nPlease try again or contact support.');
                console.error('Search error:', error);
            }
        }

        function displayResults(data, query) {
            const contentArea = document.getElementById('contentArea');
            let html = `<div class="headline-main">Search Results: "${query}"</div>`;

            // Service inquiry response
            if (data.intent === 'SERVICE_INQUIRY' && data.response) {
                html += `
                    <div class="article">
                        <div class="article-headline">DC Intel Services</div>
                        <div class="article-byline">Intelligence Desk</div>
                        <div class="article-content">${data.response}</div>
                    </div>
                `;
            }

            // Rollup/facility results
            if (data.rollups && data.rollups.total > 0) {
                const items = data.rollups.items.slice(0, 12);
                items.forEach((item, idx) => {
                    // Handle both field naming conventions
                    const address = item.address_raw || item.Address || 'Unknown Location';
                    const city = item.city || item.City || 'N/A';
                    const state = item.state || item.State || 'N/A';
                    const description = item.latest_description || item.Description || 'No description available';
                    const valuation = item.latest_valuation_usd || item.TotalValuation || 0;
                    const permitCount = item.permits_count || item.PermitCount || 0;
                    const latestDate = item.last_seen_applied_date || item.LatestDate || 'N/A';

                    html += `
                        <div class="article">
                            <div class="article-headline">${idx + 1}. ${address}</div>
                            <div class="article-byline">${city}, ${state}       Valuation: $${valuation.toLocaleString()}</div>
                            <div class="article-content">
                                ${description.substring(0, 200)}...
                                <br><strong>Permits:</strong> ${permitCount} |
                                <strong>Latest:</strong> ${latestDate}
                            </div>
                        </div>
                    `;
                });
            }

            // News results
            if (data.news && data.news.total > 0) {
                const newsItems = data.news.items.slice(0, 6);
                newsItems.forEach((item) => {
                    html += `
                        <div class="article">
                            <div class="article-headline">${item.Title || item.Headline || 'News Article'}</div>
                            <div class="article-byline">Published: ${item.PublishedDate || item.Date || 'Unknown'}</div>
                            <div class="article-content">
                                ${item.Summary || item.Snippet || 'No summary available.'}
                            </div>
                        </div>
                    `;
                });
            }

            // No results
            if ((!data.rollups || data.rollups.total === 0) &&
                (!data.news || data.news.total === 0) &&
                data.intent !== 'SERVICE_INQUIRY') {
                html += `
                    <div class="article">
                        <div class="article-headline">No Results Found</div>
                        <div class="article-content">
                            No matching facilities or news articles found for your query.
                            Try refining your search terms or use one of the quick query links above.
                        </div>
                    </div>
                `;
            }

            contentArea.innerHTML = html;
            contentArea.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Load latest news articles from CSV
        
        async function loadLatestNews() {
            switchSection('home');
            showLoading();

            try {
                // Load from API
                const response = await fetch(`${PUBLIC_API_BASE}/news-latest?limit=20`, {
                    headers: authHeaders()
                });

                if (!response.ok) {
                    hideLoading();
                    alert('Unable to load news articles.');
                    return;
                }

                const apiData = await response.json();
                const articles = apiData.items || [];

                if (articles.length === 0) {
                    hideLoading();
                    alert('No news articles available.');
                    return;
                }

                hideLoading();

                articles.sort((a, b) => {
                    const dateA = a.published_utc || a.published || '';
                    const dateB = b.published_utc || b.published || '';
                    if (dateB > dateA) return 1;
                    if (dateB < dateA) return -1;
                    return 0;
                });

                const seen = new Set();
                const deduped = [];
                for (const item of articles) {
                    const key = `${(item.title || '').toLowerCase()}|${(item.url || '').toLowerCase()}`;
                    if (seen.has(key)) continue;
                    seen.add(key);
                    deduped.push(item);
                }

                const contentArea = document.getElementById('contentArea');
                contentArea.classList.remove('columns');
                contentArea.classList.add('news-view');

                let html = `<div class=\"headline-main\">Latest Data Center News (${deduped.length} articles)</div>`;
                html += `<p style=\"margin: 10px 0 14px; font-size: 13px; text-align: center; line-height: 1.5;\">This page displays the 20 most recent data center news articles. For the full historical archive, upgrade to the <a href=\"#\" onclick=\"switchSection('pricing'); return false;\" style=\"font-weight: bold; text-decoration: underline;\">Enterprise tier</a> to unlock News Archive (complete history, searchable) plus export-ready feeds.</p>`;
                html += `<div class=\"news-grid\">`;

                deduped.forEach((item, idx) => {
                    const title = item.title || 'Untitled Article';
                    const summary = item.summary || '';
                    const url = item.url || '#';
                    const published = item.published_utc || item.published || '';
                    const source = item.source || '';

                    const dateMatch = published.match(/(\\d{4}-\\d{2}-\\d{2})/);
                    const displayDate = dateMatch ? dateMatch[1] : '';

                    const byline = [source, displayDate].filter(Boolean).join(' | ');

                    html += `
                        <div class=\"news-card\">
                            <h4>${idx + 1}. ${title}</h4>
                            ${byline ? `<div class=\"news-meta\">${byline}</div>` : ''}
                            <div class=\"article-content\">
                                ${summary.substring(0, 240)}${summary.length > 240 ? '...' : ''}
                            </div>
                            ${url !== '#' ? `<a class=\"news-btn\" href=\"${url}\" target=\"_blank\" rel=\"noopener\">Read full article</a>` : ''}
                        </div>
                    `;
                });

                html += `</div>`;
                contentArea.innerHTML = html;
                contentArea.scrollIntoView({ behavior: 'smooth', block: 'start' });

            } catch (error) {
                hideLoading();
                alert('Error loading news: ' + error.message);
                console.error('News load error:', error);
            }
        }
// Load news archive

        async function loadNewsArchive() {
            if (!hasTierAccess('enterprise')) {
                alert('News Archive is an Enterprise-only feature.\n\nUpgrade to Enterprise tier ($2,499/month) to access the complete historical archive of DC-related news articles.\n\nContact: support@dc-intel.com');
                return;
            }

            switchSection('home');
            showLoading();

            try {
                // Load from API (Enterprise only)
                const response = await fetch(`${PUBLIC_API_BASE}/news-archive`, {
                    headers: authHeaders()
                });

                if (!response.ok) {
                    hideLoading();
                    alert('Unable to load news archive.');
                    return;
                }

                const apiData = await response.json();
                const articles = apiData.items || [];

                if (articles.length === 0) {
                    hideLoading();
                    alert('No archive articles available.');
                    return;
                }

                hideLoading();

                articles.sort((a, b) => {
                    const dateA = a.published_utc || a.published || '';
                    const dateB = b.published_utc || b.published || '';
                    if (dateB > dateA) return 1;
                    if (dateB < dateA) return -1;
                    return 0;
                });

                const contentArea = document.getElementById('contentArea');
                contentArea.classList.remove('columns');
                contentArea.classList.add('news-view');

                let html = `<div class=\"headline-main\">DC News Archive - Enterprise Edition (${articles.length} articles)</div>`;
                html += `<p style=\"text-align: center; margin-bottom: 14px; font-size: 13px; line-height: 1.5;\">Complete historical archive of data center industry news. Manage or upgrade via the <a href=\"#\" onclick=\"switchSection('pricing'); return false;\" style=\"font-weight: bold; text-decoration: underline;\">Enterprise tier</a>.</p>`;
                html += `<div class=\"news-grid\">`;

                articles.slice(0, 50).forEach((item, idx) => {
                    const title = item.title || 'Untitled Article';
                    const summary = item.summary || '';
                    const url = item.url || '#';
                    const published = item.published_utc || item.published || item.published_date || '';
                    const source = item.source || '';

                    const dateMatch = published.match(/(\\d{4}-\\d{2}-\\d{2})/);
                    const displayDate = dateMatch ? dateMatch[1] : '';

                    const byline = [source, displayDate].filter(Boolean).join(' | ');

                    html += `
                        <div class=\"news-card\">
                            <h4>${idx + 1}. ${title}</h4>
                            ${byline ? `<div class=\"news-meta\">${byline}</div>` : ''}
                            <div class=\"article-content\">
                                ${summary.substring(0, 240)}${summary.length > 240 ? '...' : ''}
                            </div>
                            ${url !== '#' ? `<a class=\"news-btn\" href=\"${url}\" target=\"_blank\" rel=\"noopener\">Read full article</a>` : ''}
                        </div>
                    `;
                });

                html += `</div>`;
                if (articles.length > 50) {
                    html += `<p style=\"text-align: center; margin-top: 20px; font-size: 13px; color: #666;\">Showing first 50 of ${articles.length} articles</p>`;
                }

                contentArea.innerHTML = html;
                contentArea.scrollIntoView({ behavior: 'smooth', block: 'start' });

            } catch (error) {
                hideLoading();
                alert('Error loading news archive: ' + error.message);
                console.error('News archive load error:', error);
            }
        }
// Search event listeners

        document.getElementById('searchBtn').addEventListener('click', () => doSearch());
        document.getElementById('searchInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') doSearch();
        });

        // Table filters - Existing DCs
        function clearExistingFilter() {
            const input = document.getElementById('existingSearch');
            if (input) input.value = '';
            loadExistingDCs();
        }

        // Table filters - Upcoming DCs
        function clearUpcomingFilter() {
            const input = document.getElementById('upcomingSearch');
            if (input) input.value = '';
            loadUpcomingDCs();
        }

        // Service request functions
        function showServiceModal(serviceName) {
            document.getElementById('serviceModalTitle').textContent = serviceName;
            document.getElementById('serviceModal').classList.add('active');
            document.getElementById('serviceForm').reset();
        }

        function showPremiumData() {
            showServiceModal('Premium Data Access Request');
        }

        function showDCMatchmaking() {
            showServiceModal('DC Matchmaking Service Request');
        }

        function showLeadReferral() {
            showServiceModal('Lead Referral Program Enrollment');
        }

        function showAPIAccess() {
            showServiceModal('API Integration Request');
        }

        function showRFQManagement() {
            showServiceModal('RFQ Management Request');
        }

        function showEmailAlerts() {
            showServiceModal('Email Alerts Configuration');
        }

        function showRequestCoverage() {
            showServiceModal('Request Coverage Expansion');
        }

        async function handleServiceRequest(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            const serviceName = document.getElementById('serviceModalTitle').textContent;

            const requestData = {
                service: serviceName,
                name: formData.get('name'),
                email: formData.get('email'),
                company: formData.get('company'),
                phone: formData.get('phone'),
                details: formData.get('details')
            };

            try {
                const response = await fetch(`${PUBLIC_API_BASE}/api/service_request`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });

                const data = await response.json();

                if (data.ok || response.ok) {
                    alert('Thank you! Your service request has been submitted. We will contact you within 24 hours.');
                    closeModal('serviceModal');
                } else {
                    alert('Request submitted locally. Our team will review and respond soon.');
                    closeModal('serviceModal');
                }
            } catch (error) {
                console.error('Service request error:', error);
                alert('Request submitted. We will contact you at the email address provided.');
                closeModal('serviceModal');
            }
        }

        // Quick Link Category Filter
        function showQuickLinkCategory(category) {
            // Store the active category filter globally
            window.activeQuickLinkCategory = category;

            // Switch to Existing DCs section (note: section IDs end with "Section")
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(s => s.classList.remove('active'));
            document.getElementById('existingDCsSection').classList.add('active');

            // Load the filtered data
            loadExistingDCs();
        }

        function getCategoryDescription(category) {
            const descriptions = {
                'hyperscale': 'Large cloud/tech giant facilities (AWS, Google, Microsoft, etc.)',
                'colocation': 'Multi-tenant facilities offering space/power/cooling rental',
                'edge': 'Small distributed facilities near end-users for low latency',
                '100mw': 'Mega-facilities with 100+ megawatts of power capacity'
            };
            return descriptions[category] || category;
        }

        function matchesQuickLinkCategory(item, category) {
            if (!window.activeQuickLinkCategory || window.activeQuickLinkCategory !== category) {
                return true; // No filter active or different category
            }

            const searchText = (
                (item.provider || '') + ' ' +
                (item.name || '') + ' ' +
                (item.services || '') + ' ' +
                (item.about || '') + ' ' +
                (item.latest_description || '') + ' ' +
                (item.power_published || '')
            ).toLowerCase();

            // Get actual data field values
            const powerMW = parseFloat(item.power_capacity_mw || item.capacity_mw || 0);
            const sqft = parseFloat(item.total_sqft || item.square_feet || 0);
            const provider = (item.provider || '').toLowerCase();
            const coloOptions = (item.colocation_options || '').toLowerCase();

            switch(category) {
                case 'hyperscale':
                    // Known hyperscale providers
                    const hyperscaleProviders = ['amazon', 'aws', 'google', 'gcp', 'microsoft', 'azure',
                                                'meta', 'facebook', 'oracle', 'alibaba', 'tencent',
                                                'apple', 'ibm'];
                    const isHyperscaleProvider = hyperscaleProviders.some(p => provider.includes(p));

                    // OR large power capacity (typically 20MW+) AND single-tenant indicators
                    const isLargeFacility = powerMW >= 20;
                    const notColo = !coloOptions.includes('cabinet') && !coloOptions.includes('cage');

                    // OR explicit hyperscale mention
                    const hasHyperscaleMention = searchText.includes('hyperscale');

                    return isHyperscaleProvider || (isLargeFacility && notColo) || hasHyperscaleMention;

                case 'colocation':
                    // Has colocation options field populated (cabinets, cages, etc)
                    const hasColoOptions = coloOptions.length > 10; // More than just empty string

                    // Known colo providers
                    const coloProviders = ['equinix', 'digital realty', 'cyrusone', 'qts', 'coresite',
                                          'switch', 'flexential', 'vantage', 'aligned', 'databank'];
                    const isColoProvider = coloProviders.some(p => provider.includes(p));

                    // OR colocation keywords in text
                    const hasColoKeywords = searchText.includes('colocation') || searchText.includes('colo ') ||
                                           searchText.includes('multi-tenant') || searchText.includes('retail') ||
                                           searchText.includes('cabinet') || searchText.includes('cage');

                    return hasColoOptions || isColoProvider || hasColoKeywords;

                case 'edge':
                    // Edge = small facilities (under 5MW or under 50k sqft)
                    const isSmallPower = powerMW > 0 && powerMW < 5;
                    const isSmallSize = sqft > 0 && sqft < 50000;

                    // OR edge keywords
                    const hasEdgeKeywords = searchText.includes('edge') || searchText.includes('micro') ||
                                           searchText.includes('distributed') || searchText.includes('metro');

                    return isSmallPower || isSmallSize || hasEdgeKeywords;

                case '100mw':
                    // Direct power capacity check (most reliable)
                    if (powerMW >= 100) return true;

                    // Fallback to text matching for "100 MW" mentions
                    const powerMatch = searchText.match(/(\d+)\s*mw/i);
                    if (powerMatch && parseFloat(powerMatch[1]) >= 100) return true;

                    // OR mega/campus keywords
                    return searchText.includes('100 mw') || searchText.includes('mega campus');

                default:
                    return true;
            }
        }

        // Check API status on load
        fetch(`${PUBLIC_API_BASE}/rollups/addresses?limit=1`, {
            headers: { 'X-API-Key': API_KEY }
        })
        .then(res => {
            if (res.ok) {
                document.getElementById('apiStatus').textContent = 'ONLINE';
                document.getElementById('apiStatus').style.color = 'green';
            }
        })
        .catch(() => {
            document.getElementById('apiStatus').textContent = 'OFFLINE';
            document.getElementById('apiStatus').style.color = 'red';
        });
    </script>

    <!-- SERVICE MODALS -->
    <!-- Data Center Brokerage Modal -->
    <div class="modal-overlay" id="serviceModal_brokerage" style="display: none;">
        <div class="modal-content">
            <span class="modal-close" onclick="closeServiceModal('brokerage')">&times;</span>
            <div class="modal-header">Data Center Brokerage</div>
            <form onsubmit="handleServiceInquiry(event, 'Data Center Brokerage')">
                <div class="form-group">
                    <label>Your Name *</label>
                    <input type="text" name="name" required>
                </div>
                <div class="form-group">
                    <label>Company *</label>
                    <input type="text" name="company" required>
                </div>
                <div class="form-group">
                    <label>Email *</label>
                    <input type="email" name="email" required>
                </div>
                <div class="form-group">
                    <label>Phone Number</label>
                    <input type="tel" name="phone">
                </div>
                <div class="form-group">
                    <label>Transaction Type *</label>
                    <select name="transaction_type" required>
                        <option value="">Select...</option>
                        <option value="buy">Buying DC Facility</option>
                        <option value="sell">Selling DC Facility</option>
                        <option value="lease">Leasing DC Space/Capacity</option>
                        <option value="advisory">Strategic Advisory</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Power Requirements (if applicable)</label>
                    <input type="text" name="power" placeholder="e.g., 10MW, 50MW">
                </div>
                <div class="form-group">
                    <label>Target Markets/Regions *</label>
                    <textarea name="markets" rows="2" required placeholder="e.g., Northern Virginia, Dallas, Silicon Valley"></textarea>
                </div>
                <div class="form-group">
                    <label>Timeline *</label>
                    <select name="timeline" required>
                        <option value="">Select...</option>
                        <option value="immediate">Immediate (0-3 months)</option>
                        <option value="short">Short-term (3-6 months)</option>
                        <option value="medium">Medium-term (6-12 months)</option>
                        <option value="long">Long-term (12+ months)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Additional Details</label>
                    <textarea name="details" rows="4" placeholder="Tell us about your specific requirements, budget range, technical needs, etc."></textarea>
                </div>
                <button type="submit" class="form-submit">Submit Inquiry</button>
            </form>
        </div>
    </div>

    <!-- Market Intelligence Platform Modal -->
    <div class="modal-overlay" id="serviceModal_intelligence" style="display: none;">
        <div class="modal-content">
            <span class="modal-close" onclick="closeServiceModal('intelligence')">&times;</span>
            <div class="modal-header">Market Intelligence Platform</div>
            <form onsubmit="handleServiceInquiry(event, 'Market Intelligence Platform')">
                <div class="form-group">
                    <label>Your Name *</label>
                    <input type="text" name="name" required>
                </div>
                <div class="form-group">
                    <label>Company *</label>
                    <input type="text" name="company" required>
                </div>
                <div class="form-group">
                    <label>Email *</label>
                    <input type="email" name="email" required>
                </div>
                <div class="form-group">
                    <label>Phone Number</label>
                    <input type="tel" name="phone">
                </div>
                <div class="form-group">
                    <label>Primary Use Case *</label>
                    <select name="use_case" required>
                        <option value="">Select...</option>
                        <option value="competitive">Competitive Intelligence</option>
                        <option value="market">Market Research</option>
                        <option value="development">Development Tracking</option>
                        <option value="investment">Investment Analysis</option>
                        <option value="sales">Sales Prospecting</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Markets of Interest *</label>
                    <textarea name="markets" rows="3" required placeholder="List all cities/regions you're interested in tracking"></textarea>
                </div>
                <div class="form-group">
                    <label>Specific Operators to Track</label>
                    <input type="text" name="operators" placeholder="e.g., Digital Realty, Equinix, QTS">
                </div>
                <div class="form-group">
                    <label>Data Export Needs</label>
                    <select name="export_needs">
                        <option value="">Select...</option>
                        <option value="csv">CSV Export</option>
                        <option value="excel">Excel with Analytics</option>
                        <option value="api">API Integration</option>
                        <option value="all">All of the above</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Team Size</label>
                    <input type="number" name="team_size" placeholder="Number of users needed">
                </div>
                <div class="form-group">
                    <label>Additional Requirements</label>
                    <textarea name="requirements" rows="3" placeholder="Any specific data points, features, or integrations needed?"></textarea>
                </div>
                <button type="submit" class="form-submit">Request Demo</button>
            </form>
        </div>
    </div>

    <!-- Site Selection Consulting Modal -->
    <div class="modal-overlay" id="serviceModal_siteselection" style="display: none;">
        <div class="modal-content">
            <span class="modal-close" onclick="closeServiceModal('siteselection')">&times;</span>
            <div class="modal-header">Site Selection Consulting</div>
            <form onsubmit="handleServiceInquiry(event, 'Site Selection Consulting')">
                <div class="form-group">
                    <label>Your Name *</label>
                    <input type="text" name="name" required>
                </div>
                <div class="form-group">
                    <label>Company *</label>
                    <input type="text" name="company" required>
                </div>
                <div class="form-group">
                    <label>Email *</label>
                    <input type="email" name="email" required>
                </div>
                <div class="form-group">
                    <label>Phone Number</label>
                    <input type="tel" name="phone">
                </div>
                <div class="form-group">
                    <label>Project Type *</label>
                    <select name="project_type" required>
                        <option value="">Select...</option>
                        <option value="hyperscale">Hyperscale (100MW+)</option>
                        <option value="enterprise">Enterprise (10-100MW)</option>
                        <option value="edge">Edge/Small (1-10MW)</option>
                        <option value="colocation">Colocation Expansion</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Power Requirements *</label>
                    <input type="text" name="power" required placeholder="e.g., 20MW, 100MW">
                </div>
                <div class="form-group">
                    <label>Geographic Preferences *</label>
                    <textarea name="geography" rows="2" required placeholder="Preferred regions, states, or metro areas"></textarea>
                </div>
                <div class="form-group">
                    <label>Key Requirements</label>
                    <textarea name="requirements" rows="4" placeholder="Power availability, fiber connectivity, tax incentives, proximity to customers, etc."></textarea>
                </div>
                <div class="form-group">
                    <label>Project Timeline *</label>
                    <select name="timeline" required>
                        <option value="">Select...</option>
                        <option value="planning">Planning Phase</option>
                        <option value="6months">Within 6 months</option>
                        <option value="12months">Within 12 months</option>
                        <option value="18months">12-18 months</option>
                        <option value="later">18+ months</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Budget Range (Optional)</label>
                    <input type="text" name="budget" placeholder="Total project budget estimate">
                </div>
                <button type="submit" class="form-submit">Request Consultation</button>
            </form>
        </div>
    </div>

    <!-- Due Diligence Services Modal -->
    <div class="modal-overlay" id="serviceModal_duediligence" style="display: none;">
        <div class="modal-content">
            <span class="modal-close" onclick="closeServiceModal('duediligence')">&times;</span>
            <div class="modal-header">Due Diligence Services</div>
            <form onsubmit="handleServiceInquiry(event, 'Due Diligence Services')">
                <div class="form-group">
                    <label>Your Name *</label>
                    <input type="text" name="name" required>
                </div>
                <div class="form-group">
                    <label>Company *</label>
                    <input type="text" name="company" required>
                </div>
                <div class="form-group">
                    <label>Email *</label>
                    <input type="email" name="email" required>
                </div>
                <div class="form-group">
                    <label>Phone Number</label>
                    <input type="tel" name="phone">
                </div>
                <div class="form-group">
                    <label>Transaction Type *</label>
                    <select name="transaction_type" required>
                        <option value="">Select...</option>
                        <option value="acquisition">Facility Acquisition</option>
                        <option value="investment">Investment/Funding</option>
                        <option value="lease">Major Lease Agreement</option>
                        <option value="portfolio">Portfolio Review</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Facility Location(s) *</label>
                    <textarea name="locations" rows="2" required placeholder="City, State for facility/facilities under review"></textarea>
                </div>
                <div class="form-group">
                    <label>Facility Size/Capacity</label>
                    <input type="text" name="size" placeholder="e.g., 50MW, 200,000 sq ft">
                </div>
                <div class="form-group">
                    <label>Due Diligence Scope *</label>
                    <textarea name="scope" rows="4" required placeholder="Technical assessment, financial review, operational audit, lease analysis, market positioning, etc."></textarea>
                </div>
                <div class="form-group">
                    <label>Timeline/Deadline *</label>
                    <select name="timeline" required>
                        <option value="">Select...</option>
                        <option value="urgent">Urgent (1-2 weeks)</option>
                        <option value="standard">Standard (3-4 weeks)</option>
                        <option value="comprehensive">Comprehensive (6-8 weeks)</option>
                        <option value="flexible">Flexible</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Additional Information</label>
                    <textarea name="additional" rows="3" placeholder="Any specific concerns, red flags to investigate, or areas of focus?"></textarea>
                </div>
                <button type="submit" class="form-submit">Request Quote</button>
            </form>
        </div>
    </div>

    <!-- Custom Market Reports Modal -->
    <div class="modal-overlay" id="serviceModal_reports" style="display: none;">
        <div class="modal-content">
            <span class="modal-close" onclick="closeServiceModal('reports')">&times;</span>
            <div class="modal-header">Custom Market Reports</div>
            <form onsubmit="handleServiceInquiry(event, 'Custom Market Reports')">
                <div class="form-group">
                    <label>Your Name *</label>
                    <input type="text" name="name" required>
                </div>
                <div class="form-group">
                    <label>Company *</label>
                    <input type="text" name="company" required>
                </div>
                <div class="form-group">
                    <label>Email *</label>
                    <input type="email" name="email" required>
                </div>
                <div class="form-group">
                    <label>Phone Number</label>
                    <input type="tel" name="phone">
                </div>
                <div class="form-group">
                    <label>Report Focus *</label>
                    <select name="report_focus" required>
                        <option value="">Select...</option>
                        <option value="market">Specific Market Analysis</option>
                        <option value="operator">Operator Activity Report</option>
                        <option value="supply_demand">Supply/Demand Analysis</option>
                        <option value="trends">Industry Trends</option>
                        <option value="competitive">Competitive Landscape</option>
                        <option value="forecast">Market Forecast</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Geographic Scope *</label>
                    <textarea name="geography" rows="2" required placeholder="Markets, regions, or operators to cover"></textarea>
                </div>
                <div class="form-group">
                    <label>Report Frequency *</label>
                    <select name="frequency" required>
                        <option value="">Select...</option>
                        <option value="one-time">One-Time Report</option>
                        <option value="monthly">Monthly</option>
                        <option value="quarterly">Quarterly</option>
                        <option value="annual">Annual</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Key Questions to Answer *</label>
                    <textarea name="key_questions" rows="4" required placeholder="What specific questions should this report answer?"></textarea>
                </div>
                <div class="form-group">
                    <label>Delivery Format</label>
                    <select name="format">
                        <option value="pdf">PDF Report</option>
                        <option value="excel">Excel with Data</option>
                        <option value="powerpoint">PowerPoint Deck</option>
                        <option value="all">All Formats</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Timeline</label>
                    <input type="text" name="timeline" placeholder="When do you need the first report?">
                </div>
                <button type="submit" class="form-submit">Request Proposal</button>
            </form>
        </div>
    </div>

    <!-- Strategic Advisory Modal -->
    <div class="modal-overlay" id="serviceModal_advisory" style="display: none;">
        <div class="modal-content">
            <span class="modal-close" onclick="closeServiceModal('advisory')">&times;</span>
            <div class="modal-header">Strategic Advisory</div>
            <form onsubmit="handleServiceInquiry(event, 'Strategic Advisory')">
                <div class="form-group">
                    <label>Your Name *</label>
                    <input type="text" name="name" required>
                </div>
                <div class="form-group">
                    <label>Company *</label>
                    <input type="text" name="company" required>
                </div>
                <div class="form-group">
                    <label>Email *</label>
                    <input type="email" name="email" required>
                </div>
                <div class="form-group">
                    <label>Phone Number</label>
                    <input type="tel" name="phone">
                </div>
                <div class="form-group">
                    <label>Your Role *</label>
                    <input type="text" name="role" required placeholder="e.g., CTO, VP Infrastructure, CEO">
                </div>
                <div class="form-group">
                    <label>Advisory Need *</label>
                    <select name="advisory_type" required>
                        <option value="">Select...</option>
                        <option value="strategy">DC Strategy Development</option>
                        <option value="capacity">Capacity Planning</option>
                        <option value="market_entry">Market Entry Strategy</option>
                        <option value="portfolio">Portfolio Optimization</option>
                        <option value="investment">Investment Decision Support</option>
                        <option value="buildvsbuy">Build vs Buy Analysis</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Current Situation *</label>
                    <textarea name="situation" rows="4" required placeholder="Describe your current DC footprint, challenges, and strategic objectives"></textarea>
                </div>
                <div class="form-group">
                    <label>Key Challenges *</label>
                    <textarea name="challenges" rows="3" required placeholder="What are the main challenges you're facing?"></textarea>
                </div>
                <div class="form-group">
                    <label>Desired Outcomes</label>
                    <textarea name="outcomes" rows="3" placeholder="What does success look like? What decisions need to be made?"></textarea>
                </div>
                <div class="form-group">
                    <label>Engagement Type</label>
                    <select name="engagement">
                        <option value="project">Project-Based</option>
                        <option value="retainer">Ongoing Retainer</option>
                        <option value="workshop">Workshop/Training</option>
                        <option value="assessment">Initial Assessment</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Timeline</label>
                    <input type="text" name="timeline" placeholder="When do you need advisory support?">
                </div>
                <button type="submit" class="form-submit">Schedule Consultation</button>
            </form>
        </div>
    </div>

    <!-- Modal Popup for Service 3 (Site Selection) -->
    <div class="modal-overlay" id="siteSelectionModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeSiteSelectionModal()">&times;</button>
            <h2>SITE SELECTION: Expert Consulting</h2>
            <p style="font-size: 14px; line-height: 1.8; margin-bottom: 20px;">
                Our site selection team combines decades of data center industry experience with proprietary market intelligence to identify optimal locations for your facility.
            </p>
            <h3 style="font-size: 16px; margin-bottom: 10px;">What's Included:</h3>
            <ul>
                <li><strong>Power Availability Analysis:</strong> Utility capacity, redundancy, and future scalability assessment</li>
                <li><strong>Connectivity Evaluation:</strong> Fiber networks, carrier hotels, and internet exchange proximity</li>
                <li><strong>Tax Incentive Research:</strong> State/local abatements, sales tax exemptions, and economic development programs</li>
                <li><strong>Risk Assessment:</strong> Natural disaster exposure, seismic zones, flood plains, and climate considerations</li>
                <li><strong>Market Comparisons:</strong> Side-by-side analysis of competing locations with cost projections</li>
                <li><strong>Regulatory Review:</strong> Zoning, permitting timelines, and environmental compliance requirements</li>
            </ul>
            <p style="font-size: 14px; font-style: italic; margin-top: 20px;">
                We've helped clients select sites for over $5B in data center projects across North America.
            </p>
            <button class="modal-btn" onclick="alert('Contact form coming soon! Email: contact@dc-intel.com')">Request Consultation</button>
        </div>
    </div>

    <!-- VIDEO PLAYER MODAL -->
    <div id="videoModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.95); z-index: 10000; justify-content: center; align-items: center;">
        <div style="position: relative; width: 90%; max-width: 1200px; background: #000; border: 3px solid #fff; box-shadow: 0 0 30px rgba(255,255,255,0.3);">
            <!-- Close Button -->
            <button onclick="closeVideo()" style="position: absolute; top: -15px; right: -15px; width: 40px; height: 40px; background: #fff; color: #000; border: 3px solid #000; border-radius: 50%; font-size: 24px; font-weight: bold; cursor: pointer; z-index: 10001;">
                &times;
            </button>

            <!-- Video Title -->
            <div id="videoTitle" style="background: #fff; color: #000; padding: 15px 20px; font-family: Georgia, serif; font-size: 18px; font-weight: bold; border-bottom: 3px solid #000;">
                Educational Video
            </div>

            <!-- Video Player -->
            <video
                id="videoPlayer"
                style="width: 100%; height: auto; display: block; background: #000;"
                controls
                controlsList="nodownload nofullscreen"
                disablePictureInPicture
                oncontextmenu="return false;">
                Your browser does not support the video tag.
            </video>

            <!-- Video Info -->
            <div style="background: #fff; color: #000; padding: 15px 20px; font-size: 12px; line-height: 1.6; border-top: 3px solid #000;">
                <strong>Note:</strong> This video is for subscriber viewing only. Downloading or sharing is prohibited.
            </div>
        </div>
    </div>

    <!-- VIDEO PLAYER JAVASCRIPT -->
    <script>
        function openVideo(videoPath, videoTitle) {
            const modal = document.getElementById('videoModal');
            const player = document.getElementById('videoPlayer');
            const titleElem = document.getElementById('videoTitle');

            // Set video source and title
            player.src = videoPath;
            titleElem.textContent = videoTitle;

            // Show modal with flex display
            modal.style.display = 'flex';

            // Play video
            player.play().catch(e => console.log('Video autoplay prevented'));

            // Prevent right-click on video
            player.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                return false;
            });
        }

        function closeVideo() {
            const modal = document.getElementById('videoModal');
            const player = document.getElementById('videoPlayer');

            // Stop and reset video
            player.pause();
            player.currentTime = 0;
            player.src = '';

            // Hide modal
            modal.style.display = 'none';
        }

        // Close video on ESC key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeVideo();
            }
        });

        // Close video when clicking outside the player
        document.getElementById('videoModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeVideo();
            }
        });
    </script>


    <!-- Study Guide Modal -->
    <div id="studyGuideModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 10000; overflow: auto;">
        <div style="position: relative; max-width: 1200px; margin: 40px auto; background: #fff; border: 4px solid #000; box-shadow: 0 4px 20px rgba(0,0,0,0.5);">
            <!-- Modal Header -->
            <div style="background: #000; color: #fff; padding: 20px 30px; display: flex; justify-content: space-between; align-items: center; border-bottom: 3px solid #000;">
                <h2 id="modalTitle" style="margin: 0; font-size: 22px; font-family: Georgia, serif;"></h2>
                <button onclick="closeStudyGuideModal()" style="background: transparent; border: none; color: #fff; font-size: 32px; cursor: pointer; padding: 0; width: 40px; height: 40px; line-height: 32px;">&times;</button>
            </div>

            <!-- Modal Content -->
            <div id="modalContent" style="padding: 30px; min-height: 400px;"></div>
        </div>
    </div>
    </body>
</html>














